function init_chechlists(){$(".check-list[data-url]").each(function(n,t){var r=$(t).attr("data-url"),u=$(t).attr("data-name"),i=$(t).attr("data-value");$.post(r).done(function(n){$.each(n,function(n,r){var f=document.createElement("label"),e=$(document.createElement("input")).attr("type","checkbox").attr("name",u).val(r.key);i!=undefined&&$.inArray(r.key.toString(),i.split(","))!=-1&&e.attr("checked","checked");$(f).append(e).append(r.value);$(t).append(f)})})})}function validateDynamicsForm(n,t,i){var r,u;i=i||{};r=n.attr("action");r==undefined&&(r=document.location.pathname);u=n.serialize()+"&__actionURL="+r;$.post(r.toLowerCase().replace("/edit","/validate").replace("/create","/validate"),u).done(function(r){if(r.length==0)i.onValidate!=undefined&&i.onValidate(),n.addClass("dynamics-form-valid"),t?n.submit():swal({title:"",text:"",confirmButtonText:"OK",type:"success"});else{n.hasClass("dynamics-form-valid")&&$(n).removeClass("dynamics-form-valid");var u=$("<div>").append($("<ul>").addClass("validation-error-list"));$(r).each(function(n,t){$(String.format("[name={0}]",t.HtmlFieldName)).addClass("input-validation-error");$("ul",u).append($("<li>").text(t.ErrorMessage))});swal({title:"Please check this fields :",text:u.html(),confirmButtonText:"OK",html:!0,type:"warning",inputType:"hidden"});$("input[type=submit]",n).removeAttr("disabled");i.onValidateError!=undefined&&i.onValidateError()}}).error(function(){i.onError!=undefined?i.onError():(swal({title:"Server fault",text:"Please try again .",confirmButtonText:"Ok",type:"error"}),$("input[type=submit]",n).removeAttr("disabled"))})}function browser_input_oninvalid(n,t){t.preventDefault();$(n).addClass("input-browser-validation-error")}function fill_Form_by_Query_Strings(){for(var n=document.location.search.replace("?",""),i,n=n.split("&"),t=0;t<n.length;t++)i=n[t].split("="),$("input, select","form.dynamics-form").each(function(n,t){$(t).attr("name")!=undefined&&$(t).attr("name").toLowerCase()==i[0].toLowerCase()&&($(t).val(i[1]).change(),console.log(t))})}var InitBaseForms=function(){function o(n){if(console.log("updateProgress"),n.lengthComputable)var t=n.loaded/n.total;else console.log("unable to complete")}function s(t){var h=$(t).parents(".dynamics-field").attr("data-property"),c=$(t).parents(".dynamics-field-group").attr("data-group"),o=0,s=$(String.format(".dynamics-field[data-property={0}]",h)).parents(".dynamics-field-wrapper").attr("data-relationid"),f,r,i;s!=""&&(o=parseInt(s));f=o+1;r=$(t).parents(".dynamics-field-wrapper").clone();r.attr("data-relationid",f);$(".cke",r).remove();$("label",r).addClass("visible-xs").text($("label",r).text()+" "+(o+2));i=$("input[type!=file],select,textarea",r);$(".select-file-btn",r).attr("data-propertyId",i.attr("id")+"_add_"+f);i.attr("id",i.attr("id")+"_add_"+f);i.attr("name",i.attr("name")+"_add_"+f);$(".ajax-upload-input .fileName",r).text("");i.hasClass("RichTextEditor")&&i.ckeditor(e(i));i.val("");$(String.format(".dynamics-field-group[data-group={0}]",c)).append(r);$(i).before($(String.format(u,i.attr("id"))));n()}function n(){$("input[data-type=image]").each(function(n,t){var i=$(t).parents(".dynamics-field").first();($(t).val().endsWith(".jpg")||$(t).val().endsWith(".png")||$(t).val().endsWith(".gif")||$(t).val().endsWith(".jpeg"))&&$(".property-image-tumbnail",i).css("backgroundImage","url('"+$(t).val()+"?maxwidth=80&blah=')")})}function t(t){$("#elfinder-wrapper").remove();var r=$(document.createElement("div")).attr("id","elfinder"),i=$(document.createElement("div")).attr("id","elfinder-wrapper");i.append("<div id='close'>X<\/div>");i.append(r);$("body").append(i);$("#elfinder").elfinder({resizable:!1,url:"/Manage/elfinder",customData:{folder:"UPLOADS"},commandsOptions:{getfile:{oncomplete:"destroy"}},getFileCallback:function(i){$(t).val(i.url).trigger("change");console.log(t);n();$("#elfinder-wrapper #close").trigger("click",null)}}).elfinder("instance")}function e(n){var t={};switch($(n).attr("data-mode")){case"0":t.toolbar="Basic";break;case"1":t.toolbar="Standard";break;case"2":t.toolbar="Full"}switch($(n).attr("data-lang")){case"0":t.language="en";break;case"1":t.language="fa"}switch($(n).attr("data-skin")){case"0":t.skin="moono";break;case"1":t.skin="office2013";break;case"2":t.skin="bootstrapck"}return t}function r(n,t,i,r){var f=$(n).attr("data-url"),u;t!=undefined&&t.length<1||(u={Depend:t,ParentField:$(n).attr("name")},$.post(f,u).done(function(t){$(n).AddDataToSelect(t,i,r)}))}function h(n,t,i){var u=$(n).attr("data-depend"),f;if((u==undefined||u==""||u=="...")&&$(n).attr("data-url")!=undefined){if(f=$(n).attr("data-url"),f=="local"){$(String.format("select[data-depend={0}]",$(n).attr("name"))).each(function(t,i){r(i,$(n).val())});return}$.post(f).done(function(u){$(n).AddDataToSelect(u,t,i);$(String.format("select[data-depend={0}]",$(n).attr("name"))).each(function(t,i){r(i,$(n).val())})})}}var u='<i class="remove fa fa-remove" data-input="{0}"><\/i>',f,i,c;$("input,select",$(".dynamics-form")).each(function(n,t){$(t).attr("id")!=undefined&&$(t).attr("id").indexOf("_edit_")!=-1&&$(t).before($(String.format(u,$(t).attr("id"))))});f="<div class='uploadcontrol-wrapper'>    <div class='uploadcontrol'>        <input type='file' />        <div class='buttons'>            <a class='btn btn-success submit-file'>                <i class='glyphicon glyphicon-ok'><\/i>    تایید فایل<\/a><a class='btn btn-default refresh-file'>    <i class='glyphicon glyphicon-refresh'><\/i>    انتخاب فایل دیگر<\/a><\/div><\/div><\/div>";$(document).off("click",".uploadcontrol-input").on("click",".uploadcontrol-input",function(){$(".uploadcontrol-wrapper").remove();$("body").append($(f));$(".uploadcontrol").data("target",this)});$(document).on("keyup keydown",".uploadcontrol-input",function(n){n.preventDefault()});$(document).on("change",".uploadcontrol input[type=file]",function(){var t=this.files[0],n=$(this).parents(".uploadcontrol"),r,i;n.find(".file_tumb_wrapper").remove();var f=$(".buttons",n).show(),u=parseFloat((t.size/1024).toFixed(2));u>1024?(r=$("<div class='file_tumb_wrapper' />").append($("<span />").text(t.name)),n.append(r)):(i=new FileReader,i.onload=function(t){var i=$("<div class='file_tumb_wrapper' />").append($("<img class='file_tumb' />").attr("src",t.target.result));n.append(i)},i.readAsDataURL(t))});$(document).on("click",".uploadcontrol .refresh-file",function(){var n=$(this).parents(".uploadcontrol"),t=$(".buttons",n).hide();n.find(".file_tumb_wrapper").remove()});$(document).on("click",".uploadcontrol-wrapper",function(n){var t=$(n.target);t.hasClass("uploadcontrol")==!1&&t.parents().hasClass("uploadcontrol")==!1&&$(this).remove()});$(document).on("click",".uploadcontrol .submit-file",function(){var n=$(this).parents(".uploadcontrol"),u=$(".buttons",n).hide(),i=n.find("input[type=file]"),r=i[0].files[0],t;n.find(".file_tumb_wrapper").remove();t=new FormData;t.append("image",r);jQuery.ajax({url:"/manage/dynamics/uploadControl",type:"POST",data:t,cache:!1,processData:!1,contentType:!1,xhr:function(){return myXhr=$.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",o,!1),myXhr},success:function(t){var i=$(n.data("target")).val(t);$(".uploadcontrol-wrapper").remove()}})});$(document).off("click","a.confirm").on("click","a.confirm",function(){var n=$(this);event.preventDefault();swal({title:"Are you sure ?",text:"the oparation will not be Irreversible",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes , im sure .",cancelButtonText:"No ! cancel it .",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&(window.location=n.attr("href"))})});$(document).off("blur",".input-validation-error").on("blur",".input-validation-error",function(){$(this).removeClass("input-validation-error");$(document).on("blur",".input-validation-error",function(){$(this).removeClass("input-validation-error")})});$(document).on("click","form.db-form #submit",function(n){var t=$(this).parents("form");t.hasClass("dynamics-form-valid")==!1?(n.preventDefault(n),$(this).attr("disabled","disabled"),validateDynamicsForm(t,!0),$(this).removeAttr("disabled")):($(this).attr("disabled","disabled"),$(t)[0].submit())});$(document).off("click","form.dynamics-form.db-form #validate").on("click","form.dynamics-form.db-form #validate",function(){var n=$(this).parents("form.dynamics-form.db-form").first();validateDynamicsForm(n)});$(document).off("click",".AddInput[data-property]").on("click",".AddInput[data-property]",function(){$("select","form.dynamics-form").select2("destroy");var n=$(this).attr("data-group");$(String.format("[data-group={0}] input[type!=file].dinput,[data-group={0}] textarea.dinput,[data-group={0}] select.dinput",n)).not("[name*='_add_']").not("[name*='_edit_']").not("[type=hidden]").each(function(n,t){s(t)});i();$("select","form.dynamics-form").select2({placeholderOption:"first"})});$(".refresh").click(function(){var n=$("#captcha-image");n.attr("data-src")==undefined&&n.attr("data-src",n.attr("src"));n.attr("src",n.attr("data-src")+"?"+(new Date).getTime())});$(document).off("keyup","input[data-type=image]").on("keyup","input[data-type=image]",function(){n()});$(document).off("click",".dynamics-field .remove").on("click",".dynamics-field .remove",function(){var n=$(String.format("#{0}",$(this).attr("data-input"))),t=n.parents(".dynamics-field-wrapper").attr("data-relationid");$(String.format(".dynamics-field-wrapper[data-relationid={0}]",t)).remove()});$(document).off("click",".select-file-btn").on("click",".select-file-btn",function(){var n=this,i=$("#"+$(n).attr("data-propertyId"));t(i)});$(document).on("contextmenu","input.cke_dialog_ui_input_text",function(n){n.preventDefault();t(this)});$(document).on("click",".select-file-onclick",function(){t(this)});$(document).off("click","#elfinder-wrapper #close").on("click","#elfinder-wrapper #close",function(){$(this).parents("#elfinder-wrapper").remove()});$("input,select","form.dynamics-form").each(function(n,t){try{var i=GetQueryString($(t).attr("name")),r=$(t).attr("name");i!=""&&($('input[name="'+r+'"]').val(i),$('select[name="'+r+'"]').attr("data-value",i))}catch(u){}});$.fn.realVal=function(){var n=$(this),i=n.val(),r=n.attr("type"),t;return r&&r==="checkbox"?(t=n.attr("data-unchecked"),typeof t=="undefined"&&(t=""),n.prop("checked")?i:t):i};$("textarea.RichTextEditor").each(function(n,t){window.CKEDITOR_BASEPATH="/Content/ckeditor/";$(t).ckeditor(e(t))});i=function(){$("input.money-input").inputmask("decimal",{radixPoint:",",autoGroup:!0,groupSeparator:",",groupSize:3,autoUnmask:!0,rightAlign:!1});$(":input",$(".dynamics-form")).each(function(n,t){var i=$(t).attr("data-mask");if(i!=undefined){i=i.toLowerCase();switch(i){case"rial":$(t).focus(function(){$(t).maskMoney({thousands:",",decimal:".",precision:0,allowZero:!0,suffix:" ریال"})}).blur(function(){$(t).maskMoney("destroy");var n=$(this).val().replace(/,/g,"").replace(" ریال","");$(t).val("");setTimeout(function(){$(t).val(n);$(".field-validation-error",$(t).parents("div")).remove()},1)});break;default:$(t).inputmask(i,{removeMaskOnSubmit:!0})}}})};i();init_chechlists();$.fn.AddDataToSelect=function(n){var t=this,i,r;return $("option",t).remove(),t.attr("multiple")==undefined&&(i=$(document.createElement("option")).text("...").val(""),$(t).append(i)),r=$(t).attr("data-value"),$.each(n,function(n,i){var u=$(document.createElement("option")).val(i.key).text(i.value);r.split(",").indexOf(i.key.toString())!=-1&&u.attr("selected","selected").prop("selected",!0);$(t).append(u)}),t};$(document).on("change","form.dynamics-form select[data-url]",function(){var n=this;$(String.format("select[data-depend={0}]",$(n).attr("name"))).each(function(t,i){r(i,$(n).val())})});c=function(){$("select[data-url]").each(function(n,t){h(t)})}()};$(document).ready(function(){InitBaseForms();fill_Form_by_Query_Strings()});