/*!
 * elFinder - file manager for web
 * Version 2.1 (Nightly: 4df7296) (2013-04-25)
 * http://elfinder.org
 * 
 * Copyright 2009-2012, Studio 42
 * Licensed under a 3 clauses BSD license
 */
$(function(){$(".ui-icon-circle-close").click(function(){$(this).parents(".ui-widget").first().remove()})}),function(n){window.elFinder=function(t,i){this.time("load");var r=this,t=n(t),ft=n("<div/>").append(t.contents()),et=t.attr("style"),it=t.attr("id")||"",y="elfinder-"+(it||Math.random().toString().substr(2,7)),ot="mousedown."+y,st="keydown."+y,ht="keypress."+y,e=!0,rt=!0,f="",o={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:!0,tmb:!1},u={},p=[],h={},l={},c=[],b=[],w=[],ct=new r.command(r),k="auto",d=400,g=n(document.createElement("audio")).hide().appendTo("body")[0],nt,ut=function(t){if(t.init)u={};else for(var i in u)u.hasOwnProperty(i)&&u[i].mime!="directory"&&u[i].phash==f&&n.inArray(i,b)===-1&&delete u[i];f=t.cwd.hash;a(t.files);u[f]||a([t.cwd]);r.lastDir(f)},a=function(n){for(var e=n.length,t,i,f;e--;)t=n[e],t.name&&t.hash&&t.mime&&(t.phash||(i="volume_"+t.name,f=r.i18n(i),i!=f&&(t.i18=f)),u[t.hash]=t)},lt=function(t){var i=t.keyCode,u=!!(t.ctrlKey||t.metaKey);e&&(n.each(l,function(n,f){f.type==t.type&&f.keyCode==i&&f.shiftKey==t.shiftKey&&f.ctrlKey==u&&f.altKey==t.altKey&&(t.preventDefault(),t.stopPropagation(),f.callback(t,r),r.debug("shortcut-exec",n+" : "+f.description))}),i!=9||n(t.target).is(":input")||t.preventDefault())},tt=new Date,s,v;if(this.api=null,this.newAPI=!1,this.oldAPI=!1,this.OS=navigator.userAgent.indexOf("Mac")!==-1?"mac":navigator.userAgent.indexOf("Win")!==-1?"win":"other",this.UA=function(){var n=!document.uniqueID&&!window.opera&&!window.sidebar&&window.localStorage&&typeof orientation=="undefined";return{ltIE6:typeof addEventListener=="undefined"&&typeof document.documentElement.style.maxHeight=="undefined",ltIE7:typeof addEventListener=="undefined"&&typeof document.querySelectorAll=="undefined",ltIE8:typeof addEventListener=="undefined"&&typeof document.getElementsByClassName=="undefined",IE:document.uniqueID,Firefox:window.sidebar,Opera:window.opera,Webkit:n,Chrome:n&&window.chrome,Safari:n&&!window.chrome,Mobile:typeof orientation!="undefined"}}(),this.options=n.extend(!0,{},this._options,i||{}),i.ui&&(this.options.ui=i.ui),i.commands&&(this.options.commands=i.commands),i.uiOptions&&i.uiOptions.toolbar&&(this.options.uiOptions.toolbar=i.uiOptions.toolbar),n.extend(this.options.contextmenu,i.contextmenu),this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get",this.customData=n.isPlainObject(this.options.customData)?this.options.customData:{},this.id=it,this.uploadURL=i.urlUpload||i.url,this.namespace=y,this.lang=this.i18[this.options.lang]&&this.i18[this.options.lang].messages?this.options.lang:"en",v=this.lang=="en"?this.i18.en:n.extend(!0,{},this.i18.en,this.i18[this.lang]),this.direction=v.direction,this.messages=v.messages,this.dateFormat=this.options.dateFormat||v.dateFormat,this.fancyFormat=this.options.fancyDateFormat||v.fancyDateFormat,this.today=new Date(tt.getFullYear(),tt.getMonth(),tt.getDate()).getTime()/1e3,this.yesterday=this.today-86400,s=this.options.UTCDate?"UTC":"",this.getHours="get"+s+"Hours",this.getMinutes="get"+s+"Minutes",this.getSeconds="get"+s+"Seconds",this.getDate="get"+s+"Date",this.getDay="get"+s+"Day",this.getMonth="get"+s+"Month",this.getFullYear="get"+s+"FullYear",this.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+(this.direction=="rtl"?"rtl":"ltr")+" "+this.options.cssClass,this.storage=function(){try{return"localStorage"in window&&window.localStorage!==null?r.localStorage:r.cookie}catch(n){return r.cookie}}(),this.viewType=this.storage("view")||this.options.defaultView||"icons",this.sortType=this.storage("sortType")||this.options.sortType||"name",this.sortOrder=this.storage("sortOrder")||this.options.sortOrder||"asc",this.sortStickFolders=this.storage("sortStickFolders"),this.sortStickFolders=this.sortStickFolders===null?!!this.options.sortStickFolders:!!this.sortStickFolders,this.sortRules=n.extend(!0,{},this._sortRules,this.options.sortsRules),n.each(this.sortRules,function(n,t){typeof t!="function"&&delete r.sortRules[n]}),this.compare=n.proxy(this.compare,this),this.notifyDelay=this.options.notifyDelay>0?parseInt(this.options.notifyDelay):500,this.draggable={appendTo:"body",addClasses:!0,delay:30,revert:!0,refreshPositions:!0,cursor:"move",cursorAt:{left:50,top:47},drag:function(n,t){t.helper.data("locked")||t.helper.toggleClass("elfinder-drag-helper-plus",n.shiftKey||n.ctrlKey||n.metaKey)},start:function(t,i){for(var f=n.map(i.helper.data("files")||[],function(n){return n||null}),e,r=f.length;r--;)if(e=f[r],u[e].locked){i.helper.addClass("elfinder-drag-helper-plus").data("locked",!0);break}},stop:function(){r.trigger("focus").trigger("dragstop")},helper:function(t){var f=this.id?n(this):n(this).parents("[id]:first"),e=n('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-plus"/><\/div>'),s=function(n){return'<div class="elfinder-cwd-icon '+r.mime2class(n)+' ui-corner-all"/>'},i,o;return r.trigger("dragstart",{target:f[0],originalEvent:t}),i=f.is("."+r.res("class","cwdfile"))?r.selected():[r.navId2Hash(f.attr("id"))],e.append(s(u[i[0]].mime)).data("files",i).data("locked",!1),(o=i.length)>1&&e.append(s(u[i[o-1]].mime)+'<span class="elfinder-drag-num">'+o+"<\/span>"),e}},this.droppable={tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file",hoverClass:this.res("class","adroppable"),drop:function(t,i){var o=n(this),h=n.map(i.helper.data("files")||[],function(n){return n||null}),c=[],l="class",a,e,s;for(o.is("."+r.res(l,"cwd"))?e=f:o.is("."+r.res(l,"cwdfile"))?e=o.attr("id"):o.is("."+r.res(l,"navdir"))&&(e=r.navId2Hash(o.attr("id"))),a=h.length;a--;)s=h[a],s!=e&&u[s].phash!=e&&c.push(s);c.length&&(i.helper.hide(),r.clipboard(c,!(t.ctrlKey||t.shiftKey||t.metaKey||i.helper.data("locked"))),r.exec("paste",e),r.trigger("drop",{files:h}))}},this.enabled=function(){return t.is(":visible")&&e},this.visible=function(){return t.is(":visible")},this.root=function(n){for(var t=u[n||f],i;t&&t.phash;)t=u[t.phash];if(t)return t.hash;while(i in u&&u.hasOwnProperty(i))if(t=u[i],!t.phash&&!t.mime=="directory"&&t.read)return t.hash;return""},this.cwd=function(){return u[f]||{}},this.option=function(n){return o[n]||""},this.file=function(n){return u[n]},this.files=function(){return n.extend(!0,{},u)},this.parents=function(n){for(var i=[],t;t=this.file(n);)i.unshift(t.hash),n=t.phash;return i},this.path2array=function(n,t){for(var i,r=[];n&&(i=u[n])&&i.hash;)r.unshift(t&&i.i18?i.i18:i.name),n=i.phash;return r},this.path=function(n,t){return u[n]&&u[n].path?u[n].path:this.path2array(n,t).join(o.separator)},this.url=function(t){var i=u[t],r;return!i||!i.read?"":i.url?i.url:o.url?o.url+"/"+n.map(this.path2array(t),function(n){return encodeURIComponent(n)}).slice(1).join("/"):(r=n.extend({},this.customData,{cmd:"file",target:i.hash}),this.oldAPI&&(r.cmd="open",r.current=i.phash),this.options.url+(this.options.url.indexOf("?")===-1?"?":"&")+n.param(r,!0))},this.tmb=function(n){var t=u[n],i=t&&t.tmb&&t.tmb!=1?o.tmbUrl+t.tmb:"";return i&&(this.UA.Opera||this.UA.IE)&&(i+="?_="+(new Date).getTime()),i},this.selected=function(){return p.slice(0)},this.selectedFiles=function(){return n.map(p,function(t){return u[t]?n.extend({},u[t]):null})},this.fileByName=function(n,t){for(var i in u)if(u.hasOwnProperty(i)&&u[i].phash==t&&u[i].name==n)return u[i]},this.validResponse=function(n,t){return t.error||this.rules[this.rules[n]?n:"defaults"](t)},this.request=function(t){var i=this,h=this.options,r=n.Deferred(),c=n.extend({},h.customData,{mimes:h.onlyMimes},t.data||t),f=c.cmd,a=!(t.preventDefault||t.preventFail),v=!(t.preventDefault||t.preventDone),e=n.extend({},t.notify),y=!!t.raw,p=t.syncOnFail,l,t=n.extend({url:h.url,async:!0,type:this.requestType,dataType:"json",cache:!1,data:c},t.options||{}),b=function(t){t.warning&&i.error(t.warning);f=="open"&&ut(n.extend(!0,{},t));t.removed&&t.removed.length&&i.remove(t);t.added&&t.added.length&&i.add(t);t.changed&&t.changed.length&&i.change(t);i.trigger(f,t);t.sync&&i.sync()},k=function(n,t){var i;switch(t){case"abort":i=n.quiet?"":["errConnect","errAbort"];break;case"timeout":i=["errConnect","errTimeout"];break;case"parsererror":i=["errResponse","errDataNotJSON"];break;default:i=n.status==403?["errConnect","errAccess"]:n.status==404?["errConnect","errNotFound"]:"errConnect"}r.reject(i,n,t)},d=function(t){if(y)return r.resolve(t);if(t)if(n.isPlainObject(t)){if(t.error)return r.reject(t.error,u);if(!i.validResponse(f,t))return r.reject("errResponse",u)}else return r.reject(["errResponse","errDataNotJSON"],u);else return r.reject(["errResponse","errDataEmpty"],u);t=i.normalize(t);i.api||(i.api=t.api||1,i.newAPI=i.api>=2,i.oldAPI=!i.newAPI);t.options&&(o=n.extend({},o,t.options));t.netDrivers&&(i.netDrivers=t.netDrivers);r.resolve(t);t.debug&&i.debug("backend-debug",t.debug)},u,s;if(v&&r.done(b),r.fail(function(n){n&&(a?i.error(n):i.debug("error",i.i18n(n)))}),!f)return r.reject("errCmdReq");if(p&&r.fail(function(n){n&&i.sync()}),e.type&&e.cnt&&(l=setTimeout(function(){i.notify(e);r.always(function(){e.cnt=-(parseInt(e.cnt)||0);i.notify(e)})},i.notifyDelay),r.always(function(){clearTimeout(l)})),f=="open")while(s=w.pop())s.state()=="pending"&&(s.quiet=!0,s.abort());return delete t.preventFail,u=this.transport.send(t).fail(k).done(d),f=="open"&&(w.unshift(u),r.always(function(){var t=n.inArray(u,w);t!==-1&&w.splice(t,1)})),r},this.diff=function(t){var i={},e=[],f=[],r=[],o=function(n){for(var t=r.length;t--;)if(r[t].hash==n)return!0};return n.each(t,function(n,t){i[t.hash]=t}),n.each(u,function(n){i[n]||f.push(n)}),n.each(i,function(t,i){var f=u[t];f?n.each(i,function(n){if(i[n]!=f[n])return r.push(i),!1}):e.push(i)}),n.each(f,function(t,e){var h=u[e],s=h.phash;s&&h.mime=="directory"&&n.inArray(s,f)===-1&&i[s]&&!o(s)&&r.push(i[s])}),{added:e,removed:f,changed:r}},this.sync=function(){var t=this,i=n.Deferred().done(function(){t.trigger("sync")}),r={data:{cmd:"open",init:1,target:f,tree:this.ui.tree?1:0},preventDefault:!0},u={data:{cmd:"tree",target:f==this.root()?f:this.file(f).phash},preventDefault:!0};return n.when(this.request(r),this.request(u)).fail(function(n){i.reject(n);n&&t.request({data:{cmd:"open",target:t.lastDir(""),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0},preventDefault:!0})}).done(function(n,r){var u=t.diff(n.files.concat(r&&r.tree?r.tree:[]));return u.added.push(n.cwd),u.removed.length&&t.remove(u),u.added.length&&t.add(u),u.changed.length&&t.change(u),i.resolve(u)}),i},this.upload=function(n){return this.transport.upload(n,this)},this.bind=function(n,t){var i;if(typeof t=="function")for(n=(""+n).toLowerCase().split(/\s+/),i=0;i<n.length;i++)h[n[i]]===void 0&&(h[n[i]]=[]),h[n[i]].push(t);return this},this.unbind=function(n,t){var i=h[(""+n).toLowerCase()]||[],r=i.indexOf(t);return r>-1&&i.splice(r,1),t=null,this},this.trigger=function(t,i){var t=t.toLowerCase(),u=h[t]||[],r;if(this.debug("event-"+t,i),u.length)for(t=n.Event(t),r=0;r<u.length;r++){t.data=n.extend(!0,{},i);try{if(u[r](t,this)===!1||t.isDefaultPrevented()){this.debug("event-stoped",t.type);break}}catch(f){window.console&&window.console.log&&window.console.log(f)}}return this},this.shortcut=function(t){var e,r,i,f,u;if(this.options.allowShortcuts&&t.pattern&&n.isFunction(t.callback))for(e=t.pattern.toUpperCase().split(/\s+/),f=0;f<e.length;f++)r=e[f],u=r.split("+"),i=(i=u.pop()).length==1?i>0?i:i.charCodeAt(0):n.ui.keyCode[i],i&&!l[r]&&(l[r]={keyCode:i,altKey:n.inArray("ALT",u)!=-1,ctrlKey:n.inArray("CTRL",u)!=-1,shiftKey:n.inArray("SHIFT",u)!=-1,type:t.type||"keydown",callback:t.callback,description:t.description,pattern:r});return this},this.shortcuts=function(){var t=[];return n.each(l,function(n,i){t.push([i.pattern,r.i18n(i.description)])}),t},this.clipboard=function(t,i){var r=function(){return n.map(c,function(n){return n.hash})};return t!==void 0&&(c.length&&this.trigger("unlockfiles",{files:r()}),b=[],c=n.map(t||[],function(n){var t=u[n];return t?(b.push(n),{hash:n,phash:t.phash,name:t.name,mime:t.mime,read:t.read,locked:t.locked,cut:!!i}):null}),this.trigger("changeclipboard",{clipboard:c.slice(0,c.length)}),i&&this.trigger("lockfiles",{files:r()})),c.slice(0,c.length)},this.isCommandEnabled=function(t){return this._commands[t]?n.inArray(t,o.disabled)===-1:!1},this.exec=function(t,i,r){return this._commands[t]&&this.isCommandEnabled(t)?this._commands[t].exec(i,r):n.Deferred().reject("No such command")},this.dialog=function(i,r){return n("<div/>").append(i).appendTo(t).elfinderdialog(r)},this.getUI=function(n){return this.ui[n]||t},this.command=function(n){return n===void 0?this._commands:this._commands[n]},this.resize=function(n,i){t.css("width",n).height(i).trigger("resize");this.trigger("resize",{width:t.width(),height:t.height()})},this.restoreSize=function(){this.resize(k,d)},this.show=function(){t.show();this.enable().trigger("show")},this.hide=function(){this.disable().trigger("hide");t.hide()},this.destroy=function(){t&&t[0].elfinder&&(this.trigger("destroy").disable(),h={},l={},n(document).add(t).unbind("."+this.namespace),r.trigger=function(){},t.children().remove(),t.append(ft.contents()).removeClass(this.cssClass).attr("style",et),t[0].elfinder=null,nt&&clearInterval(nt))},!(n.fn.selectable&&n.fn.draggable&&n.fn.droppable))return alert(this.i18n("errJqui"));if(!t.length)return alert(this.i18n("errNode"));if(!this.options.url)return alert(this.i18n("errURL"));n.extend(n.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120});this.dragUpload=!1;this.xhrUpload=(typeof XMLHttpRequestUpload!="undefined"||typeof XMLHttpRequestEventTarget!="undefined")&&typeof File!="undefined"&&typeof FormData!="undefined";this.transport={};typeof this.options.transport=="object"&&(this.transport=this.options.transport,typeof this.transport.init=="function"&&this.transport.init(this));typeof this.transport.send!="function"&&(this.transport.send=function(t){return n.ajax(t)});this.transport.upload=="iframe"?this.transport.upload=n.proxy(this.uploads.iframe,this):typeof this.transport.upload=="function"?this.dragUpload=!!this.options.dragUploadAllow:this.xhrUpload?(this.transport.upload=n.proxy(this.uploads.xhr,this),this.dragUpload=!0):this.transport.upload=n.proxy(this.uploads.iframe,this);this.error=function(){var n=arguments[0];return arguments.length==1&&typeof n=="function"?r.bind("error",n):r.trigger("error",{error:n})};n.each(["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","dragstart","dragstop","search","searchend","viewchange"],function(t,i){r[i]=function(){var t=arguments[0];return arguments.length==1&&typeof t=="function"?r.bind(i,t):r.trigger(i,n.isPlainObject(t)?t:{})}});this.enable(function(){!e&&r.visible()&&r.ui.overlay.is(":hidden")&&(e=!0,n("texarea:focus,input:focus,button").blur(),t.removeClass("elfinder-disabled"))}).disable(function(){rt=e;e=!1;t.addClass("elfinder-disabled")}).open(function(){p=[]}).select(function(t){p=n.map(t.data.selected||t.data.value||[],function(n){return u[n]?n:null})}).error(function(t){var i={cssClass:"elfinder-dialog-error",title:r.i18n(r.i18n("error")),resizable:!1,destroyOnClose:!0,buttons:{}};i.buttons[r.i18n(r.i18n("btnClose"))]=function(){n(this).elfinderdialog("close")};r.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+r.i18n(t.data.error),i)}).bind("tree parents",function(n){a(n.data.tree||[])}).bind("tmb",function(t){n.each(t.data.images||[],function(n,t){u[n]&&(u[n].tmb=t)})}).add(function(n){a(n.data.added||[])}).change(function(t){n.each(t.data.changed||[],function(t,i){var r=i.hash;u[r]=u[r]?n.extend(u[r],i):i})}).remove(function(t){for(var i=t.data.removed||[],r=i.length,f=function(t){var i=u[t];i&&(i.mime=="directory"&&i.dirs&&n.each(u,function(n,i){i.phash==t&&f(n)}),delete u[t])};r--;)f(i[r])}).bind("search",function(n){a(n.data.files)}).bind("rm",function(){var t=g.canPlayType&&g.canPlayType('audio/wav; codecs="1"');t&&t!=""&&t!="no"&&n(g).html('<source src="./sounds/rm.wav" type="audio/wav">')[0].play()});n.each(this.options.handlers,function(n,t){r.bind(n,t)});this.history=new this.history(this);typeof this.options.getFileCallback=="function"&&this.commands.getfile&&(this.bind("dblclick",function(n){n.preventDefault();r.exec("getfile").fail(function(){r.exec("open")})}),this.shortcut({pattern:"enter",description:this.i18n("cmdgetfile"),callback:function(){r.exec("getfile").fail(function(){r.exec(r.OS=="mac"?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:this.i18n(this.OS=="mac"?"cmdrename":"cmdopen"),callback:function(){r.exec(r.OS=="mac"?"rename":"open")}}));this._commands={};n.isArray(this.options.commands)||(this.options.commands=[]);n.each(["open","reload","back","forward","up","home","info","quicklook","getfile","help"],function(t,i){n.inArray(i,r.options.commands)===-1&&r.options.commands.push(i)});n.each(this.options.commands,function(t,i){var u=r.commands[i];n.isFunction(u)&&!r._commands[i]&&(u.prototype=ct,r._commands[i]=new u,r._commands[i].setup(i,r.options.commandsOptions[i]||{}))});t.addClass(this.cssClass).bind(ot,function(){e||r.enable()});this.ui={workzone:n("<div/>").appendTo(t).elfinderworkzone(this),navbar:n("<div/>").appendTo(t).elfindernavbar(this,this.options.uiOptions.navbar||{}),contextmenu:n("<div/>").appendTo(t).elfindercontextmenu(this),overlay:n("<div/>").appendTo(t).elfinderoverlay({show:function(){r.disable()},hide:function(){rt&&r.enable()}}),cwd:n("<div/>").appendTo(t).elfindercwd(this,this.options.uiOptions.cwd||{}),notify:this.dialog("",{cssClass:"elfinder-dialog-notify",position:{top:"12px",right:"12px"},resizable:!1,autoOpen:!1,title:"&nbsp;",width:280}),statusbar:n('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').hide().appendTo(t)};n.each(this.options.ui||[],function(i,u){var f="elfinder"+u,e=r.options.uiOptions[u]||{};!r.ui[u]&&n.fn[f]&&(r.ui[u]=n("<"+(e.tag||"div")+"/>").appendTo(t)[f](r,e))});t[0].elfinder=this;this.options.resizable&&n.fn.resizable&&t.resizable({handles:"se",minWidth:300,minHeight:200});this.options.width&&(k=this.options.width);this.options.height&&(d=parseInt(this.options.height));r.resize(k,d);n(document).bind("click."+this.namespace,function(i){e&&!n(i.target).closest(t).length&&r.disable()}).bind(st+" "+ht,lt);this.trigger("init").request({data:{cmd:"open",target:r.lastDir(),init:1,tree:this.ui.tree?1:0},preventDone:!0,notify:{type:"open",cnt:1,hideCnt:!0},freeze:!0}).fail(function(){r.trigger("fail").disable().lastDir("");h={};l={};n(document).add(t).unbind("."+this.namespace);r.trigger=function(){}}).done(function(t){r.load().debug("api",r.api);t=n.extend(!0,{},t);ut(t);r.trigger("open",t)});this.one("load",function(){t.trigger("resize");r.options.sync>1e3&&(nt=setInterval(function(){r.sync()},r.options.sync))})};elFinder.prototype={res:function(n,t){return this.resources[n]&&this.resources[n][t]},i18:{en:{translator:"",language:"English",direction:"ltr",dateFormat:"d.m.Y H:i",fancyDateFormat:"$1 H:i",messages:{}},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},kinds:{unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO","application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},rules:{defaults:function(t){return!t||t.added&&!n.isArray(t.added)||t.removed&&!n.isArray(t.removed)||t.changed&&!n.isArray(t.changed)?!1:!0},open:function(t){return t&&t.cwd&&t.files&&n.isPlainObject(t.cwd)&&n.isArray(t.files)},tree:function(t){return t&&t.tree&&n.isArray(t.tree)},parents:function(t){return t&&t.tree&&n.isArray(t.tree)},tmb:function(t){return t&&t.images&&(n.isPlainObject(t.images)||n.isArray(t.images))},upload:function(t){return t&&(n.isPlainObject(t.added)||n.isArray(t.added))},search:function(t){return t&&t.files&&n.isArray(t.files)}},commands:{},parseUploadData:function(t){var i;if(!n.trim(t))return{error:["errResponse","errDataEmpty"]};try{i=n.parseJSON(t)}catch(r){return{error:["errResponse","errDataNotJSON"]}}return this.validResponse("upload",i)?(i=this.normalize(i),i.removed=n.map(i.added||[],function(n){return n.hash}),i):{error:["errResponse"]}},iframeCnt:0,uploads:{checkFile:function(t){var r,f,e,u,i,o;if(t.type=="files")return t.files;if(r=[],e=t.files[0],t.type=="html"){for(f=/<img[^>]+src=["']?([^"'> ]+)/ig,u=[],i="";u=f.exec(e);)i=u[1].replace(/&amp;/g,"&"),i.match(/^http/)&&n.inArray(i,r)==-1&&r.push(i);o=e.match(/<\/a>/i);o&&o.length==1&&(f=/<a[^>]+href=["']?([^"'> ]+)((?:.|\s)+)<\/a>/i,(u=f.exec(e))&&(u[2].match(/<img/i)||(i=u[1].replace(/&amp;/g,"&"),i.match(/^http/)&&n.inArray(i,r)==-1&&r.push(i))))}else for(f=/(http[^<>"{}|\\^\[\]`\s]+)/ig;u=f.exec(e);)i=u[1].replace(/&amp;/g,"&"),n.inArray(i,r)==-1&&r.push(i);return r},iframe:function(t,i){var r=i?i:this,f=t.input?t.input:!1,h=f?!1:r.uploads.checkFile(t),e=n.Deferred().fail(function(n){n&&r.error(n)}).done(function(n){n.warning&&r.error(n.warning);n.removed&&r.remove(n);n.added&&r.add(n);n.changed&&r.change(n);r.trigger("upload",n);n.sync&&r.sync()}),a="iframe-"+r.namespace+ ++r.iframeCnt,u=n('<form action="'+r.uploadURL+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+a+'" style="display:none"><input type="hidden" name="cmd" value="upload" /><\/form>'),v=this.UA.IE,y=function(){l&&clearTimeout(l);c&&clearTimeout(c);p&&r.notify({type:"upload",cnt:-s});setTimeout(function(){v&&n('<iframe src="javascript:false;"/>').appendTo(u);u.remove();o.remove()},100)},o=n('<iframe src="'+(v?"javascript:false;":"about:blank")+'" name="'+a+'" style="position:absolute;left:-1000px;top:-1000px" />').bind("load",function(){o.unbind("load").bind("load",function(){var n=r.parseUploadData(o.contents().text());y();n.error?e.reject(n.error):e.resolve(n)});c=setTimeout(function(){p=!0;r.notify({type:"upload",cnt:s})},r.options.notifyDelay);r.options.iframeTimeout>0&&(l=setTimeout(function(){y();e.reject([errors.connect,errors.timeout])},r.options.iframeTimeout));u.submit()}),s,p,c,l;if(h&&h.length)n.each(h,function(n,t){u.append('<input type="hidden" name="upload[]" value="'+t+'"/>')}),s=1;else if(f&&n(f).is(":file")&&n(f).val())u.append(f),s=f.files?f.files.length:1;else return e.reject();return u.append('<input type="hidden" name="'+(r.newAPI?"target":"current")+'" value="'+r.cwd().hash+'"/>').append('<input type="hidden" name="html" value="1"/>').append(n(f).attr("name","upload[]")),n.each(r.options.onlyMimes||[],function(n,t){u.append('<input type="hidden" name="mimes[]" value="'+t+'"/>')}),n.each(r.options.customData,function(n,t){u.append('<input type="hidden" name="'+n+'" value="'+t+'"/>')}),u.appendTo("body"),o.appendTo("body"),e},xhr:function(t,i){var r=i?i:this,f=n.Deferred().fail(function(n){n&&r.error(n)}).done(function(n){n.warning&&r.error(n.warning);n.removed&&r.remove(n);n.added&&r.add(n);n.changed&&r.change(n);r.trigger("upload",n);n.sync&&r.sync()}).always(function(){s&&clearTimeout(s);c&&r.notify({type:"upload",cnt:-o,progress:100*o})}),u=new XMLHttpRequest,e=new FormData,l=t.input?t.input.files:r.uploads.checkFile(t),o=l.length,h=5,c=!1,a=function(){return setTimeout(function(){c=!0;r.notify({type:"upload",cnt:o,progress:h*o})},r.options.notifyDelay)},s;return o?(u.addEventListener("error",function(){f.reject("errConnect")},!1),u.addEventListener("abort",function(){f.reject(["errConnect","errAbort"])},!1),u.addEventListener("load",function(){var t=u.status,n;if(t>500)return f.reject("errResponse");if(t!=200)return f.reject("errConnect");if(u.readyState!=4)return f.reject(["errConnect","errTimeout"]);if(!u.responseText)return f.reject(["errResponse","errDataEmpty"]);n=r.parseUploadData(u.responseText);n.error?f.reject(n.error):f.resolve(n)},!1),u.upload.addEventListener("progress",function(n){var i=h,t;n.lengthComputable&&(t=parseInt(n.loaded*100/n.total),t>0&&!s&&(s=a()),t-i>4&&(h=t,c&&r.notify({type:"upload",cnt:0,progress:(h-i)*o})))},!1),u.open("POST",r.uploadURL,!0),e.append("cmd","upload"),e.append(r.newAPI?"target":"current",r.cwd().hash),n.each(r.options.customData,function(n,t){e.append(n,t)}),n.each(r.options.onlyMimes,function(n,t){e.append("mimes["+n+"]",t)}),n.each(l,function(n,t){e.append("upload[]",t)}),u.onreadystatechange=function(){u.readyState==4&&u.status==0&&f.reject(["errConnect","errAbort"])},u.send(e),this.UA.Safari&&t.files||(s=a()),f):f.reject()}},one:function(t,i){var u=this,r=n.proxy(i,function(n){return setTimeout(function(){u.unbind(n.type,r)},3),i.apply(this,arguments)});return this.bind(t,r)},localStorage:function(n,t){var i=window.localStorage;if(n="elfinder-"+n+this.id,t===null)return console.log("remove",n),i.removeItem(n);if(t!==void 0)try{i.setItem(n,t)}catch(r){i.clear();i.setItem(n,t)}return i.getItem(n)},cookie:function(t,i){var e,r,f,u;if(t="elfinder-"+t+this.id,i===void 0){if(document.cookie&&document.cookie!="")for(f=document.cookie.split(";"),t+="=",u=0;u<f.length;u++)if(f[u]=n.trim(f[u]),f[u].substring(0,t.length)==t)return decodeURIComponent(f[u].substring(t.length));return""}return r=n.extend({},this.options.cookie),i===null&&(i="",r.expires=-1),typeof r.expires=="number"&&(e=new Date,e.setTime(e.getTime()+r.expires*864e5),r.expires=e),document.cookie=t+"="+encodeURIComponent(i)+"; expires="+r.expires.toUTCString()+(r.path?"; path="+r.path:"")+(r.domain?"; domain="+r.domain:"")+(r.secure?"; secure":""),i},lastDir:function(n){return this.options.rememberLastDir?this.storage("lastdir",n):""},_node:n("<span/>"),escape:function(n){return this._node.text(n).html()},normalize:function(t){var i=function(n){return n&&n.hash&&n.name&&n.mime?(n.mime=="application/x-empty"&&(n.mime="text/plain"),n):null};return t.files&&(t.files=n.map(t.files,i)),t.tree&&(t.tree=n.map(t.tree,i)),t.added&&(t.added=n.map(t.added,i)),t.changed&&(t.changed=n.map(t.changed,i)),t.api&&(t.init=!0),t},setSort:function(n,t,i){this.storage("sortType",this.sortType=this.sortRules[n]?n:"name");this.storage("sortOrder",this.sortOrder=/asc|desc/.test(t)?t:"asc");this.storage("sortStickFolders",(this.sortStickFolders=!!i)?1:"");this.trigger("sortchange")},_sortRules:{name:function(n,t){return n.name.toLowerCase().localeCompare(t.name.toLowerCase())},size:function(n,t){var i=parseInt(n.size)||0,r=parseInt(t.size)||0;return i==r?0:i>r?1:-1},kind:function(n,t){return n.mime.localeCompare(t.mime)},date:function(n,t){var i=n.ts||n.date,r=t.ts||t.date;return i==r?0:i>r?1:-1}},compare:function(n,t){var i=this,f=i.sortType,e=i.sortOrder=="asc",c=i.sortStickFolders,u=i.sortRules,o=u[f],s=n.mime=="directory",h=t.mime=="directory",r;if(c){if(s&&!h)return-1;if(!s&&h)return 1}return r=e?o(n,t):o(t,n),f!="name"&&r==0?r=e?u.name(n,t):u.name(t,n):r},sortFiles:function(n){return n.sort(this.compare)},notify:function(t){var f=t.type,c=this.messages["ntf"+f]?this.i18n("ntf"+f):this.i18n("ntfsmth"),r=this.ui.notify,i=r.children(".elfinder-notify-"+f),h=t.cnt,u=t.progress>=0&&t.progress<=100?t.progress:0,o,s,e;return f?(i.length||(i=n('<div class="elfinder-notify elfinder-notify-{type}"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}<\/span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/><\/div><\/div>'.replace(/\{type\}/g,f).replace(/\{msg\}/g,c)).appendTo(r).data("cnt",0),u&&i.data({progress:0,total:0})),o=h+parseInt(i.data("cnt")),o>0?(t.hideCnt||i.children(".elfinder-notify-cnt").text("("+o+")"),r.is(":hidden")&&r.elfinderdialog("open"),i.data("cnt",o),u<100&&(s=i.data("total"))>=0&&(e=i.data("progress"))>=0&&(s=h+parseInt(i.data("total")),e=u+e,u=parseInt(e/s),i.data({progress:e,total:s}),r.find(".elfinder-notify-progress").animate({width:(u<100?u:100)+"%"},20))):(i.remove(),r.children().length||r.elfinderdialog("close")),this):this},confirm:function(t){var u=!1,i={cssClass:"elfinder-dialog-confirm",modal:!0,resizable:!1,title:this.i18n(t.title||"confirmReq"),buttons:{},close:function(){u||t.cancel.callback();n(this).elfinderdialog("destroy")}},f=this.i18n("apllyAll"),r;return t.reject&&(i.buttons[this.i18n(t.reject.label)]=function(){t.reject.callback(!!(r&&r.prop("checked")));u=!0;n(this).elfinderdialog("close")}),i.buttons[this.i18n(t.accept.label)]=function(){t.accept.callback(!!(r&&r.prop("checked")));u=!0;n(this).elfinderdialog("close")},i.buttons[this.i18n(t.cancel.label)]=function(){n(this).elfinderdialog("close")},t.all&&(t.reject&&(i.width=370),i.create=function(){r=n('<input type="checkbox" />');n(this).next().children().before(n("<label>"+f+"<\/label>").prepend(r))},i.open=function(){var t=n(this).next(),i=parseInt(t.children(":first").outerWidth()+t.children(":last").outerWidth());i>parseInt(t.width())&&n(this).closest(".elfinder-dialog").width(i+30)}),this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>'+this.i18n(t.text),i)},uniqueName:function(n,t){var u=0,r="",f,i;if(n=this.i18n(n),t=t||this.cwd().hash,(f=n.indexOf(".txt"))!=-1&&(r=".txt",n=n.substr(0,f)),i=n+r,!this.fileByName(i,t))return i;while(u<1e4)if(i=n+" "+ ++u+r,!this.fileByName(i,t))return i;return n+Math.random()+r},i18n:function(){for(var o=this,s=this.messages,r=[],f=[],e=function(n){var t;return n.indexOf("#")===0&&(t=o.file(n.substr(1)))?t.name:n},u,t,i=0;i<arguments.length;i++)if(t=arguments[i],typeof t=="string")r.push(e(t));else if(n.isArray(t))for(u=0;u<t.length;u++)typeof t[u]=="string"&&r.push(e(t[u]));for(i=0;i<r.length;i++)n.inArray(i,f)===-1&&(t=r[i],t=s[t]||t,t=t.replace(/\$(\d+)/g,function(n,t){return t=i+parseInt(t),t>0&&r[t]&&f.push(t),r[t]||""}),r[i]=t);return n.map(r,function(t,i){return n.inArray(i,f)===-1?t:null}).join("<br>")},mime2class:function(n){var t="elfinder-cwd-icon-";return n=n.split("/"),t+n[0]+(n[0]!="image"&&n[1]?" "+t+n[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(n){var t=typeof n=="object"?n.mime:n,i;return i=n.alias?"Alias":this.kinds[t]?this.kinds[t]:t.indexOf("text")===0?"Text":t.indexOf("image")===0?"Image":t.indexOf("audio")===0?"Audio":t.indexOf("video")===0?"Video":t.indexOf("application")===0?"App":t,this.messages["kind"+i]?this.i18n("kind"+i):t},formatDate:function(n,t){var i=this,t=t||n.ts,s=i.i18,u,y,l,e,a,f,v,r,o,h,c;return i.options.clientFormatDate&&t>0?(u=new Date(t*1e3),r=u[i.getHours](),o=r>12?r-12:r,h=u[i.getMinutes](),c=u[i.getSeconds](),e=u[i.getDate](),a=u[i.getDay](),f=u[i.getMonth]()+1,v=u[i.getFullYear](),y=t>=this.yesterday?this.fancyFormat:this.dateFormat,l=y.replace(/[a-z]/gi,function(n){switch(n){case"d":return e>9?e:"0"+e;case"j":return e;case"D":return i.i18n(s.daysShort[a]);case"l":return i.i18n(s.days[a]);case"m":return f>9?f:"0"+f;case"n":return f;case"M":return i.i18n(s.monthsShort[f-1]);case"F":return i.i18n(s.months[f-1]);case"Y":return v;case"y":return(""+v).substr(2);case"H":return r>9?r:"0"+r;case"G":return r;case"g":return o;case"h":return o>9?o:"0"+o;case"a":return r>12?"pm":"am";case"A":return r>12?"PM":"AM";case"i":return h>9?h:"0"+h;case"s":return c>9?c:"0"+c}return n}),t>=this.yesterday?l.replace("$1",this.i18n(t>=this.today?"Today":"Yesterday")):l):n.date?n.date.replace(/([a-z]+)\s/i,function(n,t){return i.i18n(t)+" "}):i.i18n("dateUnknown")},perms2class:function(n){var t="";return n.read||n.write?n.read?n.write||(t="elfinder-ro"):t="elfinder-wo":t="elfinder-na",t},formatPermissions:function(n){var t=[];return n.read&&t.push(this.i18n("read")),n.write&&t.push(this.i18n("write")),t.length?t.join(" "+this.i18n("and")+" "):this.i18n("noaccess")},formatSize:function(n){var t=1,i="b";return n=="unknown"?this.i18n("unknown"):(n>1073741824?(t=1073741824,i="GB"):n>1048576?(t=1048576,i="MB"):n>1024&&(t=1024,i="KB"),n=n/t,(n>0?t>=1048576?n.toFixed(2):Math.round(n):0)+" "+i)},navHash2Id:function(n){return"nav-"+n},navId2Hash:function(n){return typeof n=="string"?n.substr(4):!1},log:function(n){return window.console&&window.console.log&&window.console.log(n),this},debug:function(t,i){var r=this.options.debug;return(r=="all"||r===!0||n.isArray(r)&&n.inArray(t,r)!=-1)&&window.console&&window.console.log&&window.console.log("elfinder debug: ["+t+"] ["+this.id+"]",i),this},time:function(n){window.console&&window.console.time&&window.console.time(n)},timeEnd:function(n){window.console&&window.console.timeEnd&&window.console.timeEnd(n)}};elFinder.prototype.version="2.1 (Nightly: 4df7296)";n.fn.elfinder=function(n){return n=="instance"?this.getElFinder():this.each(function(){var t=typeof n=="string"?n:"";this.elfinder||new elFinder(this,typeof n=="object"?n:{});switch(t){case"close":case"hide":this.elfinder.hide();break;case"open":case"show":this.elfinder.show();break;case"destroy":this.elfinder.destroy()}})};n.fn.getElFinder=function(){var n;return this.each(function(){if(this.elfinder)return n=this.elfinder,!1}),n};elFinder.prototype._options={url:"",requestType:"get",transport:{},urlUpload:"",dragUploadAllow:"auto",iframeTimeout:0,customData:{},handlers:{},lang:"en",cssClass:"",commands:["open","reload","home","up","back","forward","getfile","quicklook","download","rm","duplicate","rename","mkdir","mkfile","upload","copy","cut","paste","edit","extract","archive","search","info","view","help","resize","sort","netmount"],commandsOptions:{getfile:{onlyURL:!1,multiple:!1,folders:!1,oncomplete:""},upload:{ui:"uploadbutton"},quicklook:{autoplay:!0,jplayer:"extensions/jplayer"},edit:{mimes:[],editors:[]},help:{view:["about","shortcuts","help"]}},getFileCallback:null,defaultView:"icons",ui:["toolbar","tree","path","stat"],uiOptions:{toolbar:[["back","forward"],["netmount"],["mkdir","mkfile","upload"],["open","download","getfile"],["info"],["quicklook"],["copy","cut","paste"],["rm"],["duplicate","rename","edit","resize"],["extract","archive"],["search"],["view","sort"],["help"]],tree:{openRootOnLoad:!0,syncTree:!0},navbar:{minWidth:150,maxWidth:500},cwd:{oldSchool:!1}},onlyMimes:[],sortRules:{},sortType:"name",sortOrder:"asc",sortStickFolders:!0,clientFormatDate:!0,UTCDate:!1,dateFormat:"",fancyDateFormat:"",width:"auto",height:400,resizable:!0,notifyDelay:500,allowShortcuts:!0,rememberLastDir:!0,showFiles:30,showThreshold:50,validName:!1,sync:0,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:!1},contextmenu:{navbar:["open","|","copy","cut","paste","duplicate","|","rm","|","info"],cwd:["reload","back","|","upload","mkdir","mkfile","paste","|","sort","|","info"],files:["getfile","|","open","quicklook","|","download","|","copy","cut","paste","duplicate","|","rm","|","edit","rename","resize","|","archive","extract","|","info"]},debug:["error","warning","event-destroy"]};elFinder.prototype.history=function(t){var f=this,u=!0,i=[],r,e=function(){i=[t.cwd().hash];r=0;u=!0},o=function(o){return o&&f.canForward()||!o&&f.canBack()?(u=!1,t.exec("open",i[o?++r:--r]).fail(e)):n.Deferred().reject()};this.canBack=function(){return r>0};this.canForward=function(){return r<i.length-1};this.back=o;this.forward=function(){return o(!0)};t.open(function(){var f=i.length,n=t.cwd().hash;u&&(r>=0&&f>r+1&&i.splice(r+1),i[i.length-1]!=n&&i.push(n),r=i.length-1);u=!0}).reload(e)};elFinder.prototype.command=function(t){this.fm=t;this.name="";this.title="";this.state=-1;this.alwaysEnabled=!1;this._disabled=!1;this.disableOnSearch=!1;this.updateOnSelect=!0;this._handlers={enable:function(){this.update(void 0,this.value)},disable:function(){this.update(-1,this.value)},"open reload load":function(){this._disabled=!(this.alwaysEnabled||this.fm.isCommandEnabled(this.name));this.update(void 0,this.value);this.change()}};this.handlers={};this.shortcuts=[];this.options={ui:"button"};this.setup=function(t,i){var r=this,f=this.fm,e,u;for(this.name=t,this.title=f.messages["cmd"+t]?f.i18n("cmd"+t):t,this.options=n.extend({},this.options,i),this.listeners=[],this.updateOnSelect&&(this._handlers.select=function(){this.update(void 0,this.value)}),n.each(n.extend({},r._handlers,r.handlers),function(t,i){f.bind(t,n.proxy(i,r))}),e=0;e<this.shortcuts.length;e++)u=this.shortcuts[e],u.callback=n.proxy(u.callback||function(){this.exec()},this),u.description||(u.description=this.title),f.shortcut(u);this.disableOnSearch&&f.bind("search searchend",function(n){r._disabled=n.type=="search";r.update(void 0,r.value)});this.init()};this.init=function(){};this.exec=function(){return n.Deferred().reject()};this.disabled=function(){return this.state<0};this.enabled=function(){return this.state>-1};this.active=function(){return this.state>0};this.getstate=function(){return-1};this.update=function(n,t){var i=this.state,r=this.value;this.state=this._disabled?-1:n!==void 0?n:this.getstate();this.value=t;(i!=this.state||r!=this.value)&&this.change()};this.change=function(n){var i,t;if(typeof n=="function")this.listeners.push(n);else for(t=0;t<this.listeners.length;t++){i=this.listeners[t];try{i(this.state,this.value)}catch(r){this.fm.debug("error",r)}}return this};this.hashes=function(i){return i?n.map(n.isArray(i)?i:[i],function(n){return t.file(n)?n:null}):t.selected()};this.files=function(t){var i=this.fm;return t?n.map(n.isArray(t)?t:[t],function(n){return i.file(n)||null}):i.selectedFiles()}};elFinder.prototype.resources={"class":{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search"},tpl:{perms:'<span class="elfinder-perms"/>',symlink:'<span class="elfinder-symlink"/>',navicon:'<span class="elfinder-nav-icon"/>',navspinner:'<span class="elfinder-navbar-spinner"/>',navdir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon"/>{symlink}{permissions}{name}<\/span><div class="elfinder-navbar-subtree"/><\/div>'},mimes:{text:["application/x-empty","application/javascript","application/xhtml+xml","audio/x-mp3-playlist","application/x-web-config","application/docbook+xml","application/x-php","application/x-perl","application/x-awk","application/x-config","application/x-csh","application/xml"]},mixin:{make:function(){var t=this.fm,e=this.name,o=t.getUI("cwd"),i=n.Deferred().fail(function(n){o.trigger("unselectall");n&&t.error(n)}).always(function(){r.remove();f.remove();t.enable()}),u="tmp_"+parseInt(Math.random()*1e5),s=t.cwd().hash,h=new Date,c={hash:u,name:t.uniqueName(this.prefix),mime:this.mime,read:!0,write:!0,date:"Today "+h.getHours()+":"+h.getMinutes()},f=o.trigger("create."+t.namespace,c).find("#"+u),r=n('<input type="text"/>').keydown(function(t){t.stopImmediatePropagation();t.keyCode==n.ui.keyCode.ESCAPE?i.reject():t.keyCode==n.ui.keyCode.ENTER&&r.blur()}).mousedown(function(n){n.stopPropagation()}).blur(function(){var f=n.trim(r.val()),o=r.parent();if(o.length){if(!f)return i.reject("errInvName");if(t.fileByName(f,s))return i.reject(["errExists",f]);o.html(t.escape(f));t.lockfiles({files:[u]});t.request({data:{cmd:e,name:f,target:s},notify:{type:e,cnt:1},preventFail:!0,syncOnFail:!0}).fail(function(n){i.reject(n)}).done(function(n){i.resolve(n)})}});return this.disabled()||!f.length?i.reject():(t.disable(),f.find(".elfinder-cwd-filename").empty("").append(r.val(c.name)),r.select().focus(),i)}}};n.fn.dialogelfinder=function(t){var u="elfinderPosition",f="elfinderDestroyOnClose",i;if(this.not(".elfinder").each(function(){var e=n(document),r=n('<div class="ui-widget-header dialogelfinder-drag ui-corner-top">'+(t.title||"Files")+"<\/div>"),o=n('<a href="#" class="dialogelfinder-drag-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/><\/a>').appendTo(r).click(function(n){n.preventDefault();i.dialogelfinder("close")}),i=n(this).addClass("dialogelfinder").css("position","absolute").hide().appendTo("body").draggable({handle:".dialogelfinder-drag",containment:"window"}).elfinder(t).prepend(r),s=i.elfinder("instance");i.width(parseInt(i.width())||840).data(f,!!t.destroyOnClose).find(".elfinder-toolbar").removeClass("ui-corner-top");t.position&&i.data(u,t.position);t.autoOpen!==!1&&n(this).dialogelfinder("open")}),t=="open"){var i=n(this),e=i.data(u)||{top:parseInt(n(document).scrollTop()+(n(window).height()<i.height()?2:(n(window).height()-i.height())/2)),left:parseInt(n(document).scrollLeft()+(n(window).width()<i.width()?2:(n(window).width()-i.width())/2))},r=100;i.is(":hidden")&&(n("body").find(":visible").each(function(){var t=n(this),u;this!==i[0]&&t.css("position")=="absolute"&&(u=parseInt(t.zIndex()))>r&&(r=u+1)}),i.zIndex(r).css(e).show().trigger("resize"),setTimeout(function(){i.trigger("resize").mousedown()},200))}else if(t=="close")i=n(this),i.is(":visible")&&(!i.data(f)?i.elfinder("close"):i.elfinder("destroy").remove());else if(t=="instance")return n(this).getElFinder();return this};elFinder&&elFinder.prototype&&typeof elFinder.prototype.i18=="object"&&(elFinder.prototype.i18.en={translator:"Troex Nevelin &lt;troex@fury.scancode.ru&gt;",language:"English",direction:"ltr",dateFormat:"M d, Y h:i A",fancyDateFormat:"$1 h:i A",messages:{error:"Error",errUnknown:"Unknown error.",errUnknownCmd:"Unknown command.",errJqui:"Invalid jQuery UI configuration. Selectable, draggable and droppable components must be included.",errNode:"elFinder requires DOM Element to be created.",errURL:"Invalid elFinder configuration! URL option is not set.",errAccess:"Access denied.",errConnect:"Unable to connect to backend.",errAbort:"Connection aborted.",errTimeout:"Connection timeout.",errNotFound:"Backend not found.",errResponse:"Invalid backend response.",errConf:"Invalid backend configuration.",errJSON:"PHP JSON module not installed.",errNoVolumes:"Readable volumes not available.",errCmdParams:'Invalid parameters for command "$1".',errDataNotJSON:"Data is not JSON.",errDataEmpty:"Data is empty.",errCmdReq:"Backend request requires command name.",errOpen:'Unable to open "$1".',errNotFolder:"Object is not a folder.",errNotFile:"Object is not a file.",errRead:'Unable to read "$1".',errWrite:'Unable to write into "$1".',errPerm:"Permission denied.",errLocked:'"$1" is locked and can not be renamed, moved or removed.',errExists:'File named "$1" already exists.',errInvName:"Invalid file name.",errFolderNotFound:"Folder not found.",errFileNotFound:"File not found.",errTrgFolderNotFound:'Target folder "$1" not found.',errPopup:"Browser prevented opening popup window. To open file enable it in browser options.",errMkdir:'Unable to create folder "$1".',errMkfile:'Unable to create file "$1".',errRename:'Unable to rename "$1".',errCopyFrom:'Copying files from volume "$1" not allowed.',errCopyTo:'Copying files to volume "$1" not allowed.',errUpload:"Upload error.",errUploadFile:'Unable to upload "$1".',errUploadNoFiles:"No files found for upload.",errUploadTotalSize:"Data exceeds the maximum allowed size.",errUploadFileSize:"File exceeds maximum allowed size.",errUploadMime:"File type not allowed.",errUploadTransfer:'"$1" transfer error.',errNotReplace:'Object "$1" already exists at this location and can not be replaced by object with another type.',errReplace:'Unable to replace "$1".',errSave:'Unable to save "$1".',errCopy:'Unable to copy "$1".',errMove:'Unable to move "$1".',errCopyInItself:'Unable to copy "$1" into itself.',errRm:'Unable to remove "$1".',errRmSrc:"Unable remove source file(s).",errExtract:'Unable to extract files from "$1".',errArchive:"Unable to create archive.",errArcType:"Unsupported archive type.",errNoArchive:"File is not archive or has unsupported archive type.",errCmdNoSupport:"Backend does not support this command.",errReplByChild:"The folder “$1” can’t be replaced by an item it contains.",errArcSymlinks:"For security reason denied to unpack archives contains symlinks or files with not allowed names.",errArcMaxSize:"Archive files exceeds maximum allowed size.",errResize:'Unable to resize "$1".',errUsupportType:"Unsupported file type.",errNotUTF8Content:'File "$1" is not in UTF-8 and cannot be edited.',errNetMount:'Unable to mount "$1".',errNetMountNoDriver:"Unsupported protocol.",errNetMountFailed:"Mount failed.",errNetMountHostReq:"Host required.",errSessionExpires:"Your session has expired due to inactivity.",errCreatingTempDir:'Unable to create temporary directory: "$1"',errFtpDownloadFile:'Unable to download file from FTP: "$1"',errFtpUploadFile:'Unable to upload file to FTP: "$1"',errFtpMkdir:'Unable to create remote directory on FTP: "$1"',errArchiveExec:'Error while archiving files: "$1"',errExtractExec:'Error while extracting files: "$1"',cmdarchive:"Create archive",cmdback:"Back",cmdcopy:"Copy",cmdcut:"Cut",cmddownload:"Download",cmdduplicate:"Duplicate",cmdedit:"Edit file",cmdextract:"Extract files from archive",cmdforward:"Forward",cmdgetfile:"Select files",cmdhelp:"About this software",cmdhome:"Home",cmdinfo:"Get info",cmdmkdir:"New folder",cmdmkfile:"New text file",cmdopen:"Open",cmdpaste:"Paste",cmdquicklook:"Preview",cmdreload:"Reload",cmdrename:"Rename",cmdrm:"Delete",cmdsearch:"Find files",cmdup:"Go to parent directory",cmdupload:"Upload files",cmdview:"View",cmdresize:"Resize & Rotate",cmdsort:"Sort",cmdnetmount:"Mount network volume",btnClose:"Close",btnSave:"Save",btnRm:"Remove",btnApply:"Apply",btnCancel:"Cancel",btnNo:"No",btnYes:"Yes",btnMount:"Mount",ntfopen:"Open folder",ntffile:"Open file",ntfreload:"Reload folder content",ntfmkdir:"Creating directory",ntfmkfile:"Creating files",ntfrm:"Delete files",ntfcopy:"Copy files",ntfmove:"Move files",ntfprepare:"Prepare to copy files",ntfrename:"Rename files",ntfupload:"Uploading files",ntfdownload:"Downloading files",ntfsave:"Save files",ntfarchive:"Creating archive",ntfextract:"Extracting files from archive",ntfsearch:"Searching files",ntfresize:"Resizing images",ntfsmth:"Doing something",ntfloadimg:"Loading image",ntfnetmount:"Mounting network volume",dateUnknown:"unknown",Today:"Today",Yesterday:"Yesterday",Jan:"Jan",Feb:"Feb",Mar:"Mar",Apr:"Apr",May:"May",Jun:"Jun",Jul:"Jul",Aug:"Aug",Sep:"Sep",Oct:"Oct",Nov:"Nov",Dec:"Dec",sortname:"by name",sortkind:"by kind",sortsize:"by size",sortdate:"by date",sortFoldersFirst:"Folders first",confirmReq:"Confirmation required",confirmRm:"Are you sure you want to remove files?<br/>This cannot be undone!",confirmRepl:"Replace old file with new one?",apllyAll:"Apply to all",name:"Name",size:"Size",perms:"Permissions",modify:"Modified",kind:"Kind",read:"read",write:"write",noaccess:"no access",and:"and",unknown:"unknown",selectall:"Select all files",selectfiles:"Select file(s)",selectffile:"Select first file",selectlfile:"Select last file",viewlist:"List view",viewicons:"Icons view",places:"Places",calc:"Calculate",path:"Path",aliasfor:"Alias for",locked:"Locked",dim:"Dimensions",files:"Files",folders:"Folders",items:"Items",yes:"yes",no:"no",link:"Link",searcresult:"Search results",selected:"selected items",about:"About",shortcuts:"Shortcuts",help:"Help",webfm:"Web file manager",ver:"Version",protocolver:"protocol version",homepage:"Project home",docs:"Documentation",github:"Fork us on Github",twitter:"Follow us on twitter",facebook:"Join us on facebook",team:"Team",chiefdev:"chief developer",developer:"developer",contributor:"contributor",maintainer:"maintainer",translator:"translator",icons:"Icons",dontforget:"and don't forget to take your towel",shortcutsof:"Shortcuts disabled",dropFiles:"Drop files here",dropFilesBrowser:"Drop or paste files from browser",or:"or",selectForUpload:"Select files to upload",moveFiles:"Move files",copyFiles:"Copy files",rmFromPlaces:"Remove from places",aspectRatio:"Aspect ratio",scale:"Scale",width:"Width",height:"Height",resize:"Resize",crop:"Crop",rotate:"Rotate","rotate-cw":"Rotate 90 degrees CW","rotate-ccw":"Rotate 90 degrees CCW",degree:"°",netMountDialogTitle:"Mount network volume",protocol:"Protocol",host:"Host",port:"Port",user:"User",pass:"Password",kindUnknown:"Unknown",kindFolder:"Folder",kindAlias:"Alias",kindAliasBroken:"Broken alias",kindApp:"Application",kindPostscript:"Postscript document",kindMsOffice:"Microsoft Office document",kindMsWord:"Microsoft Word document",kindMsExcel:"Microsoft Excel document",kindMsPP:"Microsoft Powerpoint presentation",kindOO:"Open Office document",kindAppFlash:"Flash application",kindPDF:"Portable Document Format (PDF)",kindTorrent:"Bittorrent file",kind7z:"7z archive",kindTAR:"TAR archive",kindGZIP:"GZIP archive",kindBZIP:"BZIP archive",kindZIP:"ZIP archive",kindRAR:"RAR archive",kindJAR:"Java JAR file",kindTTF:"True Type font",kindOTF:"Open Type font",kindRPM:"RPM package",kindText:"Text document",kindTextPlain:"Plain text",kindPHP:"PHP source",kindCSS:"Cascading style sheet",kindHTML:"HTML document",kindJS:"Javascript source",kindRTF:"Rich Text Format",kindC:"C source",kindCHeader:"C header source",kindCPP:"C++ source",kindCPPHeader:"C++ header source",kindShell:"Unix shell script",kindPython:"Python source",kindJava:"Java source",kindRuby:"Ruby source",kindPerl:"Perl script",kindSQL:"SQL source",kindXML:"XML document",kindAWK:"AWK source",kindCSV:"Comma separated values",kindDOCBOOK:"Docbook XML document",kindImage:"Image",kindBMP:"BMP image",kindJPEG:"JPEG image",kindGIF:"GIF Image",kindPNG:"PNG Image",kindTIFF:"TIFF image",kindTGA:"TGA image",kindPSD:"Adobe Photoshop image",kindXBITMAP:"X bitmap image",kindPXM:"Pixelmator image",kindAudio:"Audio media",kindAudioMPEG:"MPEG audio",kindAudioMPEG4:"MPEG-4 audio",kindAudioMIDI:"MIDI audio",kindAudioOGG:"Ogg Vorbis audio",kindAudioWAV:"WAV audio",AudioPlaylist:"MP3 playlist",kindVideo:"Video media",kindVideoDV:"DV movie",kindVideoMPEG:"MPEG movie",kindVideoMPEG4:"MPEG-4 movie",kindVideoAVI:"AVI movie",kindVideoMOV:"Quick Time movie",kindVideoWM:"Windows Media movie",kindVideoFlash:"Flash movie",kindVideoMKV:"Matroska movie",kindVideoOGG:"Ogg movie"}});n.fn.elfinderbutton=function(t){return this.each(function(){var e="class",o=t.fm,u=o.res(e,"disabled"),h=o.res(e,"active"),f=o.res(e,"hover"),s="elfinder-button-menu-item",l="elfinder-button-menu-item-selected",r,i=n(this).addClass("ui-state-default elfinder-button").attr("title",t.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+t.name+'"/>').hover(function(n){i.is("."+u)||i[n.type=="mouseleave"?"removeClass":"addClass"](f)}).click(function(n){i.is("."+u)||(r&&t.variants.length>1?(r.is(":hidden")&&t.fm.getUI().click(),n.stopPropagation(),r.slideToggle(100)):t.exec())}),c=function(){r.hide()};n.isArray(t.variants)&&(i.addClass("elfinder-menubutton"),r=n('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(i).zIndex(12+i.zIndex()).delegate("."+s,"hover",function(){n(this).toggleClass(f)}).delegate("."+s,"click",function(r){r.preventDefault();r.stopPropagation();i.removeClass(f);t.exec(t.fm.selected(),n(this).data("value"))}),t.fm.bind("disable select",c).getUI().click(c),t.change(function(){r.html("");n.each(t.variants,function(i,u){r.append(n('<div class="'+s+'">'+u[1]+"<\/div>").data("value",u[0]).addClass(u[0]==t.value?l:""))})}));t.change(function(){t.disabled()?i.removeClass(h+" "+f).addClass(u):(i.removeClass(u),i[t.active()?"addClass":"removeClass"](h))}).change()})};n.fn.elfindercontextmenu=function(t){return this.each(function(){var i=n(this).addClass("ui-helper-reset ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+t.direction).hide().appendTo("body").delegate(".elfinder-contextmenu-item","mouseenter mouseleave",function(){n(this).toggleClass("ui-state-hover")}),f=t.direction=="ltr"?"left":"right",e=n.extend({},t.options.contextmenu),o='<div class="elfinder-contextmenu-item"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"/><span>{label}<\/span><\/div>',u=function(t,i,r){return n(o.replace("{icon}",i?"elfinder-button-icon-"+i:"").replace("{label}",t)).click(function(n){n.stopPropagation();n.stopPropagation();r()})},s=function(r,u){var o=n(window),h=i.outerWidth(),s=i.outerHeight(),c=o.width(),l=o.height(),a=o.scrollTop(),v=o.scrollLeft(),e={top:(u+s<l?u:u-s>0?u-s:u)+a,left:(r+h<c?r:r-h)+v,"z-index":100+t.getUI("workzone").zIndex()};i.css(e).show();e={"z-index":e["z-index"]+10};e[f]=parseInt(i.width());i.find(".elfinder-contextmenu-sub").css(e)},r=function(){i.hide().empty()},h=function(f,o){var s=!1;n.each(e[f]||[],function(f,e){var h,c,l;if(e=="|"&&s){i.append('<div class="elfinder-contextmenu-separator"/>');s=!1;return}if(h=t.command(e),h&&h.getstate(o)!=-1){if(h.variants){if(!h.variants.length)return;c=u(h.title,h.name,function(){});l=n('<div class="ui-corner-all elfinder-contextmenu-sub"/>').appendTo(c.append('<span class="elfinder-contextmenu-arrow"/>'));c.addClass("elfinder-contextmenu-group").hover(function(){l.toggle()});n.each(h.variants,function(t,i){l.append(n('<div class="elfinder-contextmenu-item"><span>'+i[1]+"<\/span><\/div>").click(function(n){n.stopPropagation();r();h.exec(o,i[0])}))})}else c=u(h.title,h.name,function(){r();h.exec(o)});i.append(c);s=!0}})},c=function(t){n.each(t,function(n,t){var f;t.label&&typeof t.callback=="function"&&(f=u(t.label,t.icon,function(){r();t.callback()}),i.append(f))})};t.one("load",function(){t.bind("contextmenu",function(n){var t=n.data;r();t.type&&t.targets?h(t.type,t.targets):t.raw&&c(t.raw);i.children().length&&s(t.x,t.y)}).one("destroy",function(){i.remove()}).bind("disable select",r).getUI().click(r)})})};n.fn.elfindercwd=function(t,i){return this.not(".elfinder-cwd").each(function(){var f=t.viewType=="list",o="select."+t.namespace,w="unselect."+t.namespace,vt="disable."+t.namespace,yt="enable."+t.namespace,p="class",b=t.res(p,"cwdfile"),s="."+b,h="ui-selected",c=t.res(p,"disabled"),ot=t.res(p,"draggable"),st=t.res(p,"droppable"),ht=t.res(p,"hover"),nt=t.res(p,"adroppable"),pt=b+"-tmp",gt=t.options.loadTmbs>0?t.options.loadTmbs:5,a="",tt=[],ni={icon:'<div id="{hash}" class="'+b+' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on" {style}/>{marker}<\/div><div class="elfinder-cwd-filename" title="{name}">{name}<\/div><\/div>',row:'<tr id="{hash}" class="'+b+' {permsclass} {dirclass}" title="{tooltip}"><td><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"/>{marker}<span class="elfinder-cwd-filename">{name}<\/span><\/div><\/td><td>{perms}<\/td><td>{date}<\/td><td>{size}<\/td><td>{kind}<\/td><\/tr>'},ti=t.res("tpl","perms"),ii=t.res("tpl","symlink"),wt={permsclass:function(n){return t.perms2class(n)},perms:function(n){return t.formatPermissions(n)},dirclass:function(n){return n.mime=="directory"?"directory":""},mime:function(n){return t.mime2class(n.mime)},size:function(n){return t.formatSize(n.size)},date:function(n){return t.formatDate(n)},kind:function(n){return t.mime2kind(n)},marker:function(n){return(n.alias||n.mime=="symlink-broken"?ii:"")+(!n.read||!n.write?ti:"")},tooltip:function(n){var i=t.formatDate(n)+(n.size>0?" ("+t.formatSize(n.size)+")":"");return n.tooltip?t.escape(n.tooltip).replace(/"/g,"&quot;").replace(/\r/g,"&#13;")+"&#13;"+i:i}},k=function(n){return n.name=t.escape(n.name),ni[f?"row":"icon"].replace(/\{([a-z]+)\}/g,function(t,i){return wt[i]?wt[i](n):n[i]?n[i]:""})},it=!1,ri=function(t,i){function k(n,t){return n[t+"All"]("[id]:not(."+c+"):not(.elfinder-cwd-parent):first")}var v=n.ui.keyCode,l=t==v.LEFT||t==v.UP,p=r.find("[id]."+h),d=l?"first:":"last",s,u,a,y,b;if(p.length)if(s=p.filter(l?":first":":last"),a=k(s,l?"prev":"next"),a.length)if(f||t==v.LEFT||t==v.RIGHT)u=a;else if(y=s.position().top,b=s.position().left,u=s,l){do u=u.prev("[id]");while(u.length&&!(u.position().top<y&&u.position().left<=b));u.is("."+c)&&(u=k(u,"next"))}else{do u=u.next("[id]");while(u.length&&!(u.position().top>y&&u.position().left>=b));u.is("."+c)&&(u=k(u,"prev"));u.length||(a=r.find("[id]:not(."+c+"):last"),a.position().top>y&&(u=a))}else u=s;else u=r.find("[id]:not(."+c+"):not(.elfinder-cwd-parent):"+(l?"last":"first"));u&&u.length&&!u.is(".elfinder-cwd-parent")&&(i?u=s.add(s[l?"prevUntil":"nextUntil"]("#"+u.attr("id"))).add(u):p.trigger(w),u.trigger(o),ut(u.filter(l?":first":":last")),e())},v=[],rt=function(n){r.find("#"+n).trigger(o)},ui=function(){var i=t.cwd().hash;r.find("[id]:not(."+h+"):not(.elfinder-cwd-parent)").trigger(o);v=n.map(t.files(),function(n){return n.phash==i?n.hash:null});e()},y=function(){v=[];r.find("[id]."+h).trigger(w);e()},hi=function(){return v},e=function(){t.trigger("select",{selected:v})},ut=function(n){var t=n.position().top,i=n.outerHeight(!0),r=u.scrollTop(),f=u.innerHeight();t+i>r+f?u.scrollTop(parseInt(t+i-f)):t<r&&u.scrollTop(t)},l=[],bt=function(n){for(var t=l.length;t--;)if(l[t].hash==n)return t;return-1},ct="scroll."+t.namespace,fi=function(){var s=[],c=!1,e=[],a={},i=r.find("[id]:last"),w=!i.length,y=f?r.children("table").children("tbody"):r,p;if(!l.length)return u.unbind(ct);while((!i.length||i.position().top<=u.height()+u.scrollTop()+t.options.showThreshold)&&(p=l.splice(0,t.options.showFiles)).length)s=n.map(p,function(n){return n.hash&&n.name?(n.mime=="directory"&&(c=!0),n.tmb&&(n.tmb===1?e.push(n.hash):a[n.hash]=n.tmb),k(n)):null}),y.append(s.join("")),i=r.find("[id]:last"),w&&r.scrollTop(0);ft(a);e.length&&et(e);c&&kt();v.length&&y.find("[id]:not(."+h+"):not(.elfinder-cwd-parent)").each(function(){var t=this.id;n.inArray(t,v)!==-1&&n(this).trigger(o)})},ei=n.extend({},t.droppable,{over:function(i,u){var f=t.cwd().hash;n.each(u.helper.data("files"),function(n,i){if(t.file(i).phash==f)return r.removeClass(nt),!1})}}),kt=function(){setTimeout(function(){r.find(".directory:not(."+st+",.elfinder-na,.elfinder-ro)").droppable(t.droppable)},20)},ft=function(i){var e=t.option("tmbUrl"),u=!0,f;return n.each(i,function(t,i){var o=r.find("#"+t);o.length?function(t,i){n("<img/>").load(function(){t.find(".elfinder-cwd-icon").css("background","url('"+i+"') center center no-repeat")}).attr("src",i)}(o,e+i):(u=!1,(f=bt(t))!=-1&&(l[f].tmb=i))}),u},et=function(n){var i=[];if(t.oldAPI){t.request({data:{cmd:"tmb",current:t.cwd().hash},preventFail:!0}).done(function(n){ft(n.images||[])&&n.tmb&&et()});return}i=i=n.splice(0,gt);i.length&&t.request({data:{cmd:"tmb",targets:i},preventFail:!0}).done(function(t){ft(t.images||[])&&et(n)})},lt=function(n){for(var v=f?r.find("tbody"):r,s=n.length,e=[],h={},c=!1,y=function(n){for(var i=r.find("[id]:first"),u;i.length;){if(u=t.file(i.attr("id")),!i.is(".elfinder-cwd-parent")&&u&&t.compare(n,u)<0)return i;i=i.next("[id]")}},p=function(n){for(var r=l.length,i=0;i<r;i++)if(t.compare(n,l[i])<0)return i;return r||-1},i,u,o,a;s--;)(i=n[s],u=i.hash,r.find("#"+u).length)||((o=y(i))&&o.length?o.before(k(i)):(a=p(i))>=0?l.splice(a,0,i):v.append(k(i)),r.find("#"+u).length&&(i.mime=="directory"?c=!0:i.tmb&&(i.tmb===1?e.push(u):h[u]=i.tmb)));ft(h);e.length&&et(e);c&&kt()},at=function(n){for(var u=n.length,i,f,e;u--;)if(i=n[u],(f=r.find("#"+i)).length)try{f.detach()}catch(o){t.debug("error",o)}else(e=bt(i))!=-1&&l.splice(e,1)},d={name:t.i18n("name"),perm:t.i18n("perms"),mod:t.i18n("modify"),size:t.i18n("size"),kind:t.i18n("kind")},g=function(e,o){var h=t.cwd().hash,c;y();try{r.children("table,"+s).remove()}catch(v){r.html("")}r.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(f?"list":"icons"));u[f?"addClass":"removeClass"]("elfinder-cwd-wrapper-list");f&&r.html('<table><thead><tr class="ui-state-default"><td >'+d.name+"<\/td><td>"+d.perm+"<\/td><td>"+d.mod+"<\/td><td>"+d.size+"<\/td><td>"+d.kind+"<\/td><\/tr><\/thead><tbody/><\/table>");l=n.map(e,function(n){return o||n.phash==h?n:null});l=t.sortFiles(l);u.bind(ct,fi).trigger(ct);h=t.cwd().phash;i.oldSchool&&h&&!a&&(c=n.extend(!0,{},t.file(h),{name:"..",mime:"directory"}),c=n(k(c)).addClass("elfinder-cwd-parent").bind("mousedown click mouseup dblclick mouseenter",function(n){n.preventDefault();n.stopPropagation()}).dblclick(function(){t.exec("open",this.id)}),(f?r.find("tbody"):r).prepend(c))},r=n(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable","on").delegate(s,"click."+t.namespace,function(t){var i=this.id?n(this):n(this).parents("[id]:first"),r=i.prevAll("."+h+":first"),u=i.nextAll("."+h+":first"),f=r.length,c=u.length,s;t.stopImmediatePropagation();t.shiftKey&&(f||c)?(s=f?i.prevUntil("#"+r.attr("id")):i.nextUntil("#"+u.attr("id")),s.add(i).trigger(o)):t.ctrlKey||t.metaKey?i.trigger(i.is("."+h)?w:o):(y(),i.trigger(o));e()}).delegate(s,"dblclick."+t.namespace,function(n){t.dblclick({file:this.id});console.log(this);console.log(n)}).delegate(s,"mouseenter."+t.namespace,function(){var i=n(this),r=f?i:i.children();i.is("."+pt)||r.is("."+ot+",."+c)||r.draggable(t.draggable)}).delegate(s,o,function(){var t=n(this),i=t.attr("id");it||t.is("."+c)||(t.addClass(h).children().addClass(ht),n.inArray(i,v)===-1&&v.push(i))}).delegate(s,w,function(){var i=n(this),r=i.attr("id"),t;it||(n(this).removeClass(h).children().removeClass(ht),t=n.inArray(r,v),t!==-1&&v.splice(t,1))}).delegate(s,vt,function(){var t=n(this).removeClass(h).addClass(c),i=(f?t:t.children()).removeClass(ht);t.is("."+st)&&t.droppable("disable");i.is("."+ot)&&i.draggable("disable");f||i.removeClass(c)}).delegate(s,yt,function(){var t=n(this).removeClass(c),i=f?t:t.children();t.is("."+st)&&t.droppable("enable");i.is("."+ot)&&i.draggable("enable")}).delegate(s,"scrolltoview",function(){ut(n(this))}).delegate(s,"hover",function(i){t.trigger("hover",{hash:n(this).attr("id"),type:i.type})}).bind("contextmenu."+t.namespace,function(i){var r=n(i.target).closest("."+b);r.length&&(i.stopPropagation(),i.preventDefault(),r.is("."+c)||(r.is("."+h)||(y(),r.trigger(o),e()),t.trigger("contextmenu",{type:"files",targets:t.selected(),x:i.clientX,y:i.clientY})))}).selectable({filter:s,stop:e,selected:function(t,i){n(i.selected).trigger(o)},unselected:function(t,i){n(i.unselected).trigger(w)}}).droppable(ei).bind("create."+t.namespace,function(t,i){var u=f?r.find("tbody"):r,e=u.find(".elfinder-cwd-parent"),i=n(k(i)).addClass(pt);y();e.length?e.after(i):u.prepend(i);r.scrollTop(0)}).bind("unselectall",y).bind("selectfile",function(n,t){r.find("#"+t).trigger(o);e()}),u=n('<div class="elfinder-cwd-wrapper"/>').bind("contextmenu",function(n){n.preventDefault();t.trigger("contextmenu",{type:"cwd",targets:[t.cwd().hash],x:n.clientX,y:n.clientY})}),dt=function(){var t=0;u.siblings(".elfinder-panel:visible").each(function(){t+=n(this).outerHeight(!0)});u.height(si.height()-t)},oi=n(this).parent().resize(dt),si=oi.children(".elfinder-workzone").append(u.append(this));t.dragUpload&&(u[0].addEventListener("dragenter",function(n){n.preventDefault();n.stopPropagation();u.addClass(nt)},!1),u[0].addEventListener("dragleave",function(n){n.preventDefault();n.stopPropagation();n.target==r[0]&&u.removeClass(nt)},!1),u[0].addEventListener("dragover",function(n){n.preventDefault();n.stopPropagation()},!1),u[0].addEventListener("drop",function(n){n.preventDefault();u.removeClass(nt);var i=!1,r="";n.dataTransfer&&n.dataTransfer.files&&n.dataTransfer.files.length?(i=n.dataTransfer.files,r="files"):n.dataTransfer.getData("text/html")?(i=[n.dataTransfer.getData("text/html")],r="html"):n.dataTransfer.getData("text")&&(i=[n.dataTransfer.getData("text")],r="text");i&&t.exec("upload",{files:i,type:r})},!1));t.bind("open",function(n){g(n.data.files)}).bind("search",function(n){tt=n.data.files;g(tt,!0)}).bind("searchend",function(){tt=[];a&&(a="",g(t.files()))}).bind("searchstart",function(n){a=n.data.query}).bind("sortchange",function(){g(a?tt:t.files(),!!a)}).bind("viewchange",function(){var r=t.selected(),i=t.storage("view")=="list";i!=f&&(f=i,g(t.files()),n.each(r,function(n,t){rt(t)}),e());dt()}).add(function(i){var r=t.cwd().hash,u=a?n.map(i.data.added||[],function(n){return n.name.indexOf(a)===-1?null:n}):n.map(i.data.added||[],function(n){return n.phash==r?n:null});lt(u)}).change(function(i){var u=t.cwd().hash,r=t.selected();a?n.each(i.data.changed||[],function(t,i){at([i.hash]);i.name.indexOf(a)!==-1&&(lt([i]),n.inArray(i.hash,r)!==-1&&rt(i.hash))}):n.each(n.map(i.data.changed||[],function(n){return n.phash==u?n:null}),function(t,i){at([i.hash]);lt([i]);n.inArray(i.hash,r)!==-1&&rt(i.hash)});e()}).remove(function(n){at(n.data.removed||[]);e()}).bind("open add search searchend",function(){r.css("height","auto");r.outerHeight(!0)<u.height()&&r.height(u.height()-(r.outerHeight(!0)-r.height())-2)}).dragstart(function(t){var i=n(t.data.target),u=t.data.originalEvent;i.is(s)&&(i.is("."+h)||(u.ctrlKey||u.metaKey||u.shiftKey||y(),i.trigger(o),e()),r.droppable("disable"));r.selectable("disable").removeClass(c);it=!0}).dragstop(function(){r.selectable("enable").droppable("enable");it=!1}).bind("lockfiles unlockfiles",function(n){for(var u=n.type=="lockfiles"?vt:yt,t=n.data.files||[],i=t.length;i--;)r.find("#"+t[i]).trigger(u);e()}).bind("mkdir mkfile duplicate upload rename archive extract",function(i){var r=t.cwd().hash;y();n.each(i.data.added||[],function(n,t){t&&t.phash==r&&rt(t.hash)});e()}).shortcut({pattern:"ctrl+a",description:"selectall",callback:ui}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"selectfiles",type:"keydown",callback:function(n){ri(n.keyCode,n.shiftKey)}}).shortcut({pattern:"home",description:"selectffile",callback:function(){y();ut(r.find("[id]:first").trigger(o));e()}}).shortcut({pattern:"end",description:"selectlfile",callback:function(){y();ut(r.find("[id]:last").trigger(o));e()}})}),this};n.fn.elfinderdialog=function(t){var i;return typeof t=="string"&&(i=this.closest(".ui-dialog")).length&&(t=="open"?i.css("display")=="none"&&i.fadeIn(120,function(){i.trigger("open")}):t=="close"?i.css("display")!="none"&&i.hide().trigger("close"):t=="destroy"?i.hide().remove():t=="toTop"&&i.trigger("totop")),t=n.extend({},n.fn.elfinderdialog.defaults,t),this.filter(":not(.ui-dialog-content)").each(function(){var u=n(this).addClass("ui-dialog-content ui-widget-content"),r=u.parent(),f="elfinder-dialog-active",e="elfinder-dialog",h="elfinder-dialog-notify",c="ui-state-hover",l=parseInt(Math.random()*1e6),a=r.children(".elfinder-overlay"),o=n('<div class="ui-dialog-buttonset"/>'),y=n('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"/>').append(o),i=n('<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog  '+e+" "+t.cssClass+'"/>').hide().append(u).appendTo(r).draggable({handle:".ui-dialog-titlebar",containment:"document"}).css({width:t.width,height:t.height}).mousedown(function(t){t.stopPropagation();n(document).mousedown();i.is("."+f)||(r.find("."+e+":visible").removeClass(f),i.addClass(f).zIndex(v()+1))}).bind("open",function(){t.modal&&a.elfinderoverlay("show");i.trigger("totop");typeof t.open=="function"&&n.proxy(t.open,u[0])();i.is("."+h)||r.find("."+e+":visible").not("."+h).each(function(){var t=n(this),r=parseInt(t.css("top")),u=parseInt(t.css("left")),f=parseInt(i.css("top")),e=parseInt(i.css("left"));t[0]!=i[0]&&(r==f||u==e)&&i.css({top:r+10+"px",left:u+10+"px"})})}).bind("close",function(){var f=r.find(".elfinder-dialog:visible"),e=v();t.modal&&a.elfinderoverlay("hide");f.length?f.each(function(){var t=n(this);if(t.zIndex()>=e)return t.trigger("totop"),!1}):setTimeout(function(){r.mousedown().click()},10);typeof t.close=="function"?n.proxy(t.close,u[0])():t.destroyOnClose&&i.hide().remove()}).bind("totop",function(){n(this).mousedown().find(".ui-button:first").focus().end().find(":text:first").focus()}),v=function(){var t=r.zIndex()+10;return r.find("."+e+":visible").each(function(){var r;this!=i[0]&&(r=n(this).zIndex(),r>t&&(t=r))}),t},s;t.position||(s=parseInt((r.height()-i.outerHeight())/2-42),t.position={top:(s>0?s:0)+"px",left:parseInt((r.width()-i.outerWidth())/2)+"px"});i.css(t.position);t.closeOnEscape&&n(document).bind("keyup."+l,function(t){t.keyCode==n.ui.keyCode.ESCAPE&&i.is("."+f)&&(u.elfinderdialog("close"),n(document).unbind("keyup."+l))});i.prepend(n('<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+t.title+"<\/div>").prepend(n('<a href="#" class="ui-dialog-titlebar-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/><\/a>').mousedown(function(n){n.preventDefault();u.elfinderdialog("close")})));n.each(t.buttons,function(t,i){var r=n('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+t+"<\/span><\/button>").click(n.proxy(i,u[0])).hover(function(t){n(this)[t.type=="mouseenter"?"focus":"blur"]()}).focus(function(){n(this).addClass(c)}).blur(function(){n(this).removeClass(c)}).keydown(function(t){var i;t.keyCode==n.ui.keyCode.ENTER?n(this).click():t.keyCode==n.ui.keyCode.TAB&&(i=n(this).next(".ui-button"),i.length?i.focus():n(this).parent().children(".ui-button:first").focus())});o.append(r)});o.children().length&&i.append(y);t.resizable&&n.fn.resizable&&i.resizable({minWidth:t.minWidth,minHeight:t.minHeight,alsoResize:this});typeof t.create=="function"&&n.proxy(t.create,this)();t.autoOpen&&u.elfinderdialog("open")}),this};n.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:!1,resizable:!0,autoOpen:!0,closeOnEscape:!0,destroyOnClose:!1,buttons:{},position:null,width:320,height:"auto",minWidth:200,minHeight:110};n.fn.elfindernavbar=function(t,i){return this.not(".elfinder-navbar").each(function(){var r=n(this).addClass("ui-state-default elfinder-navbar"),e=r.parent().resize(function(){r.height(o.height()-s)}),o=e.children(".elfinder-workzone").append(r),s=r.outerHeight()-r.height(),u=t.direction=="ltr",f;if(n.fn.resizable){f=r.resizable({handles:u?"e":"w",minWidth:i.minWidth||150,maxWidth:i.maxWidth||500}).bind("resize scroll",function(){var n=t.UA.Opera&&r.scrollLeft()?20:2;f.css({top:parseInt(r.scrollTop())+"px",left:u?"auto":parseInt(r.scrollLeft()+n),right:u?parseInt(r.scrollLeft()-n)*-1:"auto"})}).find(".ui-resizable-handle").zIndex(r.zIndex()+10);u||r.resize(function(){r.css("left",null).css("right",0)});t.one("open",function(){setTimeout(function(){r.trigger("resize")},150)})}}),this};n.fn.elfinderoverlay=function(t){if(this.filter(":not(.elfinder-overlay)").each(function(){t=n.extend({},t);n(this).addClass("ui-widget-overlay elfinder-overlay").hide().mousedown(function(n){n.preventDefault();n.stopPropagation()}).data({cnt:0,show:typeof t.show=="function"?t.show:function(){},hide:typeof t.hide=="function"?t.hide:function(){}})}),t=="show"){var i=this.eq(0),r=i.data("cnt")+1,u=i.data("show");i.data("cnt",r);i.is(":hidden")&&(i.zIndex(i.parent().zIndex()+1),i.show(),u())}if(t=="hide"){var i=this.eq(0),r=i.data("cnt")-1,f=i.data("hide");i.data("cnt",r);r==0&&i.is(":visible")&&(i.hide(),f())}return this};n.fn.elfinderpanel=function(t){return this.each(function(){var i=n(this).addClass("elfinder-panel ui-state-default ui-corner-all"),r="margin-"+(t.direction=="ltr"?"left":"right");t.one("load",function(){var n=t.getUI("navbar");i.css(r,parseInt(n.outerWidth(!0)));n.bind("resize",function(){i.is(":visible")&&i.css(r,parseInt(n.outerWidth(!0)))})})})};n.fn.elfinderpath=function(t){return this.each(function(){var i=n(this).addClass("elfinder-path").html("&nbsp;").delegate("a","click",function(i){var r=n(this).attr("href").substr(1);i.preventDefault();r!=t.cwd().hash&&t.exec("open",r)}).prependTo(t.getUI("statusbar").show());t.bind("open searchend",function(){var r=[];n.each(t.parents(t.cwd().hash),function(n,i){r.push('<a href="#'+i+'">'+t.escape(t.file(i).name)+"<\/a>")});i.html(r.join(t.option("separator")))}).bind("search",function(){i.html(t.i18n("searcresult"))})})};n.fn.elfinderplaces=function(t,i){return this.each(function(){var r=[],u="class",h=t.res(u,"navdir"),l=t.res(u,"navcollapse"),a=t.res(u,"navexpand"),tt=t.res(u,"hover"),w=t.res(u,"treeroot"),d=t.res("tpl","navdir"),g=t.res("tpl","perms"),v=n(t.res("tpl","navspinner")),nt=function(n){return n.substr(6)},b=function(n){return"place-"+n},f=function(){t.storage("places",r.join(","))},k=function(i){return n(d.replace(/\{id\}/,b(i.hash)).replace(/\{name\}/,t.escape(i.name)).replace(/\{cssclass\}/,t.perms2class(i)).replace(/\{permissions\}/,!i.read||!i.write?g:"").replace(/\{symlink\}/,""))},y=function(i){var u=k(i);o.children().length&&n.each(o.children(),function(){var t=n(this);if(i.name.localeCompare(t.children("."+h).text())<0)return!u.insertBefore(t)});r.push(i.hash);u.parent().length||o.append(u);e.addClass(l);u.draggable({appendTo:"body",revert:!1,helper:function(){var i=n(this);return i.children().removeClass("ui-state-hover"),n('<div class="elfinder-place-drag elfinder-'+t.direction+'"/>').append(i.clone()).data("hash",nt(i.children(":first").attr("id")))},start:function(){n(this).hide()},stop:function(t,i){var o=s.offset().top,u=s.offset().left,h=s.width(),l=s.height(),e=t.clientX,r=t.clientY;e>u&&e<u+h&&r>o&&r<r+l?n(this).show():(c(i.helper.data("hash")),f())}})},c=function(t){var i=n.inArray(t,r);i!==-1&&(r.splice(i,1),o.find("#"+b(t)).parent().remove(),o.children().length||e.removeClass(l+" "+a))},it=function(){o.empty();e.removeClass(l+" "+a)},p=k({hash:"root-"+t.namespace,name:t.i18n(i.name,"places"),read:!0,write:!0}),e=p.children("."+h).addClass(w).click(function(){e.is("."+l)&&(s.toggleClass(a),o.slideToggle(),t.storage("placesState",s.is("."+a)?1:0))}),o=p.children("."+t.res(u,"navsubtree")),s=n(this).addClass(t.res(u,"tree")+" elfinder-places ui-corner-all").hide().append(p).appendTo(t.getUI("navbar")).delegate("."+h,"hover",function(){n(this).toggleClass("ui-state-hover")}).delegate("."+h,"click",function(){t.exec("open",n(this).attr("id").substr(6))}).delegate("."+h+":not(."+w+")","contextmenu",function(i){var r=n(this).attr("id").substr(6);i.preventDefault();t.trigger("contextmenu",{raw:[{label:t.i18n("rmFromPlaces"),icon:"rm",callback:function(){c(r);f()}}],x:i.clientX,y:i.clientY})}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:t.res("class","adroppable"),drop:function(i,u){var e=!0;n.each(u.helper.data("files"),function(i,u){var f=t.file(u);f&&f.mime=="directory"&&n.inArray(f.hash,r)===-1?y(f):e=!1});f();e&&u.helper.hide()}});t.one("load",function(){t.oldAPI||(s.show().parent().show(),r=n.map(t.storage("places").split(","),function(n){return n||null}),r.length&&(e.prepend(v),t.request({data:{cmd:"info",targets:r},preventDefault:!0}).done(function(i){r=[];n.each(i.files,function(n,t){t.mime=="directory"&&y(t)});f();t.storage("placesState")>0&&e.click()}).always(function(){v.remove()})),t.remove(function(t){n.each(t.data.removed,function(n,t){c(t)});f()}).change(function(t){n.each(t.data.changed,function(t,i){n.inArray(i.hash,r)!==-1&&(c(i.hash),i.mime=="directory"&&y(i))});f()}).bind("sync",function(){r.length&&(e.prepend(v),t.request({data:{cmd:"info",targets:r},preventDefault:!0}).done(function(t){n.each(t.files||[],function(t,i){n.inArray(i.hash,r)===-1&&c(i.hash)});f()}).always(function(){v.remove()}))}))})})};n.fn.elfindersearchbutton=function(t){return this.each(function(){var u=!1,i=n(this).hide().addClass("ui-widget-content elfinder-button "+t.fm.res("class","searchbtn")+""),e=function(){var i=n.trim(r.val());i?t.exec(i).done(function(){u=!0;r.focus()}):t.fm.trigger("searchend")},f=function(){r.val("");u&&(u=!1,t.fm.trigger("searchend"))},r=n('<input type="text" size="42"/>').appendTo(i).keypress(function(n){n.stopPropagation()}).keydown(function(n){n.stopPropagation();n.keyCode==13&&e();n.keyCode==27&&(n.preventDefault(),f())});n('<span class="ui-icon ui-icon-search" title="'+t.title+'"/>').appendTo(i).click(e);n('<span class="ui-icon ui-icon-close"/>').appendTo(i).click(f);setTimeout(function(){if(i.parent().detach(),t.fm.getUI("toolbar").prepend(i.show()),t.fm.UA.ltIE7){var n=i.children(t.fm.direction=="ltr"?".ui-icon-close":".ui-icon-search");n.css({right:"",left:parseInt(i.width())-n.outerWidth(!0)})}},200);t.fm.error(function(){r.unbind("keydown")}).select(function(){r.blur()}).bind("searchend",function(){r.val("")}).viewchange(f).shortcut({pattern:"ctrl+f f3",description:t.title,callback:function(){r.select().focus()}})})};n.fn.elfindersortbutton=function(t){return this.each(function(){var i=t.fm,h=t.name,c="class",o=i.res(c,"disabled"),l=i.res(c,"hover"),f="elfinder-button-menu-item",e=f+"-selected",a=e+"-asc",v=e+"-desc",u=n(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-"+h).attr("title",t.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+h+'"/>').hover(function(){u.is("."+o)||u.toggleClass(l)}).click(function(n){u.is("."+o)||(n.stopPropagation(),r.is(":hidden")&&t.fm.getUI().click(),r.slideToggle(100))}),r=n('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(u).zIndex(12+u.zIndex()).delegate("."+f,"hover",function(){n(this).toggleClass(l)}).delegate("."+f,"click",function(n){n.preventDefault();n.stopPropagation();s()}),y=function(){r.children(":not(:last)").removeClass(e+" "+a+" "+v).filter('[rel="'+i.sortType+'"]').addClass(e+" "+(i.sortOrder=="asc"?a:v));r.children(":last").toggleClass(e,i.sortStickFolders)},s=function(){r.hide()};n.each(i.sortRules,function(t){r.append(n('<div class="'+f+'" rel="'+t+'"><span class="ui-icon ui-icon-arrowthick-1-n"/><span class="ui-icon ui-icon-arrowthick-1-s"/>'+i.i18n("sort"+t)+"<\/div>").data("type",t))});r.children().click(function(){var r=n(this).attr("rel");t.exec([],{type:r,order:r==i.sortType?i.sortOrder=="asc"?"desc":"asc":i.sortOrder,stick:i.sortStickFolders})});n('<div class="'+f+" "+f+'-separated"><span class="ui-icon ui-icon-check"/>'+i.i18n("sortFoldersFirst")+"<\/div>").appendTo(r).click(function(){t.exec([],{type:i.sortType,order:i.sortOrder,stick:!i.sortStickFolders})});i.bind("disable select",s).getUI().click(s);i.bind("sortchange",y);r.children().length>1?t.change(function(){u.toggleClass(o,t.disabled());y()}).change():u.addClass(o)})};n.fn.elfinderstat=function(t){return this.each(function(){var r=n(this).addClass("elfinder-stat-size"),i=n('<div class="elfinder-stat-selected"/>'),u=t.i18n("size").toLowerCase(),e=t.i18n("items").toLowerCase(),o=t.i18n("selected"),f=function(i,f){var o=0,s=0;n.each(i,function(n,t){f&&t.phash!=f||(o++,s+=parseInt(t.size)||0)});r.html(e+": "+o+", "+u+": "+t.formatSize(s))};t.getUI("statusbar").prepend(r).append(i).show();t.bind("open reload add remove change searchend",function(){f(t.files(),t.cwd().hash)}).search(function(n){f(n.data.files)}).select(function(){var r=0,e=0,f=t.selectedFiles();if(f.length==1){r=f[0].size;i.html(t.escape(f[0].name)+(r>0?", "+t.formatSize(r):""));return}n.each(f,function(n,t){e++;r+=parseInt(t.size)||0});i.html(e?o+": "+e+", "+u+": "+t.formatSize(r):"&nbsp;")})})};n.fn.elfindertoolbar=function(t,i){return this.not(".elfinder-toolbar").each(function(){var c=t._commands,r=n(this).addClass("ui-helper-clearfix ui-widget-header ui-corner-top elfinder-toolbar"),f=i||[],e=f.length,o,s,u,h;for(r.prev().length&&r.parent().prepend(this);e--;)if(f[e]){for(u=n('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>'),o=f[e].length;o--;)(s=c[f[e][o]])&&(h="elfinder"+s.options.ui,n.fn[h]&&u.prepend(n("<div/>")[h](s)));u.children().length&&r.prepend(u);u.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"/>')}r.children().length&&r.show()}),this};n.fn.elfindertree=function(t,i){var r=t.res("class","tree");return this.not("."+r).each(function(){var f="class",b=t.res(f,"treeroot"),nt=i.openRootOnLoad,h=t.res(f,"navsubtree"),e=t.res(f,"treedir"),o=t.res(f,"navcollapse"),c=t.res(f,"navexpand"),s="elfinder-subtree-loaded",k=t.res(f,"navarrow"),l=t.res(f,"active"),v=t.res(f,"adroppable"),w=t.res(f,"hover"),d=t.res(f,"disabled"),tt=t.res(f,"draggable"),it=t.res(f,"droppable"),rt=function(n){var t=ct.offset().left;return t<=n&&n<=t+ct.width()},lt=t.droppable.drop,at=n.extend(!0,{},t.droppable,{over:function(t){var i=n(this),r=w+" "+v;rt(t.clientX)?(i.addClass(r),i.is("."+o+":not(."+c+")")&&setTimeout(function(){i.is("."+v)&&i.children("."+k).click()},500)):i.removeClass(r)},out:function(){n(this).removeClass(w+" "+v)},drop:function(n,t){rt(n.clientX)&&lt.call(this,n,t)}}),ut=n(t.res("tpl","navspinner")),vt=t.res("tpl","navdir"),yt=t.res("tpl","perms"),pt=t.res("tpl","symlink"),ft={id:function(n){return t.navHash2Id(n.hash)},cssclass:function(n){return(n.phash?"":b)+" "+e+" "+t.perms2class(n)+" "+(n.dirs&&!n.link?o:"")},permissions:function(n){return!n.read||!n.write?yt:""},symlink:function(n){return n.alias?pt:""}},et=function(n){return n.name=t.escape(n.i18||n.name),vt.replace(/(?:\{([a-z]+)\})/ig,function(t,i){return n[i]||(ft[i]?ft[i](n):"")})},y=function(t){return n.map(t||[],function(n){return n.mime=="directory"?n:null})},ot=function(n){return n?u.find("#"+t.navHash2Id(n)).next("."+h):u},st=function(i,r){for(var u=i.children(":first"),f;u.length;){if(f=t.file(t.navId2Hash(u.children("[id]").attr("id"))),(f=t.file(t.navId2Hash(u.children("[id]").attr("id"))))&&r.name.toLowerCase().localeCompare(f.name.toLowerCase())<0)return u;u=u.next()}return n("")},a=function(n){for(var h=n.length,r=[],o=n.length,i,f,e,s;o--;)(i=n[o],u.find("#"+t.navHash2Id(i.hash)).length)||((e=ot(i.phash)).length?(f=et(i),i.phash&&(s=st(e,i)).length?s.before(f):e[i.phash?"append":"prepend"](f)):r.push(i));if(r.length&&r.length<h)return a(r);setTimeout(function(){ht()},10)},p=function(){var r=t.cwd().hash,f=u.find("#"+t.navHash2Id(r)),o,n;if(nt&&(o=u.find("#"+t.navHash2Id(t.root())),o.is("."+s)&&o.addClass(c).next("."+h).show(),nt=!1),f.is("."+l)||(u.find("."+e+"."+l).removeClass(l),f.addClass(l)),i.syncTree){if(f.length)return f.parentsUntil("."+b).filter("."+h).show().prev("."+e).addClass(c);if(t.newAPI){if(n=t.file(r),n&&n.phash&&u.find("#"+t.navHash2Id(n.phash)).length)return a([n]),p();t.request({data:{cmd:"parents",target:r},preventFail:!0}).done(function(n){var i=y(n.tree);a(i);g(i,s);r==t.cwd().hash&&p(!0)})}}},ht=function(){u.find("."+e+":not(."+it+",.elfinder-ro,.elfinder-na)").droppable(at)},g=function(i,r){var f=r==s?"."+o+":not(."+s+")":":not(."+o+")";n.each(i,function(i,e){u.find("#"+t.navHash2Id(e.phash)+f).filter(function(){return n(this).next("."+h).children().length>0}).addClass(r)})},u=n(this).addClass(r).delegate("."+e,"hover",function(i){var r=n(this),u=i.type=="mouseenter";r.is("."+v+" ,."+d)||(u&&!r.is("."+b+",."+tt+",.elfinder-na,.elfinder-wo")&&r.draggable(t.draggable),r.toggleClass(w,u))}).delegate("."+e,"dropover dropout drop",function(t){n(this)[t.type=="dropover"?"addClass":"removeClass"](v+" "+w)}).delegate("."+e,"click",function(){var i=n(this),r=t.navId2Hash(i.attr("id")),u=t.file(r);t.trigger("searchend");r==t.cwd().hash||i.is("."+d)?i.is("."+o)&&i.children("."+k).click():t.exec("open",u.thash||r)}).delegate("."+e+"."+o+" ."+k,"click",function(i){var f=n(this),r=f.parent("."+e),u=r.next("."+h);i.stopPropagation();r.is("."+s)?(r.toggleClass(c),u.slideToggle()):(ut.insertBefore(f),r.removeClass(o),t.request({cmd:"tree",target:t.navId2Hash(r.attr("id"))}).done(function(n){a(y(n.tree));u.children().length&&(r.addClass(o+" "+c),u.slideDown());p()}).always(function(){ut.remove();r.addClass(s)}))}).delegate("."+e,"contextmenu",function(i){i.preventDefault();t.trigger("contextmenu",{type:"navbar",targets:[t.navId2Hash(n(this).attr("id"))],x:i.clientX,y:i.clientY})}),ct=t.getUI("navbar").append(u).show();t.open(function(n){var i=n.data,t=y(i.files);i.init&&u.empty();t.length&&(a(t),g(t,s));p()}).add(function(n){var t=y(n.data.added);t.length&&(a(t),g(t,o))}).change(function(i){for(var w=y(i.data.changed),b=w.length,f,r,k,d,o,g,l,a,v;b--;)if(f=w[b],(r=u.find("#"+t.navHash2Id(f.hash))).length){if(f.phash){if(d=r.closest("."+h),o=ot(f.phash),g=r.parent().next(),l=st(o,f),!o.length)continue;(o[0]!==d[0]||g.get(0)!==l.get(0))&&(l.length?l.before(r):o.append(r))}a=r.is("."+c);v=r.is("."+s);k=n(et(f));r.replaceWith(k.children("."+e));f.dirs&&(a||v)&&(r=u.find("#"+t.navHash2Id(f.hash)))&&r.next("."+h).children().length&&(a&&r.addClass(c),v&&r.addClass(s))}p();ht()}).remove(function(n){for(var f=n.data.removed,l=f.length,i,r;l--;)(i=u.find("#"+t.navHash2Id(f[l]))).length&&(r=i.closest("."+h),i.parent().detach(),r.children().length||r.hide().prev("."+e).removeClass(o+" "+c+" "+s))}).bind("search searchend",function(n){u.find("#"+t.navHash2Id(t.cwd().hash))[n.type=="search"?"removeClass":"addClass"](l)}).bind("lockfiles unlockfiles",function(i){var r=i.type=="lockfiles",f=r?"disable":"enable",e=n.map(i.data.files||[],function(n){var i=t.file(n);return i&&i.mime=="directory"?n:null});n.each(e,function(n,i){var e=u.find("#"+t.navHash2Id(i));e.length&&(e.is("."+tt)&&e.draggable(f),e.is("."+it)&&e.droppable(l),e[r?"addClass":"removeClass"](d))})})}),this};n.fn.elfinderuploadbutton=function(t){return this.each(function(){var u=n(this).elfinderbutton(t).unbind("click"),i=n("<form/>").appendTo(u),r=n('<input type="file" multiple="true"/>').change(function(){var u=n(this);u.val()&&(t.exec({input:u.remove()[0]}),r.clone(!0).appendTo(i))});i.append(r.clone(!0));t.change(function(){i[t.disabled()?"hide":"show"]()}).change()})};n.fn.elfinderviewbutton=function(t){return this.each(function(){var i=n(this).elfinderbutton(t),r=i.children(".elfinder-button-icon");t.change(function(){var n=t.value=="icons";r.toggleClass("elfinder-button-icon-view-list",n);i.attr("title",t.fm.i18n(n?"viewlist":"viewicons"))})})};n.fn.elfinderworkzone=function(){var t="elfinder-workzone";return this.not("."+t).each(function(){var i=n(this).addClass(t),u=i.outerHeight(!0)-i.height(),r=i.parent();r.add(window).bind("resize",function(){var f=r.height();r.children(":visible:not(."+t+")").each(function(){var t=n(this);t.css("position")!="absolute"&&(f-=t.outerHeight(!0))});i.height(f-u)})}),this};elFinder.prototype.commands.archive=function(){var r=this,t=r.fm,i=[];this.variants=[];this.disableOnSearch=!0;t.bind("open reload",function(){r.variants=[];n.each(i=t.option("archivers").create||[],function(n,i){r.variants.push([i,t.mime2kind(i)])});r.change()});this.getstate=function(){return!this._disabled&&i.length&&t.selected().length&&t.cwd().write?0:-1};this.exec=function(r,u){var o=this.files(r),s=o.length,h=u||i[0],l=t.cwd(),c=["errArchive","errPerm","errCreatingTempDir","errFtpDownloadFile","errFtpUploadFile","errFtpMkdir","errArchiveExec","errExtractExec","errRm"],e=n.Deferred().fail(function(n){n&&t.error(n)}),f;if(!(this.enabled()&&s&&i.length&&n.inArray(h,i)!==-1))return e.reject();if(!l.write)return e.reject(c);for(f=0;f<s;f++)if(!o[f].read)return e.reject(c);return t.request({data:{cmd:"archive",targets:this.hashes(r),type:h},notify:{type:"archive",cnt:1},syncOnFail:!0})}};elFinder.prototype.commands.back=function(){this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+left backspace"}];this.getstate=function(){return this.fm.history.canBack()?0:-1};this.exec=function(){return this.fm.history.back()}};elFinder.prototype.commands.copy=function(){this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}];this.getstate=function(t){var t=this.files(t),i=t.length;return i&&n.map(t,function(n){return n.phash&&n.read?n:null}).length==i?0:-1};this.exec=function(t){var r=this.fm,i=n.Deferred().fail(function(n){r.error(n)});return n.each(this.files(t),function(n,t){if(!(t.read&&t.phash))return!i.reject(["errCopy",t.name,"errPerm"])}),i.state()=="rejected"?i:i.resolve(r.clipboard(this.hashes(t)))}};elFinder.prototype.commands.cut=function(){this.shortcuts=[{pattern:"ctrl+x shift+insert"}];this.getstate=function(t){var t=this.files(t),i=t.length;return i&&n.map(t,function(n){return n.phash&&n.read&&!n.locked?n:null}).length==i?0:-1};this.exec=function(t){var r=this.fm,i=n.Deferred().fail(function(n){r.error(n)});return n.each(this.files(t),function(n,t){return(t.read&&t.phash)?t.locked?!i.reject(["errLocked",t.name]):void 0:!i.reject(["errCopy",t.name,"errPerm"])}),i.state()=="rejected"?i:i.resolve(r.clipboard(this.hashes(t),!0))}};elFinder.prototype.commands.download=function(){var i=this,r=this.fm,t=function(t){return n.map(i.files(t),function(n){return n.mime=="directory"?null:n})};this.shortcuts=[{pattern:"shift+enter"}];this.getstate=function(){var i=this.fm.selected(),n=i.length;return!this._disabled&&n&&(!r.UA.IE||n==1)&&n==t(i).length?0:-1};this.exec=function(i){var r=this.fm,e=r.options.url,f=t(i),o=n.Deferred(),s="",h="",u;if(this.disabled())return o.reject();if(r.oldAPI)return r.error("errCmdNoSupport"),o.reject();for(n.each(r.options.customData||{},function(n,t){h+="&"+n+"="+t}),e+=e.indexOf("?")===-1?"?":"&",u=0;u<f.length;u++)s+='<iframe class="downloader" id="downloader-'+f[u].hash+'" style="display:none" src="'+e+"cmd=file&target="+f[u].hash+"&download=1"+h+'"/>';return n(s).appendTo("body").ready(function(){setTimeout(function(){n(s).each(function(){n("#"+n(this).attr("id")).remove()})},r.UA.Firefox?2e4+1e4*u:1e3)}),r.trigger("download",{files:f}),o.resolve(i)}};elFinder.prototype.commands.duplicate=function(){var t=this.fm;this.getstate=function(i){var i=this.files(i),r=i.length;return!this._disabled&&r&&t.cwd().write&&n.map(i,function(n){return n.phash&&n.read?n:null}).length==r?0:-1};this.exec=function(t){var r=this.fm,u=this.files(t),f=u.length,i=n.Deferred().fail(function(n){n&&r.error(n)});return!f||this._disabled?i.reject():(n.each(u,function(n,t){if(!t.read||!r.file(t.phash).write)return!i.reject(["errCopy",t.name,"errPerm"])}),i.state()=="rejected")?i:r.request({data:{cmd:"duplicate",targets:this.hashes(t)},notify:{type:"copy",cnt:f}})}};elFinder.prototype.commands.edit=function(){var i=this,t=this.fm,u=t.res("mimes","text")||[],r=function(t){return n.map(t,function(t){return(t.mime.indexOf("text/")===0||n.inArray(t.mime,u)!==-1)&&t.mime.indexOf("text/rtf")&&(!i.onlyMimes.length||n.inArray(t.mime,i.onlyMimes)!==-1)&&t.read&&t.write?t:null})},f=function(r,u,f){var o=n.Deferred(),e=n('<textarea class="elfinder-file-edit" rows="20" id="'+r+'-ta">'+t.escape(f)+"<\/textarea>"),h=function(){e.editor&&e.editor.save(e[0],e.editor.instance);o.resolve(e.getContent());e.elfinderdialog("close")},c=function(){o.reject();e.elfinderdialog("close")},s={title:u.name,width:i.options.dialogWidth||450,buttons:{},close:function(){e.editor&&e.editor.close(e[0],e.editor.instance);n(this).elfinderdialog("destroy")},open:function(){t.disable();e.focus();e[0].setSelectionRange&&e[0].setSelectionRange(0,0);e.editor&&e.editor.load(e[0])}};return e.getContent=function(){return e.val()},n.each(i.options.editors||[],function(t,i){if(n.inArray(u.mime,i.mimes||[])!==-1&&typeof i.load=="function"&&typeof i.save=="function")return e.editor={load:i.load,save:i.save,close:typeof i.close=="function"?i.close:function(){},instance:null},!1}),e.editor||e.keydown(function(n){var i=n.keyCode,r,t;n.stopPropagation();i==9&&(n.preventDefault(),this.setSelectionRange&&(r=this.value,t=this.selectionStart,this.value=r.substr(0,t)+"\t"+r.substr(this.selectionEnd),t+=1,this.setSelectionRange(t,t)));(n.ctrlKey||n.metaKey)&&((i==81||i==87)&&(n.preventDefault(),c()),i==83&&(n.preventDefault(),h()))}),s.buttons[t.i18n("Save")]=h,s.buttons[t.i18n("Cancel")]=c,t.dialog(e,s).attr("id",r),o.promise()},e=function(i){var u=i.hash,h=t.options,r=n.Deferred(),c={cmd:"file",target:u},l=t.url(u)||t.options.url,o="edit-"+t.namespace+"-"+i.hash,s=t.getUI().find("#"+o),e;return s.length?(s.elfinderdialog("toTop"),r.resolve()):!i.read||!i.write?(e=["errOpen",i.name,"errPerm"],t.error(e),r.reject(e)):(t.request({data:{cmd:"get",target:u},notify:{type:"openfile",cnt:1},syncOnFail:!0}).done(function(n){f(o,i,n.content).done(function(n){t.request({options:{type:"post"},data:{cmd:"put",target:u,content:n},notify:{type:"save",cnt:1},syncOnFail:!0}).fail(function(n){r.reject(n)}).done(function(n){n.changed&&n.changed.length&&t.change(n);r.resolve(n)})})}).fail(function(n){r.reject(n)}),r.promise())};this.shortcuts=[{pattern:"ctrl+e"}];this.init=function(){this.onlyMimes=this.options.mimes||[]};this.getstate=function(n){var n=this.files(n),t=n.length;return!this._disabled&&t&&r(n).length==t?0:-1};this.exec=function(t){var f=r(this.files(t)),i=[],u;if(this.disabled())return n.Deferred().reject();while(u=f.shift())i.push(e(u));return i.length?n.when.apply(null,i):n.Deferred().reject()}};elFinder.prototype.commands.extract=function(){var r=this,t=r.fm,i=[],u=function(t){return n.map(t,function(t){return t.read&&n.inArray(t.mime,i)!==-1?t:null})};this.disableOnSearch=!0;t.bind("open reload",function(){i=t.option("archivers").extract||[];r.change()});this.getstate=function(n){var n=this.files(n),t=n.length;return!this._disabled&&t&&this.fm.cwd().write&&u(n).length==t?0:-1};this.exec=function(r){var v=this.files(r),u=n.Deferred(),f=v.length,s,e,o,h=!1,c=!1,w=n.map(t.files(r),function(n){return n.name}),y={};n.map(t.files(r),function(n){y[n.name]=n});var p=function(n){switch(n){case"overwrite_all":h=!0;break;case"omit_all":c=!0}},a=function(r){r.read&&t.file(r.phash).write?n.inArray(r.mime,i)===-1?(e=["errExtract",r.name,"errNoArchive"],t.error(e),u.reject(e)):t.request({data:{cmd:"extract",target:r.hash},notify:{type:"extract",cnt:1},syncOnFail:!0}).fail(function(n){u.isRejected()||u.reject(n)}).done(function(){}):(e=["errExtract",r.name,"errPerm"],t.error(e),u.reject(e))},l=function(i,r){var e=i[r],v=e.name.replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/ig,""),b=n.inArray(v,w)>=0;b&&y[v].mime!="directory"?t.confirm({title:t.i18n("ntfextract"),text:t.i18n(["errExists",v,"confirmRepl"]),accept:{label:"btnYes",callback:function(n){if(o=n?"overwrite_all":"overwrite",p(o),h||c){if(h){for(s=0;s<f;s++)a(i[s]);u.resolve()}}else"overwrite"==o&&a(e),r+1<f?l(i,r+1):u.resolve()}},reject:{label:"btnNo",callback:function(n){o=n?"omit_all":"omit";p(o);!h&&!c&&r+1<f?l(i,r+1):c&&u.resolve()}},cancel:{label:"btnCancel",callback:function(){u.resolve()}},all:f>1}):(a(e),r+1<f?l(i,r+1):u.resolve())};return(this.enabled()&&f&&i.length)?(f>0&&l(v,0),u):u.reject()}};elFinder.prototype.commands.forward=function(){this.alwaysEnabled=!0;this.updateOnSelect=!0;this.shortcuts=[{pattern:"ctrl+right"}];this.getstate=function(){return this.fm.history.canForward()?0:-1};this.exec=function(){return this.fm.history.forward()}};elFinder.prototype.commands.getfile=function(){var t=this,i=this.fm,r=function(i){var r=t.options;return i=n.map(i,function(n){return n.mime!="directory"||r.folders?n:null}),r.multiple||i.length==1?i:[]};this.alwaysEnabled=!0;this.callback=i.options.getFileCallback;this._disabled=typeof this.callback=="function";this.getstate=function(n){var n=this.files(n),t=n.length;return this.callback&&t&&r(n).length==t?0:-1};this.exec=function(i){var u=this.fm,e=this.options,f=this.files(i),a=f.length,v=u.option("url"),y=u.option("tmbUrl"),s=n.Deferred().done(function(n){u.trigger("getfile",{files:n});t.callback(n,u);e.oncomplete=="close"?u.hide():e.oncomplete=="destroy"&&u.destroy()}),l=function(){return e.onlyURL?e.multiple?n.map(f,function(n){return n.url}):f[0].url:e.multiple?f:f[0]},c=[],h,r,o;if(this.getstate()==-1)return s.reject();for(h=0;h<a;h++){if(r=f[h],r.mime=="directory"&&!e.folders)return s.reject();r.baseUrl=v;r.url=u.url(r.hash);r.path=u.path(r.hash);r.tmb&&r.tmb!=1&&(r.tmb=y+r.tmb);r.width||r.height||(r.dim?(o=r.dim.split("x"),r.width=o[0],r.height=o[1]):r.mime.indexOf("image")!==-1&&c.push(u.request({data:{cmd:"dim",target:r.hash},preventDefault:!0}).done(n.proxy(function(n){n.dim&&(o=n.dim.split("x"),this.width=o[0],this.height=o[1]);this.dim=n.dim},f[h]))))}return c.length?(n.when.apply(null,c).always(function(){s.resolve(l(f))}),s):s.resolve(l(f))}};elFinder.prototype.commands.help=function(){var i=this.fm,p=this,s='<div class="elfinder-help-link"> <a href="{url}" target="_blank">{link}<\/a><\/div>',u='<div class="elfinder-help-team"><div>{author}<\/div>{work}<\/div>',h=/\{url\}/,c=/\{link\}/,f=/\{author\}/,e=/\{work\}/,r="replace",v="ui-priority-primary",y="ui-priority-secondary",l="elfinder-help-license",w='<li class="ui-state-default ui-corner-top"><a href="#{id}">{title}<\/a><\/li>',t=['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">','<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">'],b='<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}<\/div> {descrip}<\/div>',a='<div class="elfinder-help-separator"/>',k=function(){t.push('<div id="about" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"/>');t.push("<h3>elFinder<\/h3>");t.push('<div class="'+v+'">'+i.i18n("webfm")+"<\/div>");t.push('<div class="'+y+'">'+i.i18n("ver")+": "+i.version+", "+i.i18n("protocolver")+': <span id="apiver"><\/span><\/div>');t.push('<div class="'+y+'">jQuery/jQuery UI: '+n().jquery+"/"+n.ui.version+"<\/div>");t.push(a);t.push(s[r](h,"http://elfinder.org/")[r](c,i.i18n("homepage")));t.push(s[r](h,"https://github.com/Studio-42/elFinder/wiki")[r](c,i.i18n("docs")));t.push(s[r](h,"https://github.com/Studio-42/elFinder")[r](c,i.i18n("github")));t.push(s[r](h,"http://twitter.com/elrte_elfinder")[r](c,i.i18n("twitter")));t.push(a);t.push('<div class="'+v+'">'+i.i18n("team")+"<\/div>");t.push(u[r](f,'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;')[r](e,i.i18n("chiefdev")));t.push(u[r](f,"Troex Nevelin &lt;troex@fury.scancode.ru&gt;")[r](e,i.i18n("maintainer")));t.push(u[r](f,"Alexey Sukhotin &lt;strogg@yandex.ru&gt;")[r](e,i.i18n("contributor")));t.push(u[r](f,"Naoki Sawada &lt;hypweb@gmail.com&gt;")[r](e,i.i18n("contributor")));i.i18[i.lang].translator&&t.push(u[r](f,i.i18[i.lang].translator)[r](e,i.i18n("translator")+" ("+i.i18[i.lang].language+")"));t.push(a);t.push('<div class="'+l+'">'+i.i18n("icons")+': Pixelmixer, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue<\/a><\/div>');t.push(a);t.push('<div class="'+l+'">Licence: BSD Licence<\/div>');t.push('<div class="'+l+'">Copyright © 2009-2011, Studio 42<\/div>');t.push('<div class="'+l+'">„ …'+i.i18n("dontforget")+" ”<\/div>");t.push("<\/div>")},d=function(){var r=i.shortcuts();t.push('<div id="shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">');r.length?(t.push('<div class="ui-widget-content elfinder-help-shortcuts">'),n.each(r,function(n,i){t.push(b.replace(/\{pattern\}/,i[0]).replace(/\{descrip\}/,i[1]))}),t.push("<\/div>")):t.push('<div class="elfinder-help-disabled">'+i.i18n("shortcutsof")+"<\/div>");t.push("<\/div>")},g=function(){t.push('<div id="help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">');t.push('<a href="http://elfinder.org/forum/" target="_blank" class="elfinder-dont-panic"><span>DON\'T PANIC<\/span><\/a>');t.push("<\/div>")},o;this.alwaysEnabled=!0;this.updateOnSelect=!1;this.state=0;this.shortcuts=[{pattern:"f1",description:this.title}];setTimeout(function(){var u=p.options.view||["about","shortcuts","help"];n.each(u,function(n,u){t.push(w[r](/\{id\}/,u)[r](/\{title\}/,i.i18n(u)))});t.push("<\/ul>");n.inArray("about",u)!==-1&&k();n.inArray("shortcuts",u)!==-1&&d();n.inArray("help",u)!==-1&&g();t.push("<\/div>");o=n(t.join(""));i.one("load",function(){o.find("#apiver").text(i.api)});o.find(".ui-tabs-nav li").hover(function(){n(this).toggleClass("ui-state-hover")}).children().click(function(t){var i=n(this);t.preventDefault();t.stopPropagation();i.is(".ui-tabs-selected")||(i.parent().addClass("ui-tabs-selected ui-state-active").siblings().removeClass("ui-tabs-selected").removeClass("ui-state-active"),o.find(".ui-tabs-panel").hide().filter(i.attr("href")).show())}).filter(":first").click()},200);this.getstate=function(){return 0};this.exec=function(){this.dialog||(this.dialog=this.fm.dialog(o,{title:this.title,width:530,autoOpen:!1,destroyOnClose:!1}));this.dialog.elfinderdialog("open").find(".ui-tabs-nav li a:first").click()}};elFinder.prototype.commands.home=function(){this.title="Home";this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}];this.getstate=function(){var n=this.fm.root(),t=this.fm.cwd().hash;return n&&t&&n!=t?0:-1};this.exec=function(){return this.fm.exec("open",this.fm.root())}};elFinder.prototype.commands.info=function(){var i=this.fm,r="elfinder-info-spinner",t={calc:i.i18n("calc"),size:i.i18n("size"),unknown:i.i18n("unknown"),path:i.i18n("path"),aliasfor:i.i18n("aliasfor"),modify:i.i18n("modify"),perms:i.i18n("perms"),locked:i.i18n("locked"),dim:i.i18n("dim"),kind:i.i18n("kind"),files:i.i18n("files"),folders:i.i18n("folders"),items:i.i18n("items"),yes:i.i18n("yes"),no:i.i18n("no"),link:i.i18n("link")};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}<\/div><table class="elfinder-info-tb">{content}<\/table>',itemTitle:'<strong>{name}<\/strong><span class="elfinder-info-kind">{kind}<\/span>',groupTitle:"<strong>{items}: {num}<\/strong>",row:"<tr><td>{label} : <\/td><td>{value}<\/td><\/tr>",spinner:'<span>{text}<\/span> <span class="'+r+'"/>'};this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+i"}];this.init=function(){n.each(t,function(n,r){t[n]=i.i18n(r)})};this.getstate=function(){return 0};this.exec=function(i){var it=this,f=this.fm,l=this.tpl,o=l.row,v=this.files(i),p=v.length,e=[],a=l.main,s="{label}",h="{value}",tt={title:this.title,width:"auto",close:function(){n(this).elfinderdialog("destroy")}},b=[],k=function(n){y.find("."+r).parent().text(n)},nt=f.namespace+"-info-"+n.map(v,function(n){return n.hash}).join("-"),y=f.getUI().find("#"+nt),c,d,u,g,w;if(!p)return n.Deferred().reject();if(y.length)return y.elfinderdialog("toTop"),n.Deferred().resolve();p==1?(u=v[0],a=a.replace("{class}",f.mime2class(u.mime)),g=l.itemTitle.replace("{name}",f.escape(u.i18||u.name)).replace("{kind}",f.mime2kind(u)),u.tmb&&(d=f.option("tmbUrl")+u.tmb),u.read?u.mime!="directory"||u.alias?c=f.formatSize(u.size):(c=l.spinner.replace("{text}",t.calc),b.push(u.hash)):c=t.unknown,e.push(o.replace(s,t.size).replace(h,c)),u.alias&&e.push(o.replace(s,t.aliasfor).replace(h,u.alias)),e.push(o.replace(s,t.path).replace(h,f.escape(f.path(u.hash,!0)))),u.read&&e.push(o.replace(s,t.link).replace(h,'<a href="'+f.url(u.hash)+'" target="_blank">'+u.name+"<\/a>")),u.dim?e.push(o.replace(s,t.dim).replace(h,u.dim)):u.mime.indexOf("image")!==-1&&(u.width&&u.height?e.push(o.replace(s,t.dim).replace(h,u.width+"x"+u.height)):(e.push(o.replace(s,t.dim).replace(h,l.spinner.replace("{text}",t.calc))),f.request({data:{cmd:"dim",target:u.hash},preventDefault:!0}).fail(function(){k(t.unknown)}).done(function(n){k(n.dim||t.unknown)}))),e.push(o.replace(s,t.modify).replace(h,f.formatDate(u))),e.push(o.replace(s,t.perms).replace(h,f.formatPermissions(u))),e.push(o.replace(s,t.locked).replace(h,u.locked?t.yes:t.no))):(a=a.replace("{class}","elfinder-cwd-icon-group"),g=l.groupTitle.replace("{items}",t.items).replace("{num}",p),w=n.map(v,function(n){return n.mime=="directory"?1:null}).length,w?(e.push(o.replace(s,t.kind).replace(h,w==p?t.folders:t.folders+" "+w+", "+t.files+" "+(p-w))),e.push(o.replace(s,t.size).replace(h,l.spinner.replace("{text}",t.calc))),b=n.map(v,function(n){return n.hash})):(c=0,n.each(v,function(n,t){var i=parseInt(t.size);i>=0&&c>=0?c+=i:c="unknown"}),e.push(o.replace(s,t.kind).replace(h,t.files)),e.push(o.replace(s,t.size).replace(h,f.formatSize(c)))));a=a.replace("{title}",g).replace("{content}",e.join(""));y=f.dialog(a,tt);y.attr("id",nt);d&&n("<img/>").load(function(){y.find(".elfinder-cwd-icon").css("background",'url("'+d+'") center center no-repeat')}).attr("src",d);b.length&&f.request({data:{cmd:"size",targets:b},preventDefault:!0}).fail(function(){k(t.unknown)}).done(function(n){var i=parseInt(n.size);k(i>=0?f.formatSize(i):t.unknown)})}};elFinder.prototype.commands.mkdir=function(){this.disableOnSearch=!0;this.updateOnSelect=!1;this.mime="directory";this.prefix="untitled folder";this.exec=n.proxy(this.fm.res("mixin","make"),this);this.shortcuts=[{pattern:"ctrl+shift+n"}];this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1}};elFinder.prototype.commands.mkfile=function(){this.disableOnSearch=!0;this.updateOnSelect=!1;this.mime="text/plain";this.prefix="untitled file.txt";this.exec=n.proxy(this.fm.res("mixin","make"),this);this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1}};elFinder.prototype.commands.netmount=function(){var t=this;this.alwaysEnabled=!0;this.updateOnSelect=!1;this.drivers=[];this.handlers={load:function(){this.drivers=this.fm.netDrivers}};this.getstate=function(){return this.drivers.length?0:-1};this.exec=function(){var i=t.fm,r=n.Deferred(),u=function(){var u={protocol:n("<select/>"),host:n('<input type="text"/>'),port:n('<input type="text"/>'),path:n('<input type="text" value="/"/>'),user:n('<input type="text"/>'),pass:n('<input type="password"/>')},f={title:i.i18n("netMountDialogTitle"),resizable:!1,modal:!0,destroyOnClose:!0,close:function(){delete t.dialog;r.state()=="pending"&&r.reject()},buttons:{}},e=n('<table class="elfinder-info-tb elfinder-netmount-tb"/>');return n.each(t.drivers,function(n,t){u.protocol.append('<option value="'+t+'">'+i.i18n(t)+"<\/option>")}),n.each(u,function(t,r){t!="protocol"&&r.addClass("ui-corner-all");e.append(n("<tr/>").append(n("<td>"+i.i18n(t)+"<\/td>")).append(n("<td/>").append(r)))}),f.buttons[i.i18n("btnMount")]=function(){var i={cmd:"netmount"};if(n.each(u,function(t,r){var u=n.trim(r.val());u&&(i[t]=u)}),!i.host)return t.fm.trigger("error",{error:"errNetMountHostReq"});t.fm.request({data:i,notify:{type:"netmount",cnt:1}}).done(function(){r.resolve()}).fail(function(n){r.reject(n)});t.dialog.elfinderdialog("close")},f.buttons[i.i18n("btnCancel")]=function(){t.dialog.elfinderdialog("close")},i.dialog(e,f)};return t.dialog||(t.dialog=u()),r.promise()}};elFinder.prototype.commands.open=function(){this.alwaysEnabled=!0;this._handlers={dblclick:function(n){n.preventDefault();this.exec()},"select enable disable reload":function(n){this.update(n.type=="disable"?-1:void 0)}};this.shortcuts=[{pattern:"ctrl+down numpad_enter"+(this.fm.OS!="mac"&&" enter")}];this.getstate=function(t){var t=this.files(t),i=t.length;return i==1?0:i?n.map(t,function(n){return n.mime=="directory"?null:n}).length==i?0:-1:-1};this.exec=function(t){var o=this.fm,u=n.Deferred().fail(function(n){n&&o.error(n)}),r=this.files(t),f=r.length,i,e,s,h;if(!f)return u.reject();if(f==1&&(i=r[0])&&i.mime=="directory")return i&&!i.read?u.reject(["errOpen",i.name,"errPerm"]):o.request({data:{cmd:"open",target:i.thash||i.hash},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0});if(r=n.map(r,function(n){return n.mime!="directory"?n:null}),f!=r.length)return u.reject();for(f=r.length;f--;){if(i=r[f],!i.read)return u.reject(["errOpen",i.name,"errPerm"]);if((e=o.url(i.hash))||(e=o.options.url,e=e+(e.indexOf("?")===-1?"?":"&")+(o.oldAPI?"cmd=open&current="+i.phash:"cmd=file")+"&target="+i.hash),i.dim?(s=i.dim.split("x"),h="width="+(parseInt(s[0])+20)+",height="+(parseInt(s[1])+20)):h="width="+parseInt(2*n(window).width()/3)+",height="+parseInt(2*n(window).height()/3),!window.open(e,"_blank",h+",top=50,left=50,scrollbars=yes,resizable=yes"))return u.reject("errPopup")}return u.resolve(t)}};elFinder.prototype.commands.paste=function(){this.updateOnSelect=!1;this.handlers={changeclipboard:function(){this.update()}};this.shortcuts=[{pattern:"ctrl+v shift+insert"}];this.getstate=function(t){if(this._disabled)return-1;if(t){if(n.isArray(t)){if(t.length!=1)return-1;t=this.fm.file(t[0])}}else t=this.fm.cwd();return this.fm.clipboard().length&&t.mime=="directory"&&t.write?0:-1};this.exec=function(t){var o=this,i=o.fm,t=t?this.files(t)[0]:i.cwd(),f=i.clipboard(),s=f.length,u=s?f[0].cut:!1,h=u?"errMove":"errCopy",c=[],l=[],r=n.Deferred().fail(function(n){n&&i.error(n)}),v=function(t){return t.length&&i._commands.duplicate?i.exec("duplicate",t):n.Deferred().resolve()},y=function(r){var e=n.Deferred(),f=[],l=function(t,i){for(var u=[],r=t.length;r--;)n.inArray(t[r].name,i)!==-1&&u.unshift(r);return u},h=function(n){var c=f[n],o=r[c],t=n==f.length-1;o&&i.confirm({title:i.i18n(u?"moveFiles":"copyFiles"),text:i.i18n(["errExists",o.name,"confirmRepl"]),all:!t,accept:{label:"btnYes",callback:function(i){!t&&!i?h(++n):s(r)}},reject:{label:"btnNo",callback:function(i){var u;if(i)for(u=f.length;n<u--;)r[f[u]].remove=!0;else r[f[n]].remove=!0;!t&&!i?h(++n):s(r)}},cancel:{label:"btnCancel",callback:function(){e.resolve()}}})},c=function(n){f=l(r,n);f.length?h(0):s(r)},s=function(r){var r=n.map(r,function(n){return n.remove?null:n}),f=r.length,o;if(!f)return e.resolve();o=r[0].phash;r=n.map(r,function(n){return n.hash});i.request({data:{cmd:"paste",dst:t.hash,targets:r,cut:u?1:0,src:o},notify:{type:u?"move":"copy",cnt:f}}).always(function(){e.resolve();i.unlockfiles({files:r})})};return o._disabled||!r.length?e.resolve():(i.oldAPI?s(r):i.option("copyOverwrite")?t.hash==i.cwd().hash?c(n.map(i.files(),function(n){return n.phash==t.hash?n.name:null})):i.request({data:{cmd:"ls",target:t.hash},notify:{type:"prepare",cnt:1,hideCnt:!0},preventFail:!0}).always(function(n){c(n.list||[])}):s(r),e)},a,e;return!s||!t||t.mime!="directory"?r.reject():t.write?(a=i.parents(t.hash),n.each(f,function(o,s){if(!s.read)return!r.reject([h,f[0].name,"errPerm"]);if(u&&s.locked)return!r.reject(["errLocked",s.name]);if(n.inArray(s.hash,a)!==-1)return!r.reject(["errCopyInItself",s.name]);if(e=i.parents(s.hash),n.inArray(t.hash,e)!==-1&&n.map(e,function(n){var r=i.file(n);return r.phash==t.hash&&r.name==s.name?r:null}).length)return!r.reject(["errReplByChild",s.name]);s.phash==t.hash?l.push(s.hash):c.push({hash:s.hash,phash:s.phash,name:s.name})}),r.state()=="rejected")?r:n.when(v(l),y(c)).always(function(){u&&i.clipboard([])}):r.reject([h,f[0].name,"errPerm"])}};elFinder.prototype.commands.quicklook=function(){var t=this,u=t.fm,s=0,w=1,h=2,f=s,i="elfinder-quicklook-navbar-icon",c="elfinder-quicklook-fullscreen",b=function(t){n(document).trigger(n.Event("keydown",{keyCode:t,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))},k=function(n){return{opacity:0,width:20,height:u.view=="list"?1:20,top:n.offset().top+"px",left:n.offset().left+"px"}},nt=function(){var t=n(window);return{opacity:1,width:l,height:a,top:parseInt((t.height()-a)/2+t.scrollTop()),left:parseInt((t.width()-l)/2+t.scrollLeft())}},r=function(n){var i=document.createElement(n.substr(0,n.indexOf("/"))),t=!1;try{t=i.canPlayType&&i.canPlayType(n)}catch(r){}return t&&t!==""&&t!="no"},l,a,v,y,d=n('<div class="elfinder-quicklook-title"/>'),o=n("<div/>"),p=n('<div class="elfinder-quicklook-info"/>'),g=n('<div class="'+i+" "+i+'-fullscreen"/>').mousedown(function(r){var f=t.window,o=f.is("."+c),s="scroll."+u.namespace,h=n(window);r.stopPropagation();o?(f.css(f.data("position")).unbind("mousemove"),h.unbind(s).trigger(t.resize).unbind(t.resize),e.unbind("mouseenter").unbind("mousemove")):(f.data("position",{left:f.css("left"),top:f.css("top"),width:f.width(),height:f.height()}).css({width:"100%",height:"100%"}),n(window).bind(s,function(){f.css({left:parseInt(n(window).scrollLeft())+"px",top:parseInt(n(window).scrollTop())+"px"})}).bind(t.resize,function(){t.preview.trigger("changesize")}).trigger(s).trigger(t.resize),f.bind("mousemove",function(){e.stop(!0,!0).show().delay(3e3).fadeOut("slow")}).mousemove(),e.mouseenter(function(){e.stop(!0,!0).show()}).mousemove(function(n){n.stopPropagation()}));e.attr("style","").draggable(o?"destroy":{});f.toggleClass(c);n(this).toggleClass(i+"-fullscreen-off");n.fn.resizable&&v.add(f).resizable(o?"enable":"disable").removeClass("ui-state-disabled")}),e=n('<div class="elfinder-quicklook-navbar"/>').append(n('<div class="'+i+" "+i+'-prev"/>').mousedown(function(){b(37)})).append(g).append(n('<div class="'+i+" "+i+'-next"/>').mousedown(function(){b(39)})).append('<div class="elfinder-quicklook-navbar-separator"/>').append(n('<div class="'+i+" "+i+'-close"/>').mousedown(function(){t.window.trigger("close")}));this.resize="resize."+u.namespace;this.info=n('<div class="elfinder-quicklook-info-wrapper"/>').append(o).append(p).click(function(){alert();n(this).css("top","0px")});this.preview=n('<div class="elfinder-quicklook-preview ui-helper-clearfix"/>').bind("change",function(){t.info.attr("style","").hide();o.removeAttr("class").attr("style","");p.html("")}).bind("update",function(i){var u=t.fm,s=t.preview,r=i.file,f='<div class="elfinder-quicklook-info-data">{value}<\/div>',e;r?(r.read||i.stopImmediatePropagation(),t.window.data("hash",r.hash),t.preview.unbind("changesize").trigger("change").children().remove(),d.html(u.escape(r.name)),p.html(f.replace(/\{value\}/,r.name)+f.replace(/\{value\}/,u.mime2kind(r))+(r.mime=="directory"?"":f.replace(/\{value\}/,u.formatSize(r.size)))+f.replace(/\{value\}/,u.i18n("modify")+": "+u.formatDate(r))),o.addClass("elfinder-cwd-icon ui-corner-all "+u.mime2class(r.mime)),r.tmb&&n("<img/>").hide().appendTo(t.preview).load(function(){o.css("background",'url("'+e+'") center center no-repeat');n(this).remove()}).attr("src",e=u.tmb(r.hash)),t.info.delay(100).fadeIn(10)):i.stopImmediatePropagation()});this.window=n('<div class="ui-helper-reset ui-widget elfinder-quicklook" style="position:absolute"/>').click(function(n){n.stopPropagation()}).append(n('<div class="elfinder-quicklook-titlebar"/>').append(d).append(n('<span class="ui-icon ui-icon-circle-close"/>').mousedown(function(n){n.stopPropagation();t.window.trigger("close")}))).append(this.preview.add(e)).append(t.info.hide()).draggable({handle:"div.elfinder-quicklook-titlebar"}).bind("open",function(){var r=t.window,i=t.value,n;t.closed()&&i&&(n=y.find("#"+i.hash)).length&&(e.attr("style",""),f=w,n.trigger("scrolltoview"),r.css(k(n)).show().animate(nt(),550,function(){f=h;t.update(1,t.value)}))}).bind("close",function(){var n=t.window,u=t.preview.trigger("change"),e=t.value,i=y.find("#"+n.data("hash")),r=function(){f=s;n.hide();u.children().remove();t.update(0,t.value)};t.opened()&&(f=w,n.is("."+c)&&g.mousedown(),i.length?n.animate(k(i),500,r):r())});this.alwaysEnabled=!0;this.value=null;this.handlers={select:function(){this.update(void 0,this.fm.selectedFiles()[0])},error:function(){t.window.is(":visible")&&t.window.data("hash","").trigger("close")},"searchshow searchhide":function(){this.opened()&&this.window.trigger("close")}};this.shortcuts=[{pattern:"space"}];this.support={audio:{ogg:r('audio/ogg; codecs="vorbis"'),mp3:r("audio/mpeg;"),wav:r('audio/wav; codecs="1"'),m4a:r("audio/x-m4a;")||r("audio/aac;")},video:{ogg:r('video/ogg; codecs="theora"'),webm:r('video/webm; codecs="vp8, vorbis"'),mp4:r('video/mp4; codecs="avc1.42E01E"')||r('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')}};this.closed=function(){return f==s};this.opened=function(){return f==h};this.init=function(){var i=this.options,r=this.window,f=this.preview;l=i.width>0?parseInt(i.width):450;a=i.height>0?parseInt(i.height):300;u.one("load",function(){v=u.getUI();y=u.getUI("cwd");r.appendTo("body").zIndex(100+v.zIndex());n(document).keydown(function(n){n.keyCode==27&&t.opened()&&r.trigger("close")});n.fn.resizable&&r.resizable({handles:"se",minWidth:350,minHeight:120,resize:function(){f.trigger("changesize")}});t.change(function(){t.opened()&&(t.value?f.trigger(n.Event("update",{file:t.value})):r.trigger("close"))});n.each(u.commands.quicklook.plugins||[],function(n,i){typeof i=="function"&&new i(t)});f.bind("update",function(){t.info.show()})})};this.getstate=function(){return this.fm.selected().length==1?f==h?1:0:-1};this.exec=function(){this.enabled()&&this.window.trigger(this.opened()?"close":"open")};this.hideinfo=function(){this.info.stop(!0).hide()}};elFinder.prototype.commands.quicklook.plugins=[function(t){var r=["image/jpeg","image/png","image/gif"],i=t.preview;n.each(navigator.mimeTypes,function(t,i){var u=i.type;u.indexOf("image/")===0&&n.inArray(u,r)&&r.push(u)});i.bind("update",function(u){var e=u.file,f;n.inArray(e.mime,r)!==-1&&(u.stopImmediatePropagation(),f=n("<img/>").hide().appendTo(i).load(function(){setTimeout(function(){var n=(f.width()/f.height()).toFixed(2);i.bind("changesize",function(){var e=parseInt(i.width()),r=parseInt(i.height()),u,t;n<(e/r).toFixed(2)?(t=r,u=Math.floor(t*n)):(u=e,t=Math.floor(u/n));f.width(u).height(t).css("margin-top",t<r?Math.floor((r-t)/2):0)}).trigger("changesize");t.hideinfo();f.fadeIn(100)},1)}).attr("src",t.fm.url(e.hash)))})},function(t){var r=["text/html","application/xhtml+xml"],i=t.preview,u=t.fm;i.bind("update",function(f){var e=f.file,o;if(n.inArray(e.mime,r)!==-1){f.stopImmediatePropagation();i.one("change",function(){o.state()=="pending"&&o.reject()});o=u.request({data:{cmd:"get",target:e.hash,current:e.phash},preventDefault:!0}).done(function(r){t.hideinfo();doc=n('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(i)[0].contentWindow.document;doc.open();doc.write(r.content);doc.close()})}})},function(t){var i=t.fm,u=i.res("mimes","text"),r=t.preview;r.bind("update",function(f){var o=f.file,s=o.mime,e;if(s.indexOf("text/")===0||n.inArray(s,u)!==-1){f.stopImmediatePropagation();r.one("change",function(){e.state()=="pending"&&e.reject()});e=i.request({data:{cmd:"get",target:o.hash},preventDefault:!0}).done(function(u){t.hideinfo();n('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text">'+i.escape(u.content)+"<\/pre><\/div>").appendTo(r)})}})},function(t){var i=t.fm,f="application/pdf",r=t.preview,u=!1;i.UA.Safari&&i.OS=="mac"||i.UA.IE?u=!0:n.each(navigator.plugins,function(t,i){n.each(i,function(n,t){if(t.type==f)return!(u=!0)})});u&&r.bind("update",function(u){var o=u.file,e;if(o.mime==f){u.stopImmediatePropagation();r.one("change",function(){e.unbind("load").remove()});e=n('<iframe class="elfinder-quicklook-preview-pdf"/>').hide().appendTo(r).load(function(){t.hideinfo();e.show()}).attr("src",i.url(o.hash))}})},function(t){var f=t.fm,i="application/x-shockwave-flash",r=t.preview,u=!1;n.each(navigator.plugins,function(t,r){n.each(r,function(n,t){if(t.type==i)return!(u=!0)})});u&&r.bind("update",function(u){var e=u.file,o;e.mime==i&&(u.stopImmediatePropagation(),t.hideinfo(),r.append(o=n('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+f.url(e.hash)+'" quality="high" type="application/x-shockwave-flash" />')))})},function(t){var r=t.preview,u=!!t.options.autoplay,f={"audio/mpeg":"mp3","audio/mpeg3":"mp3","audio/mp3":"mp3","audio/x-mpeg3":"mp3","audio/x-mp3":"mp3","audio/x-wav":"wav","audio/wav":"wav","audio/x-m4a":"m4a","audio/aac":"m4a","audio/mp4":"m4a","audio/x-mp4":"m4a","audio/ogg":"ogg"},i;r.bind("update",function(e){var o=e.file,s=f[o.mime];t.support.audio[s]&&(e.stopImmediatePropagation(),i=n('<audio class="elfinder-quicklook-preview-audio" controls preload="auto" autobuffer><source src="'+t.fm.url(o.hash)+'" /><\/audio>').appendTo(r),u&&i[0].play())}).bind("change",function(){i&&i.parent().length&&(i[0].pause(),i.remove(),i=null)})},function(t){var r=t.preview,u=!!t.options.autoplay,f={"video/mp4":"mp4","video/x-m4v":"mp4","video/ogg":"ogg","application/ogg":"ogg","video/webm":"webm"},i;r.bind("update",function(e){var o=e.file,s=f[o.mime];t.support.video[s]&&(e.stopImmediatePropagation(),t.hideinfo(),i=n('<video class="elfinder-quicklook-preview-video" controls preload="auto" autobuffer><source src="'+t.fm.url(o.hash)+'" /><\/video>').appendTo(r),u&&i[0].play())}).bind("change",function(){i&&i.parent().length&&(i[0].pause(),i.remove(),i=null)})},function(t){var r=t.preview,u=[],i;n.each(navigator.plugins,function(t,i){n.each(i,function(n,t){(t.type.indexOf("audio/")===0||t.type.indexOf("video/")===0)&&u.push(t.type)})});r.bind("update",function(f){var e=f.file,o=e.mime,s;n.inArray(e.mime,u)!==-1&&(f.stopImmediatePropagation(),(s=o.indexOf("video/")===0)&&t.hideinfo(),i=n('<embed src="'+t.fm.url(e.hash)+'" type="'+o+'" class="elfinder-quicklook-preview-'+(s?"video":"audio")+'"/>').appendTo(r))}).bind("change",function(){i&&i.parent().length&&(i.remove(),i=null)})}];elFinder.prototype.commands.reload=function(){this.alwaysEnabled=!0;this.updateOnSelect=!0;this.shortcuts=[{pattern:"ctrl+shift+r f5"}];this.getstate=function(){return 0};this.exec=function(){var n=this.fm,t=n.sync(),i=setTimeout(function(){n.notify({type:"reload",cnt:1,hideCnt:!0});t.always(function(){n.notify({type:"reload",cnt:-1})})},n.notifyDelay);return t.always(function(){clearTimeout(i);n.trigger("reload")})}};elFinder.prototype.commands.rename=function(){this.shortcuts=[{pattern:"f2"+(this.fm.OS=="mac"?" enter":"")}];this.getstate=function(){var n=this.fm.selectedFiles();return!this._disabled&&n.length==1&&n[0].phash&&!n[0].locked?0:-1};this.exec=function(){var i=this.fm,f=i.getUI("cwd"),e=i.selected(),s=e.length,t=i.file(e.shift()),o=".elfinder-cwd-filename",u=n.Deferred().fail(function(n){var u=r.parent(),e=i.escape(t.name);u.length?(r.remove(),u.html(e)):(f.find("#"+t.hash).find(o).html(e),setTimeout(function(){f.find("#"+t.hash).click()},50));n&&i.error(n)}).always(function(){i.enable()}),r=n('<input type="text"/>').keydown(function(t){t.stopPropagation();t.stopImmediatePropagation();t.keyCode==n.ui.keyCode.ESCAPE?u.reject():t.keyCode==n.ui.keyCode.ENTER&&r.blur()}).mousedown(function(n){n.stopPropagation()}).dblclick(function(n){n.stopPropagation();n.preventDefault()}).blur(function(){var f=n.trim(r.val()),e=r.parent();if(e.length){if(r[0].setSelectionRange&&r[0].setSelectionRange(0,0),f==t.name)return u.reject();if(!f)return u.reject("errInvName");if(i.fileByName(f,t.phash))return u.reject(["errExists",f]);e.html(i.escape(f));i.lockfiles({files:[t.hash]});i.request({data:{cmd:"rename",target:t.hash,name:f},notify:{type:"rename",cnt:1}}).fail(function(){u.reject();i.sync()}).done(function(n){u.resolve(n)}).always(function(){i.unlockfiles({files:[t.hash]})})}}),h=f.find("#"+t.hash).find(o).empty().append(r.val(t.name)),c=r.val().replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/ig,"");if(this.disabled())return u.reject();if(!t||s>1||!h.length)return u.reject("errCmdParams",this.title);if(t.locked)return u.reject(["errLocked",t.name]);i.one("select",function(){r.parent().length&&t&&n.inArray(t.hash,i.selected())===-1&&r.blur()});return r.select().focus(),r[0].setSelectionRange&&r[0].setSelectionRange(0,c.length),u}};elFinder.prototype.commands.resize=function(){this.updateOnSelect=!1;this.getstate=function(){var n=this.fm.selectedFiles();return!this._disabled&&n.length==1&&n[0].read&&n[0].write&&n[0].mime.indexOf("image/")!==-1?0:-1};this.exec=function(t){var i=this.fm,u=this.files(t),r=n.Deferred(),o=function(t,u){var ht=n('<div class="elfinder-dialog-resize"/>'),ft='<input type="text" size="5"/>',v='<div class="elfinder-resize-row"/>',it='<div class="elfinder-resize-label"/>',gt=n('<div class="elfinder-resize-control"/>'),k=n('<div class="elfinder-resize-preview"/>'),ni=n('<div class="elfinder-resize-spinner">'+i.i18n("ntfloadimg")+"<\/div>"),l=n('<div class="elfinder-resize-handle"/>'),h=n('<div class="elfinder-resize-handle"/>'),ct=n('<div class="elfinder-resize-uiresize"/>'),lt=n('<div class="elfinder-resize-uicrop"/>'),si='<div class="ui-state-default elfinder-button"/>',at=n('<div class="elfinder-resize-rotate"/>'),wi=n(si).attr("title",i.i18n("rotate-cw")).append(n('<span class="elfinder-button-icon elfinder-button-icon-rotate-l"/>').click(function(){ut=ut-90;o.update(ut)})),bi=n(si).attr("title",i.i18n("rotate-ccw")).append(n('<span class="elfinder-button-icon elfinder-button-icon-rotate-r"/>').click(function(){ut=ut+90;o.update(ut)})),hi=n("<span />"),wt=n('<div class="ui-state-default ui-corner-all elfinder-resize-reset"><span class="ui-icon ui-icon-arrowreturnthick-1-w"/><\/div>'),vt=n('<div class="elfinder-resize-type"/>').append('<input type="radio" name="type" id="type-resize" value="resize" checked="checked" /><label for="type-resize">'+i.i18n("resize")+"<\/label>").append('<input type="radio" name="type" id="type-crop"   value="crop"/><label for="type-crop">'+i.i18n("crop")+"<\/label>").append('<input type="radio" name="type" id="type-rotate" value="rotate"/><label for="type-rotate">'+i.i18n("rotate")+"<\/label>"),ki=n("input",vt).change(function(){var t=n("input:checked",vt).val();li();pt(!0);ai(!0);vi(!0);t=="resize"?(ct.show(),at.hide(),lt.hide(),pt()):t=="crop"?(at.hide(),ct.hide(),lt.show(),ai()):t=="rotate"&&(ct.hide(),lt.hide(),at.show(),vi())}),ci=n('<input type="checkbox" checked="checked"/>').change(function(){et=!!ci.prop("checked");w.fixHeight();pt(!0);pt()}),c=n(ft).change(function(){var n=parseInt(c.val()),t=parseInt(et?n/rt:a.val());n>0&&t>0&&(w.updateView(n,t),a.val(t))}),a=n(ft).change(function(){var n=parseInt(a.val()),t=parseInt(et?n*rt:c.val());t>0&&n>0&&(w.updateView(t,n),c.val(t))}),ti=n(ft),ii=n(ft),ri=n(ft),ui=n(ft),d=n('<input type="text" size="3" maxlength="3" value="0" />').change(function(){o.update()}),bt=n('<div class="elfinder-resize-rotate-slider"/>').slider({min:0,max:359,value:d.val(),animate:!0,change:function(n,t){t.value!=bt.slider("value")&&o.update(t.value)},slide:function(n,t){o.update(t.value,!1)}}),rt=1,g=1,y=0,p=0,et=!0,ot=0,st=0,fi=0,ei=0,ut=0,f=n("<img/>").load(function(){ni.remove();y=f.width();p=f.height();rt=y/p;w.updateView(y,p);l.append(f.show()).show();c.val(y);a.val(p);var t=Math.min(ot,st)/Math.sqrt(Math.pow(y,2)+Math.pow(p,2));fi=y*t;ei=p*t;gt.find("input,select").removeAttr("disabled").filter(":text").keydown(function(t){var i=t.keyCode,r;if(t.stopPropagation(),(!(i>=37)||!(i<=40))&&i!=n.ui.keyCode.BACKSPACE&&i!=n.ui.keyCode.DELETE&&(i!=65||!(t.ctrlKey||t.metaKey))&&i!=27){if(i==9&&(r=n(this).parent()[t.shiftKey?"prev":"next"](".elfinder-resize-row").children(":text"),r.length&&r.focus()),i==13){yi();return}i>=48&&i<=57||i>=96&&i<=105||t.preventDefault()}}).filter(":first").focus();pt();wt.hover(function(){wt.toggleClass("ui-state-hover")}).click(li)}).error(function(){ni.text("Unable to load image").css("background","transparent")}),kt=n("<div/>"),b=n("<img/>"),yt=n("<div/>"),s=n("<img/>"),li=function(){c.val(y);a.val(p);w.updateView(y,p)},w={update:function(){c.val(parseInt(f.width()/g));a.val(parseInt(f.height()/g))},updateView:function(n,t){n>ot||t>st?n/ot>t/st?f.width(ot).height(Math.ceil(f.width()/rt)):f.height(st).width(Math.ceil(f.height()*rt)):f.width(n).height(t);g=f.width()/n;hi.text("1 : "+(1/g).toFixed(2));w.updateHandle()},updateHandle:function(){l.width(f.width()).height(f.height())},fixWidth:function(){var t,n;et&&(n=a.val(),n=parseInt(n*rt),w.updateView(t,n),c.val(t))},fixHeight:function(){var n,t;et&&(n=c.val(),t=parseInt(n/rt),w.updateView(n,t),a.val(t))}},dt={update:function(){ri.val(parseInt(h.width()/g));ui.val(parseInt(h.height()/g));ti.val(parseInt((h.offset().left-b.offset().left)/g));ii.val(parseInt((h.offset().top-b.offset().top)/g))},resize_update:function(){dt.update();yt.width(h.width());yt.height(h.height())}},o={mouseStartAngle:0,imageStartAngle:0,imageBeingRotated:!1,update:function(n,t){typeof n=="undefined"&&(ut=n=parseInt(d.val()));typeof t=="undefined"&&(t=!0);!t||i.UA.Opera||i.UA.ltIE8?s.rotate(n):s.animate({rotate:n+"deg"});n=n%360;n<0&&(n+=360);d.val(parseInt(n));bt.slider("value",d.val())},execute:function(n){if(o.imageBeingRotated){var i=o.getCenter(s),r=n.pageX-i[0],u=n.pageY-i[1],f=Math.atan2(u,r),t=f-o.mouseStartAngle+o.imageStartAngle;return t=Math.round(parseFloat(t)*180/Math.PI),n.shiftKey&&(t=Math.round((t+6)/15)*15),s.rotate(t),t=t%360,t<0&&(t+=360),d.val(t),bt.slider("value",d.val()),!1}},start:function(t){o.imageBeingRotated=!0;var i=o.getCenter(s),r=t.pageX-i[0],u=t.pageY-i[1];return o.mouseStartAngle=Math.atan2(u,r),o.imageStartAngle=parseFloat(s.rotate())*Math.PI/180,n(document).mousemove(o.execute),!1},stop:function(){if(o.imageBeingRotated)return n(document).unbind("mousemove",o.execute),setTimeout(function(){o.imageBeingRotated=!1},10),!1},getCenter:function(){var t=s.rotate();s.rotate(0);var n=s.offset(),i=n.left+s.width()/2,r=n.top+s.height()/2;return s.rotate(t),Array(i,r)}},pt=function(t){n.fn.resizable&&(t?(l.filter(":ui-resizable").resizable("destroy"),l.hide()):(l.show(),l.resizable({alsoResize:f,aspectRatio:et,resize:w.update,stop:w.fixHeight})))},ai=function(t){n.fn.draggable&&n.fn.resizable&&(t?(h.filter(":ui-resizable").resizable("destroy"),h.filter(":ui-draggable").draggable("destroy"),kt.hide()):(b.width(f.width()).height(f.height()),yt.width(f.width()).height(f.height()),h.width(b.width()).height(b.height()).offset(b.offset()).resizable({containment:kt,resize:dt.resize_update,handles:"all"}).draggable({handle:h,containment:b,drag:dt.update}),kt.show().width(f.width()).height(f.height()),dt.update()))},vi=function(t){n.fn.draggable&&n.fn.resizable&&(t?s.hide():s.show().width(fi).height(ei).css("margin-top",(st-ei)/2+"px").css("margin-left",(ot-fi)/2+"px"))},yi=function(){var u,f,s,h,e,o=n("input:checked",vt).val();if(c.add(a).change(),o=="resize")u=parseInt(c.val())||0,f=parseInt(a.val())||0;else if(o=="crop")u=parseInt(ri.val())||0,f=parseInt(ui.val())||0,s=parseInt(ti.val())||0,h=parseInt(ii.val())||0;else if(o="rotate"){if(u=y,f=p,e=parseInt(d.val())||0,e<0||e>360)return i.error("Invalid rotate degree");if(e==0||e==360)return i.error("Image dose not rotated")}if(o!="rotate"){if(u<=0||f<=0)return i.error("Invalid image size");if(u==y&&f==p)return i.error("Image size not changed")}ht.elfinderdialog("close");i.request({data:{cmd:"resize",target:t.hash,width:u,height:f,x:s,y:h,degree:e,mode:o},notify:{type:"resize",cnt:1}}).fail(function(n){r.reject(n)}).done(function(){r.resolve()})},oi={},nt="elfinder-resize-handle-hline",tt="elfinder-resize-handle-vline",e="elfinder-resize-handle-point",pi=i.url(t.hash);s.mousedown(o.start);n(document).mouseup(o.stop);ct.append(n(v).append(n(it).text(i.i18n("width"))).append(c).append(wt)).append(n(v).append(n(it).text(i.i18n("height"))).append(a)).append(n(v).append(n("<label/>").text(i.i18n("aspectRatio")).prepend(ci))).append(n(v).append(i.i18n("scale")+" ").append(hi));lt.append(n(v).append(n(it).text("X")).append(ti)).append(n(v).append(n(it).text("Y")).append(ii)).append(n(v).append(n(it).text(i.i18n("width"))).append(ri)).append(n(v).append(n(it).text(i.i18n("height"))).append(ui));at.append(n(v).append(n(it).text(i.i18n("rotate"))).append(n('<div style="float:left; width: 130px;">').append(n('<div style="float:left;">').append(d).append(n("<span/>").text(i.i18n("degree")))).append(n('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>').append(wi).append(n('<span class="ui-widget-content elfinder-toolbar-button-separator"/>')).append(bi))).append(bt));ht.append(vt);gt.append(n(v)).append(ct).append(lt.hide()).append(at.hide()).find("input,select").attr("disabled","disabled");l.append('<div class="'+nt+" "+nt+'-top"/>').append('<div class="'+nt+" "+nt+'-bottom"/>').append('<div class="'+tt+" "+tt+'-left"/>').append('<div class="'+tt+" "+tt+'-right"/>').append('<div class="'+e+" "+e+'-e"/>').append('<div class="'+e+" "+e+'-se"/>').append('<div class="'+e+" "+e+'-s"/>');k.append(ni).append(l.hide()).append(f.hide());h.css("position","absolute").append('<div class="'+nt+" "+nt+'-top"/>').append('<div class="'+nt+" "+nt+'-bottom"/>').append('<div class="'+tt+" "+tt+'-left"/>').append('<div class="'+tt+" "+tt+'-right"/>').append('<div class="'+e+" "+e+'-n"/>').append('<div class="'+e+" "+e+'-e"/>').append('<div class="'+e+" "+e+'-s"/>').append('<div class="'+e+" "+e+'-w"/>').append('<div class="'+e+" "+e+'-ne"/>').append('<div class="'+e+" "+e+'-se"/>').append('<div class="'+e+" "+e+'-sw"/>').append('<div class="'+e+" "+e+'-nw"/>');k.append(kt.css("position","absolute").hide().append(b).append(h.append(yt)));k.append(s.hide());k.css("overflow","hidden");ht.append(k).append(gt);oi[i.i18n("btnCancel")]=function(){ht.elfinderdialog("close")};oi[i.i18n("btnApply")]=yi;i.dialog(ht,{title:t.name,width:650,resizable:!1,destroyOnClose:!0,buttons:oi,open:function(){k.zIndex(1+n(this).parent().zIndex())}}).attr("id",u);i.UA.ltIE8&&n(".elfinder-dialog").css("filter","");wt.css("left",c.position().left+c.width()+12);yt.css({opacity:.2,"background-color":"#fff",position:"absolute"});h.css("cursor","move");h.find(".elfinder-resize-handle-point").css({"background-color":"#fff",opacity:.5,"border-color":"#000"});s.css("cursor","pointer");vt.buttonset();ot=k.width()-(l.outerWidth()-l.width());st=k.height()-(l.outerHeight()-l.height());f.attr("src",pi+(pi.indexOf("?")===-1?"?":"&")+"_="+Math.random());b.attr("src",f.attr("src"));s.attr("src",f.attr("src"))},f,e;return!u.length||u[0].mime.indexOf("image/")===-1?r.reject():(f="resize-"+i.namespace+"-"+u[0].hash,e=i.getUI().find("#"+f),e.length)?(e.elfinderdialog("toTop"),r.resolve()):(o(u[0],f),r)}},function(n){var t=function(n,t){for(var i in t)if(typeof n[t[i]]!="undefined")return t[i];return n[t[i]]="",t[i]};if(n.cssHooks.rotate={get:function(t){return n(t).rotate()},set:function(t,i){return n(t).rotate(i),i}},n.cssHooks.transform={get:function(n){var i=t(n.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return n.style[i]},set:function(n,i){var r=t(n.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return n.style[r]=i,i}},n.fn.rotate=function(n){var t;return typeof n=="undefined"?window.opera?(t=this.css("transform").match(/rotate\((.*?)\)/),t&&t[1]?Math.round(parseFloat(t[1])*180/Math.PI):0):(t=this.css("transform").match(/rotate\((.*?)\)/),t&&t[1]?parseInt(t[1]):0):(this.css("transform",this.css("transform").replace(/none|rotate\(.*?\)/,"")+"rotate("+parseInt(n)+"deg)"),this)},n.fx.step.rotate=function(t){t.state==0&&(t.start=n(t.elem).rotate(),t.now=t.start);n(t.elem).rotate(t.now)},typeof addEventListener=="undefined"&&typeof document.getElementsByClassName=="undefined"){var i=function(n){for(var t=n,i=t.offsetLeft,r=t.offsetTop;t.offsetParent;){if(t=t.offsetParent,t!=document.body&&t.currentStyle.position!="static")break;t!=document.body&&t!=document.documentElement&&(i-=t.scrollLeft,r-=t.scrollTop);i+=t.offsetLeft;r+=t.offsetTop}return{x:i,y:r}},r=function(n){if(n.currentStyle.position=="static"){var t=i(n);n.style.position="absolute";n.style.left=t.x+"px";n.style.top=t.y+"px"}},u=function(n,t){var u,s=1,h=1,c=1,l=1,i;if(typeof n.style.msTransform!="undefined")return!0;r(n);u=t.match(/rotate\((.*?)\)/);i=u&&u[1]?parseInt(u[1]):0;i=i%360;i<0&&(i=360+i);var f=i*Math.PI/180,a=Math.cos(f),v=Math.sin(f);s*=a;h*=-v;c*=v;l*=a;n.style.filter=(n.style.filter||"").replace(/progid:DXImageTransform\.Microsoft\.Matrix\([^)]*\)/,"")+("progid:DXImageTransform.Microsoft.Matrix(M11="+s+",M12="+h+",M21="+c+",M22="+l+",FilterType='bilinear',sizingMethod='auto expand')");var e=parseInt(n.style.width||n.width||0),o=parseInt(n.style.height||n.height||0),f=i*Math.PI/180,y=Math.abs(Math.cos(f)),p=Math.abs(Math.sin(f)),w=(e-(e*y+o*p))/2,b=(o-(e*p+o*y))/2;return n.style.marginLeft=Math.floor(w)+"px",n.style.marginTop=Math.floor(b)+"px",!0},f=n.cssHooks.transform.set;n.cssHooks.transform.set=function(n,t){return f.apply(this,[n,t]),u(n,t),t}}}(jQuery);elFinder.prototype.commands.rm=function(){this.shortcuts=[{pattern:"delete ctrl+backspace"}];this.getstate=function(t){var i=this.fm;return t=t||i.selected(),!this._disabled&&t.length&&n.map(t,function(n){var t=i.file(n);return t&&t.phash&&!t.locked?n:null}).length==t.length?0:-1};this.exec=function(t){var o=this,i=this.fm,r=n.Deferred().fail(function(n){n&&i.error(n)}),u=this.files(t),e=u.length,s=i.cwd().hash,f=!1;return!e||this._disabled?r.reject():(n.each(u,function(n,t){if(!t.phash)return!r.reject(["errRm",t.name,"errPerm"]);if(t.locked)return!r.reject(["errLocked",t.name]);t.hash==s&&(f=i.root(t.hash))}),r.state()=="pending"&&(u=this.hashes(t),i.confirm({title:o.title,text:"confirmRm",accept:{label:"btnRm",callback:function(){i.lockfiles({files:u});i.request({data:{cmd:"rm",targets:u},notify:{type:"rm",cnt:e},preventFail:!0}).fail(function(n){r.reject(n)}).done(function(n){r.done(n);f&&i.exec("open",f)}).always(function(){i.unlockfiles({files:u})})}},cancel:{label:"btnCancel",callback:function(){r.reject()}}})),r)}};elFinder.prototype.commands.search=function(){this.title="Find files";this.options={ui:"searchbutton"};this.alwaysEnabled=!0;this.updateOnSelect=!1;this.getstate=function(){return 0};this.exec=function(t){var i=this.fm;return typeof t=="string"&&t?(i.trigger("searchstart",{query:t}),i.request({data:{cmd:"search",q:t},notify:{type:"search",cnt:1,hideCnt:!0}})):(i.getUI("toolbar").find("."+i.res("class","searchbtn")+" :text").focus(),n.Deferred().reject())}};elFinder.prototype.commands.sort=function(){this.options={ui:"sortbutton"};this.getstate=function(){return 0};this.exec=function(t,i){var r=this.fm,i=n.extend({type:r.sortType,order:r.sortOrder,stick:r.sortStickFolders},i);return this.fm.setSort(i.type,i.order,i.stick),n.Deferred().resolve()}};elFinder.prototype.commands.up=function(){this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+up"}];this.getstate=function(){return this.fm.cwd().phash?0:-1};this.exec=function(){return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash):n.Deferred().reject()}};elFinder.prototype.commands.upload=function(){var t=this.fm.res("class","hover");this.disableOnSearch=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+u"}];this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1};this.exec=function(i){var r=this.fm,s=function(n){e.elfinderdialog("close");r.upload(n).fail(function(n){o.reject(n)}).done(function(n){o.resolve(n)})},o,e,h,c,u,f;return this.disabled()?n.Deferred().reject():i&&(i.input||i.files)?r.upload(i):(o=n.Deferred(),h=n('<input type="file" multiple="true"/>').change(function(){s({input:h[0]})}),c=n('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+r.i18n("selectForUpload")+"<\/span><\/div>").append(n("<form/>").append(h)).hover(function(){c.toggleClass(t)}),e=n('<div class="elfinder-upload-dialog-wrapper"/>').append(c),f=n('<div class="ui-corner-all elfinder-upload-dropbox" contenteditable=true><\/div>').focus(function(){if(this.innerHTML){var n=this.innerHTML.replace(/<br[^>]*>/gi," "),t=n.match(/<[^>]+>/)?"html":"text";this.innerHTML="";s({files:[n],type:t})}}).bind("dragenter mouseover",function(){this.focus();n(f).addClass(t)}).bind("dragleave mouseout",function(){this.blur();n(f).removeClass(t)}).bind("mouseup keyup",function(){setTimeout(function(){n(f).focus()},100)}),r.dragUpload?(u=n('<div class="ui-corner-all elfinder-upload-dropbox">'+r.i18n("dropFiles")+"<\/div>").prependTo(e).after('<div class="elfinder-upload-dialog-or">'+r.i18n("or")+"<\/div>").after(f).after("<div>"+r.i18n("dropFilesBrowser")+"<\/div>").after('<div class="elfinder-upload-dialog-or">'+r.i18n("or")+"<\/div>")[0],u.addEventListener("dragenter",function(i){i.stopPropagation();i.preventDefault();n(u).addClass(t)},!1),u.addEventListener("dragleave",function(i){i.stopPropagation();i.preventDefault();n(u).removeClass(t)},!1),u.addEventListener("dragover",function(i){i.stopPropagation();i.preventDefault();n(u).addClass(t)},!1),u.addEventListener("drop",function(n){n.stopPropagation();n.preventDefault();var t=!1,i="";n.dataTransfer&&n.dataTransfer.files&&n.dataTransfer.files.length?(t=n.dataTransfer.files,i="files"):n.dataTransfer.getData("text/html")?(t=[n.dataTransfer.getData("text/html")],i="html"):n.dataTransfer.getData("text")&&(t=[n.dataTransfer.getData("text")],i="text");t&&s({files:t,type:i})},!1)):n("<div>"+r.i18n("dropFilesBrowser")+"<\/div>").append(f).prependTo(e).after('<div class="elfinder-upload-dialog-or">'+r.i18n("or")+"<\/div>")[0],r.dialog(e,{title:this.title,modal:!0,resizable:!1,destroyOnClose:!0}),o)}};elFinder.prototype.commands.view=function(){this.value=this.fm.viewType;this.alwaysEnabled=!0;this.updateOnSelect=!1;this.options={ui:"viewbutton"};this.getstate=function(){return 0};this.exec=function(){var n=this.fm.storage("view",this.value=="list"?"icons":"list");this.fm.viewchange();this.update(void 0,n)}}}(jQuery);
//# sourceMappingURL=elfinder.min.js.map
