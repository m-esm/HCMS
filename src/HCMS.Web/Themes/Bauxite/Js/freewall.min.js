(function(n){function u(r){function a(i){var c=u.gutterX,l=u.gutterY,f=u.cellH,o=u.cellW,r=n(i),h=r.find(r.attr("data-handle"));t.setDraggable(i,{handle:h[0],onStart:function(n){e.animate&&t.transition&&t.setTransition(this,"");r.css("z-index",9999).addClass("fw-float");e.onBlockDrag.call(i,n)},onDrag:function(n){var c=r.position(),t=Math.round(c.top/f),h=Math.round(c.left/o),l=Math.round(r.width()/o),a=Math.round(r.height()/f);t=Math.min(Math.max(0,t),u.limitRow-a);h=Math.min(Math.max(0,h),u.limitCol-l);s.setHoles({top:t,left:h,width:l,height:a});s.refresh();e.onBlockMove.call(i,n)},onDrop:function(t){var y=r.position(),h=Math.round(y.top/f),c=Math.round(y.left/o),p=Math.round(r.width()/o),w=Math.round(r.height()/f),l,a,b,v;for(h=Math.min(Math.max(0,h),u.limitRow-w),c=Math.min(Math.max(0,c),u.limitCol-p),r.removeClass("fw-float"),r.css({zIndex:"auto",top:h*f,left:c*o}),a=0;a<w;++a)for(l=0;l<p;++l)b=a+h+"-"+(l+c),v=u.matrix[b],v&&v!=!0&&n("#"+v).removeAttr("data-position");u.holes={};r.attr({"data-width":r.width(),"data-height":r.height(),"data-position":h+"-"+c});s.refresh();e.onBlockDrop.call(i,t)}})}var o=n(r),c,s,e,u,h,l;o.css("position")=="static"&&o.css("position","relative");c=Number.MAX_VALUE;s=this;t.totalGrid+=1;e=n.extend({},t.defaultConfig);u={arguments:null,blocks:{},events:{},matrix:{},holes:{},cellW:0,cellH:0,cellS:1,filter:"",lastId:0,length:0,maxWoB:0,maxHoB:0,minWoB:c,minHoB:c,running:0,gutterX:15,gutterY:15,totalCol:0,totalRow:0,limitCol:666666,limitRow:666666,sortFunc:null,keepOrder:!1};e.runtime=u;u.totalGrid=t.totalGrid;h=document.body.style;t.transition||(h.webkitTransition!=null||h.MozTransition!=null||h.msTransition!=null||h.OTransition!=null||h.transition!=null)&&(t.transition=!0);n.extend(s,{addCustomEvent:function(n,t){var i=u.events;return n=n.toLowerCase(),i[n]||(i[n]=[]),t.eid=i[n].length,i[n].push(t),this},appendBlock:function(i){var r=n(i).appendTo(o),s=null,h=[];u.arguments&&(n.isFunction(u.sortFunc)&&r.sort(u.sortFunc),r.each(function(n,i){i.index=++n;s=t.loadBlock(i,e);s&&h.push(s)}),f[e.engine](h,e),t.setWallSize(u,o),u.length=r.length,r.each(function(n,i){t.showBlock(i,e);(e.draggable||i.getAttribute("data-draggable"))&&a(i)}))},appendHoles:function(n){for(var r=[].concat(n),t={},i=0;i<r.length;++i)t=r[i],u.holes[t.top+"-"+t.left+"-"+t.width+"-"+t.height]=t;return this},container:o,destroy:function(){var t=o.find(e.selector).removeAttr("id");t.each(function(t,i){$item=n(i);var r=1*$item.attr("data-width")||"",u=1*$item.attr("data-height")||"";$item.width(r).height(u).css({position:"static"})})},fillHoles:function(n){if(arguments.length==0)u.holes={};else for(var r=[].concat(n),t={},i=0;i<r.length;++i)t=r[i],delete u.holes[t.top+"-"+t.left+"-"+t.width+"-"+t.height];return this},filter:function(n){return u.filter=n,u.arguments&&this.refresh(),this},fireEvent:function(n,t,i){var r=u.events,f;if(n=n.toLowerCase(),r[n]&&r[n].length)for(f=0;f<r[n].length;++f)r[n][f].call(this,t,i);return this},fitHeight:function(n){var n=n?n:o.height()||i.height();this.fitZone("auto",n);u.arguments=arguments},fitWidth:function(n){var n=n?n:o.width()||i.width();this.fitZone(n,"auto");u.arguments=arguments},fitZone:function(r,h){var c=o.find(e.selector).removeAttr("id"),l=null,v=[];h=h?h:o.height()||i.height();r=r?r:o.width()||i.width();u.arguments=arguments;t.resetGrid(u);t.adjustUnit(r,h,e);u.filter?(c.data("active",0),c.filter(u.filter).data("active",1)):c.data("active",1);n.isFunction(u.sortFunc)&&c.sort(u.sortFunc);c.each(function(i,r){var u=n(r);r.index=++i;l=t.loadBlock(r,e);l&&u.data("active")&&v.push(l)});s.fireEvent("onGridReady",o,e);f[e.engine](v,e);t.setWallSize(u,o);s.fireEvent("onGridArrange",o,e);u.length=c.length;c.each(function(n,i){t.showBlock(i,e);(e.draggable||i.getAttribute("data-draggable"))&&a(i)})},fixPos:function(t){return n(t.block).attr({"data-position":t.top+"-"+t.left}),this},fixSize:function(t){return t.height!=null&&n(t.block).attr({"data-height":t.height}),t.width!=null&&n(t.block).attr({"data-width":t.width}),this},prepend:function(n){return o.prepend(n),u.arguments&&this.refresh(),this},refresh:function(){var t=arguments.length?arguments:u.arguments,n=u.arguments,i=n?n.callee:this.fitWidth;return i.apply(this,Array.prototype.slice.call(t,0)),this},reset:function(t){return n.extend(e,t),this},setHoles:function(n){var r=[].concat(n),t={},i;for(u.holes={},i=0;i<r.length;++i)t=r[i],u.holes[t.top+"-"+t.left+"-"+t.width+"-"+t.height]=t;return this},sortBy:function(n){return u.sortFunc=n,u.arguments&&this.refresh(),this},unFilter:function(){return delete u.filter,this.refresh(),this}});o.attr("data-min-width",Math.floor(i.width()/80)*80);for(l in t.plugin)t.plugin.hasOwnProperty(l)&&t.plugin[l].call(s,e,o);i.resize(function(){u.running||(u.running=1,setTimeout(function(){u.running=0;e.onResize.call(s,o)},122),o.attr("data-min-width",Math.floor(i.width()/80)*80))})}n.isNumeric==null&&(n.isNumeric=function(n){return n!=null&&n.constructor===Number});n.isFunction==null&&(n.isFunction=function(n){return n!=null&&n instanceof Function});var i=n(window),r=n(document),t={defaultConfig:{animate:!1,cellW:100,cellH:100,delay:0,engine:"giot",fixSize:null,gutterX:15,gutterY:15,keepOrder:!1,selector:"> div",draggable:!1,cacheSize:!0,rightToLeft:!1,bottomToTop:!1,onGapFound:function(){},onComplete:function(){},onResize:function(){},onBlockDrag:function(){},onBlockMove:function(){},onBlockDrop:function(){},onBlockReady:function(){},onBlockFinish:function(){},onBlockActive:function(){},onBlockResize:function(){}},plugin:{},totalGrid:1,transition:!1,loadBlock:function(t,i){var u=i.runtime,a=u.gutterX,v=u.gutterY,y=u.cellH,p=u.cellW,f=null,r=n(t),k=r.data("active"),l=r.attr("data-position"),s=parseInt(r.attr("data-fixSize")),d=u.lastId+++"-"+u.totalGrid,w,h,c,e,o,b;return r.hasClass("fw-float")?null:(r.attr({id:d,"data-delay":t.index}),i.animate&&this.transition&&this.setTransition(t,""),isNaN(s)&&(s=null),s==null&&(s=i.fixSize),w=s?"ceil":"round",r.attr("data-height")==null&&r.attr("data-height",r.height()),r.attr("data-width")==null&&r.attr("data-width",r.width()),h=1*r.attr("data-height"),c=1*r.attr("data-width"),i.cacheSize||(t.style.width="",c=r.width(),t.style.height="",h=r.height()),e=c?Math[w]((c+a)/p):0,o=h?Math[w]((h+v)/y):0,s||i.cellH!="auto"||(r.width(p*e-a),t.style.height="",h=r.height(),o=h?Math.round((h+v)/y):0),s||i.cellW!="auto"||(r.height(y*o-v),t.style.width="",c=r.width(),e=c?Math.round((c+a)/p):0),s!=null&&(e>u.limitCol||o>u.limitRow)?f=null:(o&&o<u.minHoB&&(u.minHoB=o),e&&e<u.minWoB&&(u.minWoB=e),o>u.maxHoB&&(u.maxHoB=o),e>u.maxWoB&&(u.maxWoB=e),c==0&&(e=0),h==0&&(o=0),f={resize:!1,id:d,width:e,height:o,fixSize:s},l&&(l=l.split("-"),f.y=1*l[0],f.x=1*l[1],f.width=s!=null?e:Math.min(e,u.limitCol-f.x),f.height=s!=null?o:Math.min(o,u.limitRow-f.y),b=f.y+"-"+f.x+"-"+f.width+"-"+f.height,k?(u.holes[b]={id:f.id,top:f.y,left:f.x,width:f.width,height:f.height},this.setBlock(f,i)):delete u.holes[b])),r.attr("data-state")==null?r.attr("data-state","init"):r.attr("data-state","move"),i.onBlockReady.call(t,f,i),l&&k?null:f)},setBlock:function(n,t){var r=t.runtime,c=r.gutterX,l=r.gutterY,e=n.height,o=n.width,s=r.cellH,h=r.cellW,u=n.x,f=n.y,i;return t.rightToLeft&&(u=r.limitCol-u-o),t.bottomToTop&&(f=r.limitRow-f-e),i={fixSize:n.fixSize,resize:n.resize,top:f*s,left:u*h,width:h*o-c,height:s*e-l},i.top=1*i.top.toFixed(2),i.left=1*i.left.toFixed(2),i.width=1*i.width.toFixed(2),i.height=1*i.height.toFixed(2),n.id&&(r.blocks[n.id]=i),i},showBlock:function(t,i){function h(){var n;if(s&&u.attr("data-state","start"),i.animate&&f.transition&&f.setTransition(t,c),e.length-=1,r)r.fixSize&&(r.height=1*u.attr("data-height"),r.width=1*u.attr("data-width")),u.css({opacity:1,width:r.width,height:r.height}),u[o]({top:r.top,left:r.left}),u.attr("data-nested")!=null&&f.nestedGrid(t,i);else{var h=parseInt(t.style.height)||0,l=parseInt(t.style.width)||0,a=parseInt(t.style.left)||0,v=parseInt(t.style.top)||0;u[o]({left:a+l/2,top:v+h/2,width:0,height:0,opacity:0})}i.onBlockFinish.call(t,r,i);e.length==0&&(n=i.animate?500:0,t.delay=setTimeout(function(){i.onComplete.call(t,r,i)},n))}var e=i.runtime,o=i.animate&&!this.transition?"animate":"css",r=e.blocks[t.id],u=n(t),f=this,s=u.attr("data-state")!="move",c=s?"width 0.5s, height 0.5s":"top 0.5s, left 0.5s, width 0.5s, height 0.5s, opacity 0.5s";(t.delay&&clearTimeout(t.delay),u.hasClass("fw-float"))||(f.setTransition(t,""),t.style.position="absolute",i.onBlockActive.call(t,r,i),r&&r.resize&&i.onBlockResize.call(t,r,i),i.delay>0?t.delay=setTimeout(h,i.delay*u.attr("data-delay")):h())},nestedGrid:function(t,i){var f,r=n(t),s=i.runtime,h=r.attr("data-gutterX")||i.gutterX,c=r.attr("data-gutterY")||i.gutterY,o=r.attr("data-method")||"fitZone",l=r.attr("data-nested")||"> div",a=r.attr("data-cellH")||i.cellH,v=r.attr("data-cellW")||i.cellW,e=s.blocks[t.id];if(e){f=new u(r);f.reset({cellH:a,cellW:v,gutterX:1*h,gutterY:1*c,selector:l,cacheSize:!1});switch(o){case"fitHeight":f[o](e.height);break;case"fitWidth":f[o](e.width);break;case"fitZone":f[o](e.width,e.height)}}},adjustBlock:function(t,i){var r=i.runtime,f=r.gutterX,e=r.gutterY,u=n("#"+t.id),o=r.cellH,s=r.cellW;i.cellH=="auto"&&(u.width(t.width*s-f),u[0].style.height="",t.height=Math.round((u.height()+e)/o))},adjustUnit:function(t,i,r){var o=r.gutterX,s=r.gutterY,u=r.runtime,f=r.cellW,e=r.cellH,h,c;n.isFunction(f)&&(f=f(t));f=1*f;n.isNumeric(f)||(f=1);n.isFunction(e)&&(e=e(i));e=1*e;n.isNumeric(e)||(e=1);n.isNumeric(t)&&(f<1&&(f=f*t),h=Math.max(1,Math.floor(t/f)),n.isNumeric(o)||(o=(t-h*f)/Math.max(1,h-1),o=Math.max(0,o)),h=Math.floor((t+o)/f),u.cellW=(t+o)/Math.max(h,1),u.cellS=u.cellW/f,u.gutterX=o,u.limitCol=h);n.isNumeric(i)&&(e<1&&(e=e*i),c=Math.max(1,Math.floor(i/e)),n.isNumeric(s)||(s=(i-c*e)/Math.max(1,c-1),s=Math.max(0,s)),c=Math.floor((i+s)/e),u.cellH=(i+s)/Math.max(c,1),u.cellS=u.cellH/e,u.gutterY=s,u.limitRow=c);n.isNumeric(t)||(f<1&&(f=u.cellH),u.cellW=f!=1?f*u.cellS:1,u.gutterX=o,u.limitCol=666666);n.isNumeric(i)||(e<1&&(e=u.cellW),u.cellH=e!=1?e*u.cellS:1,u.gutterY=s,u.limitRow=666666);u.keepOrder=r.keepOrder},resetGrid:function(n){n.blocks={};n.length=0;n.cellH=0;n.cellW=0;n.lastId=1;n.matrix={};n.totalCol=0;n.totalRow=0},setDraggable:function(t,i){var u=!1,f={startX:0,startY:0,top:0,left:0,handle:null,onDrop:function(){},onDrag:function(){},onStart:function(){}};n(t).each(function(){function v(n){return n.stopPropagation(),n=n.originalEvent,n.touches&&(u=!0,n=n.changedTouches[0]),n.button!=2&&n.which!=3&&(t.onStart.call(o,n),t.startX=n.clientX,t.startY=n.clientY,t.top=parseInt(e.css("top"))||0,t.left=parseInt(e.css("left"))||0,r.bind("mouseup touchend",h),r.bind("mousemove touchmove",s)),!1}function s(n){n=n.originalEvent;u&&(n=n.changedTouches[0]);e.css({top:t.top-(t.startY-n.clientY),left:t.left-(t.startX-n.clientX)});t.onDrag.call(o,n)}function h(n){n=n.originalEvent;u&&(n=n.changedTouches[0]);t.onDrop.call(o,n);r.unbind("mouseup touchend",h);r.unbind("mousemove touchmove",s)}var t=n.extend({},f,i),c=t.handle||this,o=this,e=n(o),l=n(c),a=e.css("position");a!="absolute"&&e.css("position","relative");e.find("iframe, form, input, textarea, .ignore-drag").each(function(){n(this).on("touchstart mousedown",function(n){n.stopPropagation()})});r.unbind("mouseup touchend",h);r.unbind("mousemove touchmove",s);l.unbind("mousedown touchstart").bind("mousedown touchstart",v)})},setTransition:function(t,i){var r=t.style,u=n(t);!this.transition&&u.stop?u.stop():r.webkitTransition!=null?r.webkitTransition=i:r.MozTransition!=null?r.MozTransition=i:r.msTransition!=null?r.msTransition=i:r.OTransition!=null?r.OTransition=i:r.transition=i},getFreeArea:function(n,t,i){for(var r,o=Math.min(n+i.maxHoB,i.limitRow),s=Math.min(t+i.maxWoB,i.limitCol),f=s,e=o,h=i.matrix,u=n;u<e;++u)for(r=t;r<s;++r)h[u+"-"+r]&&t<r&&r<f&&(f=r);for(u=n;u<o;++u)for(r=t;r<f;++r)h[u+"-"+r]&&n<u&&u<e&&(e=u);return{top:n,left:t,width:f-t,height:e-n}},setWallSize:function(n,t){var i=n.totalRow,r=n.totalCol,f=n.gutterY,e=n.gutterX,o=n.cellH,s=n.cellW,h=Math.max(0,s*r-e),u=Math.max(0,o*i-f);t.attr({"data-total-col":r,"data-total-row":i,"data-wall-width":Math.ceil(h),"data-wall-height":Math.ceil(u)});n.limitCol<n.limitRow&&(t.attr("data-height")||t.height(Math.ceil(u)))}},f={giot:function(n,i){function k(n,t,i,r,u){for(var e,f=t;f<t+u;){for(e=i;e<i+r;)a[f+"-"+e]=n,++e>nt&&(nt=e);++f>tt&&(tt=f)}}var e=i.runtime,d=e.limitRow,g=e.limitCol,s=0,h=0,nt=e.totalCol,tt=e.totalRow,it={},l=e.holes,u=null,a=e.matrix,rt=Math.max(g,d),o=null,c=null,v=g<d?1:0,r=null,ut=Math.min(g,d),w,b,f,p,y;for(f in l)l.hasOwnProperty(f)&&k(l[f].id||!0,l[f].top,l[f].left,l[f].width,l[f].height);for(w=0;w<rt;++w){if(!n.length)break;for(v?h=w:s=w,r=null,b=0;b<ut;++b){if(!n.length)break;if(u=null,v?s=b:h=b,!e.matrix[h+"-"+s]){if(o=t.getFreeArea(h,s,e),i.fixSize==null)if(r&&!v&&e.minHoB>o.height){r.height+=o.height;r.resize=!0;k(r.id,r.y,r.x,r.width,r.height);t.setBlock(r,i);continue}else if(r&&v&&e.minWoB>o.width){r.width+=o.width;r.resize=!0;k(r.id,r.y,r.x,r.width,r.height);t.setBlock(r,i);continue}if(e.keepOrder)u=n.shift(),u.resize=!0;else{for(f=0;f<n.length;++f)if(!(n[f].height>o.height)&&!(n[f].width>o.width)){u=n.splice(f,1)[0];break}if(u==null&&i.fixSize==null)for(f=0;f<n.length;++f)if(n[f].fixSize==null){u=n.splice(f,1)[0];u.resize=!0;break}}if(u!=null)u.resize&&(v?(u.width=o.width,i.cellH=="auto"&&t.adjustBlock(u,i),u.height=Math.min(u.height,o.height)):(u.height=o.height,u.width=Math.min(u.width,o.width))),it[u.id]={id:u.id,x:s,y:h,width:u.width,height:u.height,resize:u.resize,fixSize:u.fixSize},r=it[u.id],k(r.id,r.y,r.x,r.width,r.height),t.setBlock(r,i);else{if(c={x:s,y:h,fixSize:0},v)for(c.width=o.width,c.height=0,y=s-1,p=h;a[p+"-"+y];)a[p+"-"+s]=!0,c.height+=1,p+=1;else for(c.height=o.height,c.width=0,p=h-1,y=s;a[p+"-"+y];)a[h+"-"+y]=!0,c.width+=1,y+=1;i.onGapFound(t.setBlock(c,i),i)}}}}e.matrix=a;e.totalRow=tt;e.totalCol=nt}};u.addConfig=function(i){n.extend(t.defaultConfig,i)};u.createEngine=function(t){n.extend(f,t)};u.createPlugin=function(i){n.extend(t.plugin,i)};u.getMethod=function(n){return t[n]};window.Freewall=window.freewall=u})(window.Zepto||window.jQuery);
//# sourceMappingURL=freewall.min.js.map
