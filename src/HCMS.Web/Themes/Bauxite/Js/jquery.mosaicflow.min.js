/**
 * Mosaic Flow
 *
 * Pinterest like responsive image grid that doesn’t sucks
 *
 * @requires jQuery
 * @author Artem Sapegin
 * @copyright 2012 Artem Sapegin, http://sapegin.me
 * @license MIT
 */
(function(n){typeof define=="function"&&define.amd?define(["jquery"],n):n(jQuery)})(function(n){"use strict";function t(n,t){this.container=n;this.options=t;this.container.trigger("mosaicflow-start");this.init();this.container.trigger("mosaicflow-ready")}function r(n){function u(n,t){return t.toUpper()}var t={},i=n.data();for(var r in i)t[r.replace(/-(\w)/g,u)]=i[r];return t}function u(n){var t={},i;return t.height=parseInt(n.attr("height"),10),t.width=parseInt(n.attr("width"),10),(t.height===0||t.width===0)&&(i=new Image,i.src=n.attr("src"),t.width=i.width,t.height=i.height),t}var i=0;n.fn.mosaicflow=function(i){var u=Array.prototype.slice.call(arguments,0);return this.each(function(){var f=n(this),e=f.data("mosaicflow");e?typeof i=="string"&&e[i](u[1]):(i=n.extend({},n.fn.mosaicflow.defaults,i,r(f)),e=new t(f,i),f.data("mosaicflow",e))})};n.fn.mosaicflow.defaults={itemSelector:"> *",columnClass:"mosaicflow__column",minItemWidth:250,minColumns:1,itemHeightCalculation:"auto",threshold:40};t.prototype={init:function(){this.__uid=i++;this.__uidItemCounter=0;this.items=this.container.find(this.options.itemSelector);this.columns=n([]);this.columnsHeights=[];this.itemsHeights={};this.tempContainer=n("<div>").css({visibility:"hidden",width:"100%"});this.workOnTemp=!1;this.autoCalculation=this.options.itemHeightCalculation==="auto";this.container.append(this.tempContainer);var t=this;this.items.each(function(){var r=n(this),i=r.attr("id");i||(i=t.generateUniqueId(),r.attr("id",i))});this.container.css("visibility","hidden");this.autoCalculation?n(window).load(n.proxy(this.refill,this)):this.refill();n(window).resize(n.proxy(this.refill,this))},refill:function(){this.container.trigger("mosaicflow-fill");this.numberOfColumns=Math.floor(this.container.width()/this.options.minItemWidth);this.numberOfColumns<this.options.minColumns&&(this.numberOfColumns=this.options.minColumns);var n=this.ensureColumns();n&&(this.fillColumns(),this.columns.filter(":visible").length>0&&this.columns.filter(":hidden").remove());this.container.css("visibility","visible");this.container.trigger("mosaicflow-filled")},ensureColumns:function(){var t=this.columns.filter(":visible").length,i=this.numberOfColumns,e,u,o,r,f;if(this.workingContainer=t===0?this.tempContainer:this.container,i>t)for(e=i-t,u=0;u<e;u++)o=n("<div>",{"class":this.options.columnClass}),this.workingContainer.append(o);else if(i<t){for(r=t;i<=r;)this.columns.eq(r).hide(),r--;f=t-i;this.columnsHeights.splice(this.columnsHeights.length-f,f)}return i!==t?(this.columns=this.workingContainer.find("."+this.options.columnClass),this.columns.css("width",100/i+"%"),!0):!1},fillColumns:function(){for(var f,i,t,r,u=this.numberOfColumns,e=this.items.length,n=0;n<u;n++)for(f=this.columns.eq(n),this.columnsHeights[n]=0,i=n;i<e;i+=u)t=this.items.eq(i),r=0,f.append(t),r=this.autoCalculation?t.outerHeight():parseInt(t.find("img").attr("height"),10),this.itemsHeights[t.attr("id")]=r,this.columnsHeights[n]+=r;this.levelBottomEdge(this.itemsHeights,this.columnsHeights);this.workingContainer===this.tempContainer&&this.container.append(this.tempContainer.children());this.container.trigger("mosaicflow-layout")},levelBottomEdge:function(t,i){for(var r,u;;){if(r=n.inArray(Math.min.apply(null,i),i),u=n.inArray(Math.max.apply(null,i),i),r===u)return;var e=this.columns.eq(u).children().last(),f=t[e.attr("id")],h=i[r],o=i[u],s=h+f;if(s>=o)return;if(o-s<this.options.threshold)return;this.columns.eq(r).append(e);i[u]-=f;i[r]+=f}},add:function(t){var r,i,f,e;this.container.trigger("mosaicflow-item-add",[t]);r=n.inArray(Math.min.apply(null,this.columnsHeights),this.columnsHeights);i=0;this.autoCalculation?(t.css({position:"static",visibility:"hidden",display:"block"}).appendTo(this.columns.eq(r)),i=t.outerHeight(),f=t.find("img"),f.length!==0&&f.each(function(){var t=n(this),r=u(t),f=t.width()*r.height/r.width;i+=f}),t.detach().css({position:"static",visibility:"visible"})):i=parseInt(t.find("img").attr("height"),10);t.attr("id")||t.attr("id",this.generateUniqueId());e=this.items.toArray();e.push(t);this.items=n(e);this.itemsHeights[t.attr("id")]=i;this.columnsHeights[r]+=i;this.columns.eq(r).append(t);this.levelBottomEdge(this.itemsHeights,this.columnsHeights);this.container.trigger("mosaicflow-layout");this.container.trigger("mosaicflow-item-added",[t])},remove:function(n){this.container.trigger("mosaicflow-item-remove",[n]);var t=n.parents("."+this.options.columnClass);this.columnsHeights[t.index()-1]-=this.itemsHeights[n.attr("id")];n.detach();this.items=this.items.not(n);this.levelBottomEdge(this.itemsHeights,this.columnsHeights);this.container.trigger("mosaicflow-layout");this.container.trigger("mosaicflow-item-removed",[n])},empty:function(){var r=this.numberOfColumns,t,i;for(this.items=n([]),this.itemsHeights={},t=0;t<r;t++)i=this.columns.eq(t),this.columnsHeights[t]=0,i.empty();this.container.trigger("mosaicflow-layout")},recomputeHeights:function(){function u(r,u){u=n(u);var f=0;f=i.autoCalculation?u.outerHeight():parseInt(u.find("img").attr("height"),10);i.itemsHeights[u.attr("id")]=f;i.columnsHeights[t]+=f}for(var r,i=this,f=this.numberOfColumns,t=0;t<f;t++)r=this.columns.eq(t),this.columnsHeights[t]=0,r.children().each(u)},generateUniqueId:function(){return this.__uidItemCounter++,"mosaic-"+this.__uid+"-itemid-"+this.__uidItemCounter}};n(function(){n(".mosaicflow").mosaicflow()})});
//# sourceMappingURL=jquery.mosaicflow.min.js.map
